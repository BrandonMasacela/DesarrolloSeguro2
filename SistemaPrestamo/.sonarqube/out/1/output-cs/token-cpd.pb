ıñ
WC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Data\UsuarioData.cs
	namespace		 	
Prestamo		
 
.		 
Data		 
{

 
public 

class 
UsuarioData 
{ 
private 
readonly 
ConnectionStrings *
con+ .
;. /
public 
UsuarioData 
( 
IOptions #
<# $
ConnectionStrings$ 5
>5 6
options7 >
)> ?
{ 	
con 
= 
options 
. 
Value 
;  
} 	
public 
string !
GenerarClaveAleatoria +
(+ ,
int, /
longitud0 8
)8 9
{ 	
const 
string 

caracteres #
=$ %
$str& f
;f g
var 
clave 
= 
new 
char  
[  !
longitud! )
]) *
;* +
using 
( 
var 
rng 
= 
new  $
RNGCryptoServiceProvider! 9
(9 :
): ;
); <
{ 
var 
bytes 
= 
new 
byte  $
[$ %
longitud% -
]- .
;. /
rng 
. 
GetBytes 
( 
bytes "
)" #
;# $
for 
( 
int 
i 
= 
$num 
; 
i  !
<" #
clave$ )
.) *
Length* 0
;0 1
i2 3
++3 5
)5 6
{ 
clave 
[ 
i 
] 
= 

caracteres )
[) *
bytes* /
[/ 0
i0 1
]1 2
%3 4

caracteres5 ?
.? @
Length@ F
]F G
;G H
} 
} 
Console 
. 
	WriteLine 
( 
new !
string" (
(( )
clave) .
). /
)/ 0
;0 1
return   
new   
string   
(   
clave   #
)  # $
;  $ %
}!! 	
public"" 
async"" 
Task"" 
<"" 
Usuario"" !
>""! "
ObtenerPorCorreo""# 3
(""3 4
string""4 :
correo""; A
)""A B
{## 	
Usuario$$ 
objeto$$ 
=$$ 
null$$ !
!$$! "
;$$" #
using&& 
(&& 
var&& 
conexion&& 
=&&  !
new&&" %
SqlConnection&&& 3
(&&3 4
con&&4 7
.&&7 8
	CadenaSQL&&8 A
)&&A B
)&&B C
{'' 
await(( 
conexion(( 
.(( 
	OpenAsync(( (
(((( )
)(() *
;((* +

SqlCommand)) 
cmd)) 
=))  
new))! $

SqlCommand))% /
())/ 0
$str))0 L
,))L M
conexion))N V
)))V W
;))W X
cmd** 
.** 

Parameters** 
.** 
AddWithValue** +
(**+ ,
$str**, 5
,**5 6
correo**7 =
)**= >
;**> ?
cmd++ 
.++ 
CommandType++ 
=++  !
CommandType++" -
.++- .
StoredProcedure++. =
;++= >
using-- 
(-- 
var-- 
dr-- 
=-- 
await--  %
cmd--& )
.--) *
ExecuteReaderAsync--* <
(--< =
)--= >
)--> ?
{.. 
while// 
(// 
await//  
dr//! #
.//# $
	ReadAsync//$ -
(//- .
)//. /
)/// 0
{00 
objeto11 
=11  
new11! $
Usuario11% ,
(11, -
)11- .
{22 
	IdUsuario33 %
=33& '
Convert33( /
.33/ 0
ToInt32330 7
(337 8
dr338 :
[33: ;
$str33; F
]33F G
.33G H
ToString33H P
(33P Q
)33Q R
!33R S
)33S T
,33T U
NombreCompleto44 *
=44+ ,
dr44- /
[44/ 0
$str440 @
]44@ A
.44A B
ToString44B J
(44J K
)44K L
!44L M
,44M N
Correo55 "
=55# $
dr55% '
[55' (
$str55( 0
]550 1
.551 2
ToString552 :
(55: ;
)55; <
!55< =
,55= >
Clave66 !
=66" #
dr66$ &
[66& '
$str66' .
]66. /
.66/ 0
ToString660 8
(668 9
)669 :
!66: ;
,66; <
Rol77 
=77  !
dr77" $
[77$ %
$str77% *
]77* +
.77+ ,
ToString77, 4
(774 5
)775 6
!776 7
,777 8
FailedAttempts88 *
=88+ ,
Convert88- 4
.884 5
ToInt32885 <
(88< =
dr88= ?
[88? @
$str88@ P
]88P Q
)88Q R
,88R S
IsLocked99 $
=99% &
Convert99' .
.99. /
	ToBoolean99/ 8
(998 9
dr999 ;
[99; <
$str99< F
]99F G
)99G H
,99H I

LockoutEnd:: &
=::' (
dr::) +
[::+ ,
$str::, 8
]::8 9
==::: <
DBNull::= C
.::C D
Value::D I
?::J K
null::L P
:::Q R
Convert::S Z
.::Z [

ToDateTime::[ e
(::e f
dr::f h
[::h i
$str::i u
]::u v
)::v w
,::w x
};; 
;;; 
}<< 
}== 
}>> 
return?? 
objeto?? 
;?? 
}@@ 	
publicBB 
asyncBB 
TaskBB 
<BB 
boolBB 
>BB 
CrearBB  %
(BB% &
UsuarioBB& -
usuarioBB. 5
)BB5 6
{CC 	
usingDD 
(DD 
varDD 
conexionDD 
=DD  !
newDD" %
SqlConnectionDD& 3
(DD3 4
conDD4 7
.DD7 8
	CadenaSQLDD8 A
)DDA B
)DDB C
{EE 
awaitFF 
conexionFF 
.FF 
	OpenAsyncFF (
(FF( )
)FF) *
;FF* +

SqlCommandGG 
cmdGG 
=GG  
newGG! $

SqlCommandGG% /
(GG/ 0
$strGG0 A
,GGA B
conexionGGC K
)GGK L
;GGL M
cmdHH 
.HH 

ParametersHH 
.HH 
AddWithValueHH +
(HH+ ,
$strHH, =
,HH= >
usuarioHH? F
.HHF G
NombreCompletoHHG U
)HHU V
;HHV W
cmdII 
.II 

ParametersII 
.II 
AddWithValueII +
(II+ ,
$strII, 5
,II5 6
usuarioII7 >
.II> ?
CorreoII? E
)IIE F
;IIF G
cmdJJ 
.JJ 

ParametersJJ 
.JJ 
AddWithValueJJ +
(JJ+ ,
$strJJ, 4
,JJ4 5
usuarioJJ6 =
.JJ= >
ClaveJJ> C
)JJC D
;JJD E
cmdKK 
.KK 

ParametersKK 
.KK 
AddWithValueKK +
(KK+ ,
$strKK, 2
,KK2 3
usuarioKK4 ;
.KK; <
RolKK< ?
)KK? @
;KK@ A
cmdLL 
.LL 
CommandTypeLL 
=LL  !
CommandTypeLL" -
.LL- .
StoredProcedureLL. =
;LL= >
intNN 
rowsAffectedNN  
=NN! "
awaitNN# (
cmdNN) ,
.NN, - 
ExecuteNonQueryAsyncNN- A
(NNA B
)NNB C
;NNC D
returnOO 
rowsAffectedOO #
>OO$ %
$numOO& '
;OO' (
}PP 
}QQ 	
publicSS 
asyncSS 
TaskSS 
UpdateLockoutStatusSS -
(SS- .
UsuarioSS. 5
usuarioSS6 =
)SS= >
{TT 	
usingUU 
(UU 
varUU 
conexionUU 
=UU  !
newUU" %
SqlConnectionUU& 3
(UU3 4
conUU4 7
.UU7 8
	CadenaSQLUU8 A
)UUA B
)UUB C
{VV 
awaitWW 
conexionWW 
.WW 
	OpenAsyncWW (
(WW( )
)WW) *
;WW* +

SqlCommandXX 
cmdXX 
=XX  
newXX! $

SqlCommandXX% /
(XX/ 0
$strXX0 H
,XXH I
conexionXXJ R
)XXR S
;XXS T
cmdYY 
.YY 
CommandTypeYY 
=YY  !
CommandTypeYY" -
.YY- .
StoredProcedureYY. =
;YY= >
cmdZZ 
.ZZ 

ParametersZZ 
.ZZ 
AddWithValueZZ +
(ZZ+ ,
$strZZ, 8
,ZZ8 9
usuarioZZ: A
.ZZA B
	IdUsuarioZZB K
)ZZK L
;ZZL M
cmd[[ 
.[[ 

Parameters[[ 
.[[ 
AddWithValue[[ +
([[+ ,
$str[[, =
,[[= >
usuario[[? F
.[[F G
FailedAttempts[[G U
)[[U V
;[[V W
cmd\\ 
.\\ 

Parameters\\ 
.\\ 
AddWithValue\\ +
(\\+ ,
$str\\, @
,\\@ A
usuario\\B I
.\\I J
LastFailedAttempt\\J [
)\\[ \
;\\\ ]
cmd]] 
.]] 

Parameters]] 
.]] 
AddWithValue]] +
(]]+ ,
$str]], 9
,]]9 :
usuario]]; B
.]]B C

LockoutEnd]]C M
??]]N P
(]]Q R
object]]R X
)]]X Y
DBNull]]Y _
.]]_ `
Value]]` e
)]]e f
;]]f g
cmd^^ 
.^^ 

Parameters^^ 
.^^ 
AddWithValue^^ +
(^^+ ,
$str^^, 7
,^^7 8
usuario^^9 @
.^^@ A
IsLocked^^A I
)^^I J
;^^J K
await__ 
cmd__ 
.__  
ExecuteNonQueryAsync__ .
(__. /
)__/ 0
;__0 1
}`` 
}aa 	
publiccc 
asynccc 
Taskcc 
ResetLockoutcc &
(cc& '
intcc' *
	idUsuariocc+ 4
)cc4 5
{dd 	
usingee 
(ee 
varee 
conexionee 
=ee  !
newee" %
SqlConnectionee& 3
(ee3 4
conee4 7
.ee7 8
	CadenaSQLee8 A
)eeA B
)eeB C
{ff 
awaitgg 
conexiongg 
.gg 
	OpenAsyncgg (
(gg( )
)gg) *
;gg* +

SqlCommandhh 
cmdhh 
=hh  
newhh! $

SqlCommandhh% /
(hh/ 0
$strhh0 A
,hhA B
conexionhhC K
)hhK L
;hhL M
cmdii 
.ii 
CommandTypeii 
=ii  !
CommandTypeii" -
.ii- .
StoredProcedureii. =
;ii= >
cmdjj 
.jj 

Parametersjj 
.jj 
AddWithValuejj +
(jj+ ,
$strjj, 8
,jj8 9
	idUsuariojj: C
)jjC D
;jjD E
awaitkk 
cmdkk 
.kk  
ExecuteNonQueryAsynckk .
(kk. /
)kk/ 0
;kk0 1
}ll 
}mm 	
publicoo 
asyncoo 
Taskoo 
<oo 
booloo 
>oo 

Actualizaroo  *
(oo* +
Usuariooo+ 2
usuariooo3 :
)oo: ;
{pp 	
usingqq 
(qq 
varqq 
conexionqq 
=qq  !
newqq" %
SqlConnectionqq& 3
(qq3 4
conqq4 7
.qq7 8
	CadenaSQLqq8 A
)qqA B
)qqB C
{rr 
awaitss 
conexionss 
.ss 
	OpenAsyncss (
(ss( )
)ss) *
;ss* +
usingtt 
(tt 

SqlCommandtt !
cmdtt" %
=tt& '
newtt( +

SqlCommandtt, 6
(tt6 7
$strtt7 M
,ttM N
conexionttO W
)ttW X
)ttX Y
{uu 
cmdvv 
.vv 
CommandTypevv #
=vv$ %
CommandTypevv& 1
.vv1 2
StoredProcedurevv2 A
;vvA B
cmdww 
.ww 

Parametersww "
.ww" #
AddWithValueww# /
(ww/ 0
$strww0 <
,ww< =
usuarioww> E
.wwE F
	IdUsuariowwF O
)wwO P
;wwP Q
cmdxx 
.xx 

Parametersxx "
.xx" #
AddWithValuexx# /
(xx/ 0
$strxx0 8
,xx8 9
usuarioxx: A
.xxA B
ClavexxB G
)xxG H
;xxH I
SqlParameter{{  
outputParam{{! ,
={{- .
new{{/ 2
SqlParameter{{3 ?
({{? @
$str{{@ K
,{{K L
	SqlDbType{{M V
.{{V W
NVarChar{{W _
,{{_ `
$num{{a d
){{d e
{|| 
	Direction}} !
=}}" #
ParameterDirection}}$ 6
.}}6 7
Output}}7 =
}~~ 
;~~ 
cmd 
. 

Parameters "
." #
Add# &
(& '
outputParam' 2
)2 3
;3 4
await
ÅÅ 
cmd
ÅÅ 
.
ÅÅ "
ExecuteNonQueryAsync
ÅÅ 2
(
ÅÅ2 3
)
ÅÅ3 4
;
ÅÅ4 5
string
ÑÑ 
mensajeError
ÑÑ '
=
ÑÑ( )
outputParam
ÑÑ* 5
.
ÑÑ5 6
Value
ÑÑ6 ;
.
ÑÑ; <
ToString
ÑÑ< D
(
ÑÑD E
)
ÑÑE F
;
ÑÑF G
if
ÜÜ 
(
ÜÜ 
!
ÜÜ 
string
ÜÜ 
.
ÜÜ  
IsNullOrEmpty
ÜÜ  -
(
ÜÜ- .
mensajeError
ÜÜ. :
)
ÜÜ: ;
)
ÜÜ; <
{
áá 
throw
àà 
new
àà !
	Exception
àà" +
(
àà+ ,
mensajeError
àà, 8
)
àà8 9
;
àà9 :
}
ââ 
return
ãã 
true
ãã 
;
ãã  
}
åå 
}
çç 
}
éé 	
public
êê 
async
êê 
Task
êê 
<
êê 
Usuario
êê !
>
êê! "
ObtenerPorId
êê# /
(
êê/ 0
int
êê0 3
	idUsuario
êê4 =
)
êê= >
{
ëë 	
Usuario
íí 
objeto
íí 
=
íí 
null
íí !
!
íí! "
;
íí" #
using
ìì 
(
ìì 
var
ìì 
conexion
ìì 
=
ìì  !
new
ìì" %
SqlConnection
ìì& 3
(
ìì3 4
con
ìì4 7
.
ìì7 8
	CadenaSQL
ìì8 A
)
ììA B
)
ììB C
{
îî 
await
ïï 
conexion
ïï 
.
ïï 
	OpenAsync
ïï (
(
ïï( )
)
ïï) *
;
ïï* +

SqlCommand
ññ 
cmd
ññ 
=
ññ  
new
ññ! $

SqlCommand
ññ% /
(
ññ/ 0
$str
ññ0 H
,
ññH I
conexion
ññJ R
)
ññR S
;
ññS T
cmd
óó 
.
óó 

Parameters
óó 
.
óó 
AddWithValue
óó +
(
óó+ ,
$str
óó, 8
,
óó8 9
	idUsuario
óó: C
)
óóC D
;
óóD E
cmd
òò 
.
òò 
CommandType
òò 
=
òò  !
CommandType
òò" -
.
òò- .
StoredProcedure
òò. =
;
òò= >
using
ôô 
(
ôô 
var
ôô 
dr
ôô 
=
ôô 
await
ôô  %
cmd
ôô& )
.
ôô) * 
ExecuteReaderAsync
ôô* <
(
ôô< =
)
ôô= >
)
ôô> ?
{
öö 
while
õõ 
(
õõ 
await
õõ  
dr
õõ! #
.
õõ# $
	ReadAsync
õõ$ -
(
õõ- .
)
õõ. /
)
õõ/ 0
{
úú 
objeto
ùù 
=
ùù  
new
ùù! $
Usuario
ùù% ,
(
ùù, -
)
ùù- .
{
ûû 
	IdUsuario
üü %
=
üü& '
Convert
üü( /
.
üü/ 0
ToInt32
üü0 7
(
üü7 8
dr
üü8 :
[
üü: ;
$str
üü; F
]
üüF G
.
üüG H
ToString
üüH P
(
üüP Q
)
üüQ R
!
üüR S
)
üüS T
,
üüT U
NombreCompleto
†† *
=
††+ ,
dr
††- /
[
††/ 0
$str
††0 @
]
††@ A
.
††A B
ToString
††B J
(
††J K
)
††K L
!
††L M
,
††M N
Correo
°° "
=
°°# $
dr
°°% '
[
°°' (
$str
°°( 0
]
°°0 1
.
°°1 2
ToString
°°2 :
(
°°: ;
)
°°; <
!
°°< =
,
°°= >
Clave
¢¢ !
=
¢¢" #
dr
¢¢$ &
[
¢¢& '
$str
¢¢' .
]
¢¢. /
.
¢¢/ 0
ToString
¢¢0 8
(
¢¢8 9
)
¢¢9 :
!
¢¢: ;
,
¢¢; <
Rol
££ 
=
££  !
dr
££" $
[
££$ %
$str
££% *
]
££* +
.
££+ ,
ToString
££, 4
(
££4 5
)
££5 6
!
££6 7
,
££7 8
FailedAttempts
§§ *
=
§§+ ,
Convert
§§- 4
.
§§4 5
ToInt32
§§5 <
(
§§< =
dr
§§= ?
[
§§? @
$str
§§@ P
]
§§P Q
)
§§Q R
,
§§R S
IsLocked
•• $
=
••% &
Convert
••' .
.
••. /
	ToBoolean
••/ 8
(
••8 9
dr
••9 ;
[
••; <
$str
••< F
]
••F G
)
••G H
,
••H I

LockoutEnd
¶¶ &
=
¶¶' (
dr
¶¶) +
[
¶¶+ ,
$str
¶¶, 8
]
¶¶8 9
==
¶¶: <
DBNull
¶¶= C
.
¶¶C D
Value
¶¶D I
?
¶¶J K
null
¶¶L P
:
¶¶Q R
Convert
¶¶S Z
.
¶¶Z [

ToDateTime
¶¶[ e
(
¶¶e f
dr
¶¶f h
[
¶¶h i
$str
¶¶i u
]
¶¶u v
)
¶¶v w
,
¶¶w x
}
ßß 
;
ßß 
}
®® 
}
©© 
}
™™ 
Console
´´ 
.
´´ 
	WriteLine
´´ 
(
´´ 
objeto
´´ $
)
´´$ %
;
´´% &
return
¨¨ 
objeto
¨¨ 
;
¨¨ 
}
≠≠ 	
}
ØØ 
}∞∞ Ÿ
WC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Data\ResumenData.cs
	namespace 	
Prestamo
 
. 
Data 
{ 
public 

class 
ResumenData 
{ 
private		 
readonly		 
ConnectionStrings		 *
con		+ .
;		. /
public

 
ResumenData

 
(

 
IOptions

 #
<

# $
ConnectionStrings

$ 5
>

5 6
options

7 >
)

> ?
{ 	
con 
= 
options 
. 
Value 
;  
} 	
public 
async 
Task 
< 
Resumen !
>! "
Obtener# *
(* +
)+ ,
{ 	
Resumen 
objeto 
= 
new  
Resumen! (
(( )
)) *
;* +
using 
( 
var 
conexion 
=  !
new" %
SqlConnection& 3
(3 4
con4 7
.7 8
	CadenaSQL8 A
)A B
)B C
{ 
await 
conexion 
. 
	OpenAsync (
(( )
)) *
;* +

SqlCommand 
cmd 
=  
new! $

SqlCommand% /
(/ 0
$str0 C
,C D
conexionE M
)M N
;N O
cmd 
. 
CommandType 
=  !
CommandType" -
.- .
StoredProcedure. =
;= >
using 
( 
var 
dr 
= 
await  %
cmd& )
.) *
ExecuteReaderAsync* <
(< =
)= >
)> ?
{ 
while 
( 
await  
dr! #
.# $
	ReadAsync$ -
(- .
). /
)/ 0
{ 
objeto 
=  
new! $
Resumen% ,
(, -
)- .
{ 
TotalClientes )
=* +
dr, .
[. /
$str/ >
]> ?
.? @
ToString@ H
(H I
)I J
!J K
,K L
PrestamosPendientes   /
=  0 1
dr  2 4
[  4 5
$str  5 J
]  J K
.  K L
ToString  L T
(  T U
)  U V
!  V W
,  W X
PrestamosCancelados!! /
=!!0 1
dr!!2 4
[!!4 5
$str!!5 J
]!!J K
.!!K L
ToString!!L T
(!!T U
)!!U V
!!!V W
,!!W X
InteresAcumulado"" ,
=""- .
dr""/ 1
[""1 2
$str""2 D
]""D E
.""E F
ToString""F N
(""N O
)""O P
!""P Q
,""Q R!
SolicitudesPendientes## 1
=##2 3
dr##4 6
[##6 7
$str##7 N
]##N O
.##O P
ToString##P X
(##X Y
)##Y Z
!##Z [
}$$ 
;$$ 
}%% 
}&& 
}'' 
return(( 
objeto(( 
;(( 
})) 	
},, 
}-- ü
_C:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Data\ResumenClienteData .cs
	namespace 	
Prestamo
 
. 
Data 
{ 
public 

class 
ResumenClienteData #
{ 
private		 
readonly		 
ConnectionStrings		 *
con		+ .
;		. /
public

 
ResumenClienteData

 !
(

! "
IOptions

" *
<

* +
ConnectionStrings

+ <
>

< =
options

> E
)

E F
{ 	
con 
= 
options 
. 
Value 
;  
} 	
public 
async 
Task 
< 
ResumenCliente (
>( )
ObtenerResumen* 8
(8 9
int9 <
	idCliente= F
,F G
intH K

idPrestamoL V
)V W
{ 	
ResumenCliente 
objeto !
=" #
new$ '
ResumenCliente( 6
(6 7
)7 8
;8 9
using 
( 
var 
conexion 
=  !
new" %
SqlConnection& 3
(3 4
con4 7
.7 8
	CadenaSQL8 A
)A B
)B C
{ 
await 
conexion 
. 
	OpenAsync (
(( )
)) *
;* +

SqlCommand 
cmd 
=  
new! $

SqlCommand% /
(/ 0
$str0 M
,M N
conexionO W
)W X
;X Y
cmd 
. 

Parameters 
. 
AddWithValue +
(+ ,
$str, 8
,8 9
	idCliente: C
)C D
;D E
cmd 
. 

Parameters 
. 
AddWithValue +
(+ ,
$str, 9
,9 :

idPrestamo; E
)E F
;F G
cmd 
. 
CommandType 
=  !
CommandType" -
.- .
StoredProcedure. =
;= >
using 
( 
var 
dr 
= 
await  %
cmd& )
.) *
ExecuteReaderAsync* <
(< =
)= >
)> ?
{ 
if 
( 
await 
dr  
.  !
	ReadAsync! *
(* +
)+ ,
), -
{ 
objeto 
=  
new! $
ResumenCliente% 3
(3 4
)4 5
{   
PrestamosCliente!! ,
=!!- .
dr!!/ 1
[!!1 2
$str!!2 G
]!!G H
.!!H I
ToString!!I Q
(!!Q R
)!!R S
!!!S T
,!!T U"
PagosClientePendientes"" 2
=""3 4
dr""5 7
[""7 8
$str""8 J
]""J K
.""K L
ToString""L T
(""T U
)""U V
!""V W
,""W X
}## 
;## 
}$$ 
}%% 
}&& 
return'' 
objeto'' 
;'' 
}(( 	
}** 
}++ ¯ 
XC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Data\PrestamoData.cs
	namespace		 	
Prestamo		
 
.		 
Data		 
{

 
public 

class 
PrestamoData 
{ 
private 
readonly 
ConnectionStrings *
con+ .
;. /
public 
PrestamoData 
( 
IOptions $
<$ %
ConnectionStrings% 6
>6 7
options8 ?
)? @
{ 	
con 
= 
options 
. 
Value 
;  
} 	
public 
async 
Task 
< 
int 
> '
ObtenerIdPrestamoPorCliente :
(: ;
int; >
	idCliente? H
)H I
{ 	
int 

idPrestamo 
= 
$num 
; 
using 
( 
var 
conexion 
=  !
new" %
SqlConnection& 3
(3 4
con4 7
.7 8
	CadenaSQL8 A
)A B
)B C
{ 
await 
conexion 
. 
	OpenAsync (
(( )
)) *
;* +

SqlCommand 
cmd 
=  
new! $

SqlCommand% /
(/ 0
$str0 P
,P Q
conexionR Z
)Z [
;[ \
cmd 
. 

Parameters 
. 
AddWithValue +
(+ ,
$str, 8
,8 9
	idCliente: C
)C D
;D E
cmd 
. 
CommandType 
=  !
CommandType" -
.- .
StoredProcedure. =
;= >
using 
( 
var 
dr 
= 
await  %
cmd& )
.) *
ExecuteReaderAsync* <
(< =
)= >
)> ?
{ 
if   
(   
await   
dr    
.    !
	ReadAsync  ! *
(  * +
)  + ,
)  , -
{!! 

idPrestamo"" "
=""# $
Convert""% ,
."", -
ToInt32""- 4
(""4 5
dr""5 7
[""7 8
$str""8 D
]""D E
)""E F
;""F G
}## 
}$$ 
}%% 
return&& 

idPrestamo&& 
;&& 
}'' 	
public)) 
async)) 
Task)) 
<)) 
string))  
>))  !
Crear))" '
())' (
Prestamo))( 0
.))0 1
	Entidades))1 :
.)): ;
Prestamo)); C
objeto))D J
)))J K
{** 	
string,, 
	respuesta,, 
=,, 
$str,, !
;,,! "
using-- 
(-- 
var-- 
conexion-- 
=--  !
new--" %
SqlConnection--& 3
(--3 4
con--4 7
.--7 8
	CadenaSQL--8 A
)--A B
)--B C
{.. 
await// 
conexion// 
.// 
	OpenAsync// (
(//( )
)//) *
;//* +

SqlCommand00 
cmd00 
=00  
new00! $

SqlCommand00% /
(00/ 0
$str000 B
,00B C
conexion00D L
)00L M
;00M N
cmd11 
.11 

Parameters11 
.11 
AddWithValue11 +
(11+ ,
$str11, 8
,118 9
objeto11: @
.11@ A
Cliente11A H
.11H I
	IdCliente11I R
)11R S
;11S T
cmd22 
.22 

Parameters22 
.22 
AddWithValue22 +
(22+ ,
$str22, ;
,22; <
objeto22= C
.22C D
Cliente22D K
.22K L
NroDocumento22L X
)22X Y
;22Y Z
cmd33 
.33 

Parameters33 
.33 
AddWithValue33 +
(33+ ,
$str33, 5
,335 6
objeto337 =
.33= >
Cliente33> E
.33E F
Nombre33F L
)33L M
;33M N
cmd44 
.44 

Parameters44 
.44 
AddWithValue44 +
(44+ ,
$str44, 7
,447 8
objeto449 ?
.44? @
Cliente44@ G
.44G H
Apellido44H P
)44P Q
;44Q R
cmd55 
.55 

Parameters55 
.55 
AddWithValue55 +
(55+ ,
$str55, 5
,555 6
objeto557 =
.55= >
Cliente55> E
.55E F
Correo55F L
)55L M
;55M N
cmd66 
.66 

Parameters66 
.66 
AddWithValue66 +
(66+ ,
$str66, 7
,667 8
objeto669 ?
.66? @
Cliente66@ G
.66G H
Telefono66H P
)66P Q
;66Q R
cmd77 
.77 

Parameters77 
.77 
AddWithValue77 +
(77+ ,
$str77, 7
,777 8
objeto779 ?
.77? @
Moneda77@ F
.77F G
IdMoneda77G O
)77O P
;77P Q
cmd88 
.88 

Parameters88 
.88 
AddWithValue88 +
(88+ ,
$str88, :
,88: ;
objeto88< B
.88B C
FechaInicioPago88C R
)88R S
;88S T
cmd99 
.99 

Parameters99 
.99 
AddWithValue99 +
(99+ ,
$str99, <
,99< =
objeto99> D
.99D E
MontoPrestamo99E R
)99R S
;99S T
cmd:: 
.:: 

Parameters:: 
.:: 
AddWithValue:: +
(::+ ,
$str::, @
,::@ A
objeto::B H
.::H I
InteresPorcentaje::I Z
)::Z [
;::[ \
cmd;; 
.;; 

Parameters;; 
.;; 
AddWithValue;; +
(;;+ ,
$str;;, 8
,;;8 9
objeto;;: @
.;;@ A
	NroCuotas;;A J
);;J K
;;;K L
cmd<< 
.<< 

Parameters<< 
.<< 
AddWithValue<< +
(<<+ ,
$str<<, :
,<<: ;
objeto<<< B
.<<B C
FormaDePago<<C N
)<<N O
;<<O P
cmd== 
.== 

Parameters== 
.== 
AddWithValue== +
(==+ ,
$str==, <
,==< =
objeto==> D
.==D E
ValorPorCuota==E R
)==R S
;==S T
cmd>> 
.>> 

Parameters>> 
.>> 
AddWithValue>> +
(>>+ ,
$str>>, ;
,>>; <
objeto>>= C
.>>C D
ValorInteres>>D P
)>>P Q
;>>Q R
cmd?? 
.?? 

Parameters?? 
.?? 
AddWithValue?? +
(??+ ,
$str??, 9
,??9 :
objeto??; A
.??A B

ValorTotal??B L
)??L M
;??M N
cmd@@ 
.@@ 

Parameters@@ 
.@@ 
Add@@ "
(@@" #
$str@@# .
,@@. /
	SqlDbType@@0 9
.@@9 :
VarChar@@: A
,@@A B
$num@@C F
)@@F G
.@@G H
	Direction@@H Q
=@@R S
ParameterDirection@@T f
.@@f g
Output@@g m
;@@m n
cmdAA 
.AA 
CommandTypeAA 
=AA  !
CommandTypeAA" -
.AA- .
StoredProcedureAA. =
;AA= >
tryCC 
{DD 
awaitEE 
cmdEE 
.EE  
ExecuteNonQueryAsyncEE 2
(EE2 3
)EE3 4
;EE4 5
	respuestaFF 
=FF 
ConvertFF  '
.FF' (
ToStringFF( 0
(FF0 1
cmdFF1 4
.FF4 5

ParametersFF5 ?
[FF? @
$strFF@ K
]FFK L
.FFL M
ValueFFM R
)FFR S
!FFS T
;FFT U
}GG 
catchHH 
{II 
	respuestaJJ 
=JJ 
$strJJ  3
;JJ3 4
}KK 
}LL 
returnMM 
	respuestaMM 
;MM 
}NN 	
publicPP 
asyncPP 
TaskPP 
<PP 
ListPP 
<PP 
PrestamoPP '
.PP' (
	EntidadesPP( 1
.PP1 2
PrestamoPP2 :
>PP: ;
>PP; <
ObtenerPrestamosPP= M
(PPM N
intPPN Q
IdPPR T
,PPT U
stringPPV \
NroDocumentoPP] i
)PPi j
{QQ 	
ListRR 
<RR 
PrestamoRR 
.RR 
	EntidadesRR #
.RR# $
PrestamoRR$ ,
>RR, -
listaRR. 3
=RR4 5
newRR6 9
ListRR: >
<RR> ?
PrestamoRR? G
.RRG H
	EntidadesRRH Q
.RRQ R
PrestamoRRR Z
>RRZ [
(RR[ \
)RR\ ]
;RR] ^
usingTT 
(TT 
varTT 
conexionTT 
=TT  !
newTT" %
SqlConnectionTT& 3
(TT3 4
conTT4 7
.TT7 8
	CadenaSQLTT8 A
)TTA B
)TTB C
{UU 
awaitVV 
conexionVV 
.VV 
	OpenAsyncVV (
(VV( )
)VV) *
;VV* +

SqlCommandWW 
cmdWW 
=WW  
newWW! $

SqlCommandWW% /
(WW/ 0
$strWW0 E
,WWE F
conexionWWG O
)WWO P
;WWP Q
cmdXX 
.XX 

ParametersXX 
.XX 
AddWithValueXX +
(XX+ ,
$strXX, 9
,XX9 :
IdXX; =
)XX= >
;XX> ?
cmdYY 
.YY 

ParametersYY 
.YY 
AddWithValueYY +
(YY+ ,
$strYY, ;
,YY; <
NroDocumentoYY= I
)YYI J
;YYJ K
cmdZZ 
.ZZ 
CommandTypeZZ 
=ZZ  !
CommandTypeZZ" -
.ZZ- .
StoredProcedureZZ. =
;ZZ= >
using\\ 
(\\ 
var\\ 
dr\\ 
=\\ 
await\\  %
cmd\\& )
.\\) *!
ExecuteXmlReaderAsync\\* ?
(\\? @
)\\@ A
)\\A B
{]] 
if^^ 
(^^ 
await^^ 
dr^^  
.^^  !
	ReadAsync^^! *
(^^* +
)^^+ ,
)^^, -
{__ 
	XDocument`` !
doc``" %
=``& '
	XDocument``( 1
.``1 2
Load``2 6
(``6 7
dr``7 9
)``9 :
;``: ;
listaaa 
=aa 
(aa  !
(aa! "
docaa" %
.aa% &
Elementsaa& .
(aa. /
$straa/ :
)aa: ;
)aa; <
!=aa= ?
nullaa@ D
)aaD E
?aaF G
(aaH I
fromaaI M
prestamoaaN V
inaaW Y
docaaZ ]
.aa] ^
Elementaa^ e
(aae f
$straaf q
)aaq r
!aar s
.aas t
Elementsaat |
(aa| }
$str	aa} á
)
aaá à
selectbbM S
newbbT W
PrestamobbX `
.bb` a
	Entidadesbba j
.bbj k
Prestamobbk s
(bbs t
)bbt u
{ccM N

IdPrestamoddQ [
=dd\ ]
Convertdd^ e
.dde f
ToInt32ddf m
(ddm n
prestamoddn v
.ddv w
Elementddw ~
(dd~ 
$str	dd ã
)
ddã å
!
ddå ç
.
ddç é
Value
ddé ì
)
ddì î
,
ddî ï
ClienteeeQ X
=eeY Z
newee[ ^
Clienteee_ f
(eef g
)eeg h
{ffQ R
	IdClienteggU ^
=gg_ `
Convertgga h
.ggh i
ToInt32ggi p
(ggp q
prestamoggq y
.ggy z
Element	ggz Å
(
ggÅ Ç
$str
ggÇ ç
)
ggç é
!
ggé è
.
ggè ê
Value
ggê ï
)
ggï ñ
,
ggñ ó
NroDocumentohhU a
=hhb c
prestamohhd l
.hhl m
Elementhhm t
(hht u
$str	hhu É
)
hhÉ Ñ
!
hhÑ Ö
.
hhÖ Ü
Value
hhÜ ã
,
hhã å
NombreiiU [
=ii\ ]
prestamoii^ f
.iif g
Elementiig n
(iin o
$striio w
)iiw x
!iix y
.iiy z
Valueiiz 
,	ii Ä
ApellidojjU ]
=jj^ _
prestamojj` h
.jjh i
Elementjji p
(jjp q
$strjjq {
)jj{ |
!jj| }
.jj} ~
Value	jj~ É
,
jjÉ Ñ
CorreokkU [
=kk\ ]
prestamokk^ f
.kkf g
Elementkkg n
(kkn o
$strkko w
)kkw x
!kkx y
.kky z
Valuekkz 
,	kk Ä
TelefonollU ]
=ll^ _
prestamoll` h
.llh i
Elementlli p
(llp q
$strllq {
)ll{ |
!ll| }
.ll} ~
Value	ll~ É
}mmQ R
,mmR S
MonedannQ W
=nnX Y
newnnZ ]
Monedann^ d
{ooQ R
IdMonedappU ]
=pp^ _
Convertpp` g
.ppg h
ToInt32pph o
(ppo p
prestamoppp x
.ppx y
Element	ppy Ä
(
ppÄ Å
$str
ppÅ ã
)
ppã å
!
ppå ç
.
ppç é
Value
ppé ì
)
ppì î
,
ppî ï
NombreqqU [
=qq\ ]
prestamoqq^ f
.qqf g
Elementqqg n
(qqn o
$strqqo }
)qq} ~
!qq~ 
.	qq Ä
Value
qqÄ Ö
,
qqÖ Ü
SimbolorrU \
=rr] ^
prestamorr_ g
.rrg h
Elementrrh o
(rro p
$strrrp y
)rry z
!rrz {
.rr{ |
Value	rr| Å
}ssQ R
,ssR S
FechaInicioPagottQ `
=tta b
prestamottc k
.ttk l
Elementttl s
(tts t
$str	ttt Ö
)
ttÖ Ü
!
ttÜ á
.
ttá à
Value
ttà ç
,
ttç é
MontoPrestamouuQ ^
=uu_ `
prestamouua i
.uui j
Elementuuj q
(uuq r
$str	uur Å
)
uuÅ Ç
!
uuÇ É
.
uuÉ Ñ
Value
uuÑ â
,
uuâ ä
InteresPorcentajevvQ b
=vvc d
prestamovve m
.vvm n
Elementvvn u
(vvu v
$str	vvv â
)
vvâ ä
!
vvä ã
.
vvã å
Value
vvå ë
,
vvë í
	NroCuotaswwQ Z
=ww[ \
Convertww] d
.wwd e
ToInt32wwe l
(wwl m
prestamowwm u
.wwu v
Elementwwv }
(ww} ~
$str	ww~ â
)
wwâ ä
!
wwä ã
.
wwã å
Value
wwå ë
)
wwë í
,
wwí ì
FormaDePagoxxQ \
=xx] ^
prestamoxx_ g
.xxg h
Elementxxh o
(xxo p
$strxxp }
)xx} ~
!xx~ 
.	xx Ä
Value
xxÄ Ö
,
xxÖ Ü
ValorPorCuotayyQ ^
=yy_ `
prestamoyya i
.yyi j
Elementyyj q
(yyq r
$str	yyr Å
)
yyÅ Ç
!
yyÇ É
.
yyÉ Ñ
Value
yyÑ â
,
yyâ ä
ValorIntereszzQ ]
=zz^ _
prestamozz` h
.zzh i
Elementzzi p
(zzp q
$strzzq 
)	zz Ä
!
zzÄ Å
.
zzÅ Ç
Value
zzÇ á
,
zzá à

ValorTotal{{Q [
={{\ ]
prestamo{{^ f
.{{f g
Element{{g n
({{n o
$str{{o {
){{{ |
!{{| }
.{{} ~
Value	{{~ É
,
{{É Ñ
Estado||Q W
=||X Y
prestamo||Z b
.||b c
Element||c j
(||j k
$str||k s
)||s t
!||t u
.||u v
Value||v {
,||{ |
FechaCreacion}}Q ^
=}}_ `
prestamo}}a i
.}}i j
Element}}j q
(}}q r
$str	}}r Å
)
}}Å Ç
!
}}Ç É
.
}}É Ñ
Value
}}Ñ â
,
}}â ä
PrestamoDetalle~~Q `
=~~a b
prestamo~~c k
.~~k l
Elements~~l t
(~~t u
$str	~~u Ü
)
~~Ü á
!=
~~à ä
null
~~ã è
?
~~ê ë
(
~~í ì
from
~~ì ó
detalle
~~ò ü
in
~~† ¢
prestamo
~~£ ´
.
~~´ ¨
Element
~~¨ ≥
(
~~≥ ¥
$str
~~¥ ≈
)
~~≈ ∆
!
~~∆ «
.
~~« »
Elements
~~» –
(
~~– —
$str
~~— ⁄
)
~~⁄ €
select
å í
new
ì ñ
PrestamoDetalle
ó ¶
(
¶ ß
)
ß ®
{ÄÄå ç!
IdPrestamoDetalleÅÅê °
=ÅÅ¢ £
ConvertÅÅ§ ´
.ÅÅ´ ¨
ToInt32ÅÅ¨ ≥
(ÅÅ≥ ¥
detalleÅÅ¥ ª
.ÅÅª º
ElementÅÅº √
(ÅÅ√ ƒ
$strÅÅƒ ◊
)ÅÅ◊ ÿ
!ÅÅÿ Ÿ
.ÅÅŸ ⁄
ValueÅÅ⁄ ﬂ
)ÅÅﬂ ‡
,ÅÅ‡ ·
	FechaPagoÇÇê ô
=ÇÇö õ
detalleÇÇú £
.ÇÇ£ §
ElementÇÇ§ ´
(ÇÇ´ ¨
$strÇÇ¨ ∑
)ÇÇ∑ ∏
!ÇÇ∏ π
.ÇÇπ ∫
ValueÇÇ∫ ø
,ÇÇø ¿

MontoCuotaÉÉê ö
=ÉÉõ ú
detalleÉÉù §
.ÉÉ§ •
ElementÉÉ• ¨
(ÉÉ¨ ≠
$strÉÉ≠ π
)ÉÉπ ∫
!ÉÉ∫ ª
.ÉÉª º
ValueÉÉº ¡
,ÉÉ¡ ¬
NroCuotaÑÑê ò
=ÑÑô ö
ConvertÑÑõ ¢
.ÑÑ¢ £
ToInt32ÑÑ£ ™
(ÑÑ™ ´
detalleÑÑ´ ≤
.ÑÑ≤ ≥
ElementÑÑ≥ ∫
(ÑÑ∫ ª
$strÑÑª ≈
)ÑÑ≈ ∆
!ÑÑ∆ «
.ÑÑ« »
ValueÑÑ» Õ
)ÑÑÕ Œ
,ÑÑŒ œ
EstadoÖÖê ñ
=ÖÖó ò
detalleÖÖô †
.ÖÖ† °
ElementÖÖ° ®
(ÖÖ® ©
$strÖÖ© ±
)ÖÖ± ≤
!ÖÖ≤ ≥
.ÖÖ≥ ¥
ValueÖÖ¥ π
,ÖÖπ ∫
FechaPagadoÜÜê õ
=ÜÜú ù
detalleÜÜû •
.ÜÜ• ¶
ElementÜÜ¶ ≠
(ÜÜ≠ Æ
$strÜÜÆ ª
)ÜÜª º
!ÜÜº Ω
.ÜÜΩ æ
ValueÜÜæ √
}ááå ç
)ááç é
.ááé è
ToListááè ï
(ááï ñ
)ááñ ó
:ááò ô
newááö ù
Listááû ¢
<áá¢ £
PrestamoDetalleáá£ ≤
>áá≤ ≥
(áá≥ ¥
)áá¥ µ
}
ââM N
)
ââN O
.
ââO P
ToList
ââP V
(
ââV W
)
ââW X
:
ââY Z
new
ââ[ ^
List
ââ_ c
<
ââc d
Prestamo
ââd l
.
ââl m
	Entidades
ââm v
.
ââv w
Prestamo
ââw 
>ââ Ä
(ââÄ Å
)ââÅ Ç
;ââÇ É
}
ãã 
}
åå 
}
çç 
return
éé 
lista
éé 
;
éé 
}
èè 	
public
íí 
async
íí 
Task
íí 
<
íí 
List
íí 
<
íí 
Prestamo
íí '
.
íí' (
	Entidades
íí( 1
.
íí1 2
Prestamo
íí2 :
>
íí: ;
>
íí; <
ObtenerPrestamos2
íí= N
(
ííN O
int
ííO R
Id
ííS U
,
ííU V
string
ííW ]
NroDocumento
íí^ j
)
ííj k
{
ìì 	
List
îî 
<
îî 
Prestamo
îî 
.
îî 
	Entidades
îî #
.
îî# $
Prestamo
îî$ ,
>
îî, -
lista
îî. 3
=
îî4 5
new
îî6 9
List
îî: >
<
îî> ?
Prestamo
îî? G
.
îîG H
	Entidades
îîH Q
.
îîQ R
Prestamo
îîR Z
>
îîZ [
(
îî[ \
)
îî\ ]
;
îî] ^
using
ññ 
(
ññ 
var
ññ 
conexion
ññ 
=
ññ  !
new
ññ" %
SqlConnection
ññ& 3
(
ññ3 4
con
ññ4 7
.
ññ7 8
	CadenaSQL
ññ8 A
)
ññA B
)
ññB C
{
óó 
await
òò 
conexion
òò 
.
òò 
	OpenAsync
òò (
(
òò( )
)
òò) *
;
òò* +

SqlCommand
ôô 
cmd
ôô 
=
ôô  
new
ôô! $

SqlCommand
ôô% /
(
ôô/ 0
$str
ôô0 F
,
ôôF G
conexion
ôôH P
)
ôôP Q
;
ôôQ R
cmd
öö 
.
öö 

Parameters
öö 
.
öö 
AddWithValue
öö +
(
öö+ ,
$str
öö, 9
,
öö9 :
Id
öö; =
)
öö= >
;
öö> ?
cmd
õõ 
.
õõ 

Parameters
õõ 
.
õõ 
AddWithValue
õõ +
(
õõ+ ,
$str
õõ, ;
,
õõ; <
NroDocumento
õõ= I
)
õõI J
;
õõJ K
cmd
úú 
.
úú 
CommandType
úú 
=
úú  !
CommandType
úú" -
.
úú- .
StoredProcedure
úú. =
;
úú= >
using
ûû 
(
ûû 
var
ûû 
dr
ûû 
=
ûû 
await
ûû  %
cmd
ûû& )
.
ûû) *#
ExecuteXmlReaderAsync
ûû* ?
(
ûû? @
)
ûû@ A
)
ûûA B
{
üü 
if
†† 
(
†† 
await
†† 
dr
††  
.
††  !
	ReadAsync
††! *
(
††* +
)
††+ ,
)
††, -
{
°° 
	XDocument
¢¢ !
doc
¢¢" %
=
¢¢& '
	XDocument
¢¢( 1
.
¢¢1 2
Load
¢¢2 6
(
¢¢6 7
dr
¢¢7 9
)
¢¢9 :
;
¢¢: ;
lista
££ 
=
££ 
(
££  !
(
££! "
doc
££" %
.
££% &
Elements
££& .
(
££. /
$str
££/ :
)
££: ;
)
££; <
!=
££= ?
null
££@ D
)
££D E
?
££F G
(
££H I
from
££I M
prestamo
££N V
in
££W Y
doc
££Z ]
.
££] ^
Element
££^ e
(
££e f
$str
££f q
)
££q r
!
££r s
.
££s t
Elements
££t |
(
££| }
$str££} á
)££á à
select
§§I O
new
§§P S
Prestamo
§§T \
.
§§\ ]
	Entidades
§§] f
.
§§f g
Prestamo
§§g o
(
§§o p
)
§§p q
{
••I J

IdPrestamo
¶¶M W
=
¶¶X Y
Convert
¶¶Z a
.
¶¶a b
ToInt32
¶¶b i
(
¶¶i j
prestamo
¶¶j r
.
¶¶r s
Element
¶¶s z
(
¶¶z {
$str¶¶{ á
)¶¶á à
!¶¶à â
.¶¶â ä
Value¶¶ä è
)¶¶è ê
,¶¶ê ë
Cliente
ßßM T
=
ßßU V
new
ßßW Z
Cliente
ßß[ b
(
ßßb c
)
ßßc d
{
®®M N
	IdCliente
©©Q Z
=
©©[ \
Convert
©©] d
.
©©d e
ToInt32
©©e l
(
©©l m
prestamo
©©m u
.
©©u v
Element
©©v }
(
©©} ~
$str©©~ â
)©©â ä
!©©ä ã
.©©ã å
Value©©å ë
)©©ë í
,©©í ì
NroDocumento
™™Q ]
=
™™^ _
prestamo
™™` h
.
™™h i
Element
™™i p
(
™™p q
$str
™™q 
)™™ Ä
!™™Ä Å
.™™Å Ç
Value™™Ç á
,™™á à
Nombre
´´Q W
=
´´X Y
prestamo
´´Z b
.
´´b c
Element
´´c j
(
´´j k
$str
´´k s
)
´´s t
!
´´t u
.
´´u v
Value
´´v {
,
´´{ |
Apellido
¨¨Q Y
=
¨¨Z [
prestamo
¨¨\ d
.
¨¨d e
Element
¨¨e l
(
¨¨l m
$str
¨¨m w
)
¨¨w x
!
¨¨x y
.
¨¨y z
Value
¨¨z 
,¨¨ Ä
Correo
≠≠Q W
=
≠≠X Y
prestamo
≠≠Z b
.
≠≠b c
Element
≠≠c j
(
≠≠j k
$str
≠≠k s
)
≠≠s t
!
≠≠t u
.
≠≠u v
Value
≠≠v {
,
≠≠{ |
Telefono
ÆÆQ Y
=
ÆÆZ [
prestamo
ÆÆ\ d
.
ÆÆd e
Element
ÆÆe l
(
ÆÆl m
$str
ÆÆm w
)
ÆÆw x
!
ÆÆx y
.
ÆÆy z
Value
ÆÆz 
}
ØØM N
,
ØØN O
Moneda
∞∞M S
=
∞∞T U
new
∞∞V Y
Moneda
∞∞Z `
{
±±M N
IdMoneda
≤≤Q Y
=
≤≤Z [
Convert
≤≤\ c
.
≤≤c d
ToInt32
≤≤d k
(
≤≤k l
prestamo
≤≤l t
.
≤≤t u
Element
≤≤u |
(
≤≤| }
$str≤≤} á
)≤≤á à
!≤≤à â
.≤≤â ä
Value≤≤ä è
)≤≤è ê
,≤≤ê ë
Nombre
≥≥Q W
=
≥≥X Y
prestamo
≥≥Z b
.
≥≥b c
Element
≥≥c j
(
≥≥j k
$str
≥≥k y
)
≥≥y z
!
≥≥z {
.
≥≥{ |
Value≥≥| Å
,≥≥Å Ç
Simbolo
¥¥Q X
=
¥¥Y Z
prestamo
¥¥[ c
.
¥¥c d
Element
¥¥d k
(
¥¥k l
$str
¥¥l u
)
¥¥u v
!
¥¥v w
.
¥¥w x
Value
¥¥x }
}
µµM N
,
µµN O
FechaInicioPago
∂∂M \
=
∂∂] ^
prestamo
∂∂_ g
.
∂∂g h
Element
∂∂h o
(
∂∂o p
$str∂∂p Å
)∂∂Å Ç
!∂∂Ç É
.∂∂É Ñ
Value∂∂Ñ â
,∂∂â ä
MontoPrestamo
∑∑M Z
=
∑∑[ \
prestamo
∑∑] e
.
∑∑e f
Element
∑∑f m
(
∑∑m n
$str
∑∑n }
)
∑∑} ~
!
∑∑~ 
.∑∑ Ä
Value∑∑Ä Ö
,∑∑Ö Ü
InteresPorcentaje
∏∏M ^
=
∏∏_ `
prestamo
∏∏a i
.
∏∏i j
Element
∏∏j q
(
∏∏q r
$str∏∏r Ö
)∏∏Ö Ü
!∏∏Ü á
.∏∏á à
Value∏∏à ç
,∏∏ç é
	NroCuotas
ππM V
=
ππW X
Convert
ππY `
.
ππ` a
ToInt32
ππa h
(
ππh i
prestamo
ππi q
.
ππq r
Element
ππr y
(
ππy z
$strππz Ö
)ππÖ Ü
!ππÜ á
.ππá à
Valueππà ç
)ππç é
,ππé è
FormaDePago
∫∫M X
=
∫∫Y Z
prestamo
∫∫[ c
.
∫∫c d
Element
∫∫d k
(
∫∫k l
$str
∫∫l y
)
∫∫y z
!
∫∫z {
.
∫∫{ |
Value∫∫| Å
,∫∫Å Ç
ValorPorCuota
ªªM Z
=
ªª[ \
prestamo
ªª] e
.
ªªe f
Element
ªªf m
(
ªªm n
$str
ªªn }
)
ªª} ~
!
ªª~ 
.ªª Ä
ValueªªÄ Ö
,ªªÖ Ü
ValorInteres
ººM Y
=
ººZ [
prestamo
ºº\ d
.
ººd e
Element
ººe l
(
ººl m
$str
ººm {
)
ºº{ |
!
ºº| }
.
ºº} ~
Valueºº~ É
,ººÉ Ñ

ValorTotal
ΩΩM W
=
ΩΩX Y
prestamo
ΩΩZ b
.
ΩΩb c
Element
ΩΩc j
(
ΩΩj k
$str
ΩΩk w
)
ΩΩw x
!
ΩΩx y
.
ΩΩy z
Value
ΩΩz 
,ΩΩ Ä
Estado
ææM S
=
ææT U
prestamo
ææV ^
.
ææ^ _
Element
ææ_ f
(
ææf g
$str
ææg o
)
ææo p
!
ææp q
.
ææq r
Value
æær w
,
ææw x
FechaCreacion
øøM Z
=
øø[ \
prestamo
øø] e
.
øøe f
Element
øøf m
(
øøm n
$str
øøn }
)
øø} ~
!
øø~ 
.øø Ä
ValueøøÄ Ö
,øøÖ Ü
PrestamoDetalle
¿¿M \
=
¿¿] ^
prestamo
¿¿_ g
.
¿¿g h
Elements
¿¿h p
(
¿¿p q
$str¿¿q Ç
)¿¿Ç É
!=¿¿Ñ Ü
null¿¿á ã
?¿¿å ç
(¿¿é è
from¿¿è ì
detalle¿¿î õ
in¿¿ú û
prestamo¿¿ü ß
.¿¿ß ®
Element¿¿® Ø
(¿¿Ø ∞
$str¿¿∞ ¡
)¿¿¡ ¬
!¿¿¬ √
.¿¿√ ƒ
Elements¿¿ƒ Ã
(¿¿Ã Õ
$str¿¿Õ ÷
)¿¿÷ ◊
select¡¡è ï
new¡¡ñ ô
PrestamoDetalle¡¡ö ©
(¡¡© ™
)¡¡™ ´
{¬¬è ê!
IdPrestamoDetalle√√ì §
=√√• ¶
Convert√√ß Æ
.√√Æ Ø
ToInt32√√Ø ∂
(√√∂ ∑
detalle√√∑ æ
.√√æ ø
Element√√ø ∆
(√√∆ «
$str√√« ⁄
)√√⁄ €
!√√€ ‹
.√√‹ ›
Value√√› ‚
)√√‚ „
,√√„ ‰
	FechaPagoƒƒì ú
=ƒƒù û
detalleƒƒü ¶
.ƒƒ¶ ß
Elementƒƒß Æ
(ƒƒÆ Ø
$strƒƒØ ∫
)ƒƒ∫ ª
!ƒƒª º
.ƒƒº Ω
ValueƒƒΩ ¬
,ƒƒ¬ √

MontoCuota≈≈ì ù
=≈≈û ü
detalle≈≈† ß
.≈≈ß ®
Element≈≈® Ø
(≈≈Ø ∞
$str≈≈∞ º
)≈≈º Ω
!≈≈Ω æ
.≈≈æ ø
Value≈≈ø ƒ
,≈≈ƒ ≈
NroCuota∆∆ì õ
=∆∆ú ù
Convert∆∆û •
.∆∆• ¶
ToInt32∆∆¶ ≠
(∆∆≠ Æ
detalle∆∆Æ µ
.∆∆µ ∂
Element∆∆∂ Ω
(∆∆Ω æ
$str∆∆æ »
)∆∆» …
!∆∆…  
.∆∆  À
Value∆∆À –
)∆∆– —
,∆∆— “
Estado««ì ô
=««ö õ
detalle««ú £
.««£ §
Element««§ ´
(««´ ¨
$str««¨ ¥
)««¥ µ
!««µ ∂
.««∂ ∑
Value««∑ º
,««º Ω
FechaPagado»»ì û
=»»ü †
detalle»»° ®
.»»® ©
Element»»© ∞
(»»∞ ±
$str»»± æ
)»»æ ø
!»»ø ¿
.»»¿ ¡
Value»»¡ ∆
}……è ê
)……ê ë
.……ë í
ToList……í ò
(……ò ô
)……ô ö
:……õ ú
new……ù †
List……° •
<……• ¶
PrestamoDetalle……¶ µ
>……µ ∂
(……∂ ∑
)……∑ ∏
}
ÀÀI J
)
ÀÀJ K
.
ÀÀK L
ToList
ÀÀL R
(
ÀÀR S
)
ÀÀS T
:
ÀÀU V
new
ÀÀW Z
List
ÀÀ[ _
<
ÀÀ_ `
Prestamo
ÀÀ` h
.
ÀÀh i
	Entidades
ÀÀi r
.
ÀÀr s
Prestamo
ÀÀs {
>
ÀÀ{ |
(
ÀÀ| }
)
ÀÀ} ~
;
ÀÀ~ 
}
ÕÕ 
}
ŒŒ 
}
œœ 
return
–– 
lista
–– 
;
–– 
}
—— 	
public
”” 
async
”” 
Task
”” 
<
”” 
string
””  
>
””  !
PagarCuotas
””" -
(
””- .
int
””. 1

IdPrestamo
””2 <
,
””< =
string
””> D
NroCuotasPagadas
””E U
,
””U V
string
””W ]
NumeroTarjeta
””^ k
)
””k l
{
‘‘ 	
string
’’ 
	respuesta
’’ 
=
’’ 
$str
’’ !
;
’’! "
using
÷÷ 
(
÷÷ 
var
÷÷ 
conexion
÷÷ 
=
÷÷  !
new
÷÷" %
SqlConnection
÷÷& 3
(
÷÷3 4
con
÷÷4 7
.
÷÷7 8
	CadenaSQL
÷÷8 A
)
÷÷A B
)
÷÷B C
{
◊◊ 
await
ÿÿ 
conexion
ÿÿ 
.
ÿÿ 
	OpenAsync
ÿÿ (
(
ÿÿ( )
)
ÿÿ) *
;
ÿÿ* +

SqlCommand
ŸŸ 
cmd
ŸŸ 
=
ŸŸ  
new
ŸŸ! $

SqlCommand
ŸŸ% /
(
ŸŸ/ 0
$str
ŸŸ0 @
,
ŸŸ@ A
conexion
ŸŸB J
)
ŸŸJ K
;
ŸŸK L
cmd
⁄⁄ 
.
⁄⁄ 

Parameters
⁄⁄ 
.
⁄⁄ 
AddWithValue
⁄⁄ +
(
⁄⁄+ ,
$str
⁄⁄, 9
,
⁄⁄9 :

IdPrestamo
⁄⁄; E
)
⁄⁄E F
;
⁄⁄F G
cmd
€€ 
.
€€ 

Parameters
€€ 
.
€€ 
AddWithValue
€€ +
(
€€+ ,
$str
€€, ?
,
€€? @
NroCuotasPagadas
€€A Q
)
€€Q R
;
€€R S
cmd
‹‹ 
.
‹‹ 

Parameters
‹‹ 
.
‹‹ 
AddWithValue
‹‹ +
(
‹‹+ ,
$str
‹‹, <
,
‹‹< =
NumeroTarjeta
‹‹> K
)
‹‹K L
;
‹‹L M
cmd
›› 
.
›› 

Parameters
›› 
.
›› 
Add
›› "
(
››" #
$str
››# .
,
››. /
	SqlDbType
››0 9
.
››9 :
VarChar
››: A
,
››A B
$num
››C F
)
››F G
.
››G H
	Direction
››H Q
=
››R S 
ParameterDirection
››T f
.
››f g
Output
››g m
;
››m n
cmd
ﬁﬁ 
.
ﬁﬁ 
CommandType
ﬁﬁ 
=
ﬁﬁ  !
CommandType
ﬁﬁ" -
.
ﬁﬁ- .
StoredProcedure
ﬁﬁ. =
;
ﬁﬁ= >
try
‡‡ 
{
·· 
await
‚‚ 
cmd
‚‚ 
.
‚‚ "
ExecuteNonQueryAsync
‚‚ 2
(
‚‚2 3
)
‚‚3 4
;
‚‚4 5
	respuesta
„„ 
=
„„ 
Convert
„„  '
.
„„' (
ToString
„„( 0
(
„„0 1
cmd
„„1 4
.
„„4 5

Parameters
„„5 ?
[
„„? @
$str
„„@ K
]
„„K L
.
„„L M
Value
„„M R
)
„„R S
!
„„S T
;
„„T U
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ  
ex
ÂÂ! #
)
ÂÂ# $
{
ÊÊ 
	respuesta
ÁÁ 
=
ÁÁ 
$str
ÁÁ  5
+
ÁÁ6 7
ex
ÁÁ8 :
.
ÁÁ: ;
Message
ÁÁ; B
;
ÁÁB C
}
ËË 
}
ÈÈ 
return
ÍÍ 
	respuesta
ÍÍ 
;
ÍÍ 
}
ÎÎ 	
public
ÌÌ 
async
ÌÌ 
Task
ÌÌ 
<
ÌÌ 
bool
ÌÌ 
>
ÌÌ $
CrearSolicitudPrestamo
ÌÌ  6
(
ÌÌ6 7
SolicitudPrestamo
ÌÌ7 H
	solicitud
ÌÌI R
)
ÌÌR S
{
ÓÓ 	
using
ÔÔ 
(
ÔÔ 
var
ÔÔ 
conexion
ÔÔ 
=
ÔÔ  !
new
ÔÔ" %
SqlConnection
ÔÔ& 3
(
ÔÔ3 4
con
ÔÔ4 7
.
ÔÔ7 8
	CadenaSQL
ÔÔ8 A
)
ÔÔA B
)
ÔÔB C
{
 
await
ÒÒ 
conexion
ÒÒ 
.
ÒÒ 
	OpenAsync
ÒÒ (
(
ÒÒ( )
)
ÒÒ) *
;
ÒÒ* +
using
ÚÚ 
(
ÚÚ 

SqlCommand
ÚÚ !
cmd
ÚÚ" %
=
ÚÚ& '
new
ÚÚ( +

SqlCommand
ÚÚ, 6
(
ÚÚ6 7
$str
ÚÚ7 R
,
ÚÚR S
conexion
ÚÚT \
)
ÚÚ\ ]
)
ÚÚ] ^
{
ÛÛ 
cmd
ÙÙ 
.
ÙÙ 
CommandType
ÙÙ #
=
ÙÙ$ %
CommandType
ÙÙ& 1
.
ÙÙ1 2
StoredProcedure
ÙÙ2 A
;
ÙÙA B
cmd
˜˜ 
.
˜˜ 

Parameters
˜˜ "
.
˜˜" #
AddWithValue
˜˜# /
(
˜˜/ 0
$str
˜˜0 <
,
˜˜< =
	solicitud
˜˜> G
.
˜˜G H
	IdUsuario
˜˜H Q
)
˜˜Q R
;
˜˜R S
cmd
¯¯ 
.
¯¯ 

Parameters
¯¯ "
.
¯¯" #
AddWithValue
¯¯# /
(
¯¯/ 0
$str
¯¯0 8
,
¯¯8 9
	solicitud
¯¯: C
.
¯¯C D
Monto
¯¯D I
)
¯¯I J
;
¯¯J K
cmd
˘˘ 
.
˘˘ 

Parameters
˘˘ "
.
˘˘" #
AddWithValue
˘˘# /
(
˘˘/ 0
$str
˘˘0 8
,
˘˘8 9
	solicitud
˘˘: C
.
˘˘C D
Plazo
˘˘D I
)
˘˘I J
;
˘˘J K
cmd
˙˙ 
.
˙˙ 

Parameters
˙˙ "
.
˙˙" #
AddWithValue
˙˙# /
(
˙˙/ 0
$str
˙˙0 9
,
˙˙9 :
	solicitud
˙˙; D
.
˙˙D E
Estado
˙˙E K
)
˙˙K L
;
˙˙L M
cmd
˚˚ 
.
˚˚ 

Parameters
˚˚ "
.
˚˚" #
AddWithValue
˚˚# /
(
˚˚/ 0
$str
˚˚0 A
,
˚˚A B
	solicitud
˚˚C L
.
˚˚L M
FechaSolicitud
˚˚M [
)
˚˚[ \
;
˚˚\ ]
cmd
¸¸ 
.
¸¸ 

Parameters
¸¸ "
.
¸¸" #
AddWithValue
¸¸# /
(
¸¸/ 0
$str
¸¸0 9
,
¸¸9 :
	solicitud
¸¸; D
.
¸¸D E
Sueldo
¸¸E K
)
¸¸K L
;
¸¸L M
cmd
˝˝ 
.
˝˝ 

Parameters
˝˝ "
.
˝˝" #
AddWithValue
˝˝# /
(
˝˝/ 0
$str
˝˝0 ;
,
˝˝; <
	solicitud
˝˝= F
.
˝˝F G
EsCasado
˝˝G O
)
˝˝O P
;
˝˝P Q
cmd
˛˛ 
.
˛˛ 

Parameters
˛˛ "
.
˛˛" #
AddWithValue
˛˛# /
(
˛˛/ 0
$str
˛˛0 >
,
˛˛> ?
	solicitud
˛˛@ I
.
˛˛I J
NumeroHijos
˛˛J U
)
˛˛U V
;
˛˛V W
cmd
ˇˇ 
.
ˇˇ 

Parameters
ˇˇ "
.
ˇˇ" #
AddWithValue
ˇˇ# /
(
ˇˇ/ 0
$str
ˇˇ0 =
,
ˇˇ= >
	solicitud
ˇˇ? H
.
ˇˇH I

MetodoPago
ˇˇI S
)
ˇˇS T
;
ˇˇT U
cmd
ÄÄ 
.
ÄÄ 

Parameters
ÄÄ "
.
ÄÄ" #
AddWithValue
ÄÄ# /
(
ÄÄ/ 0
$str
ÄÄ0 9
,
ÄÄ9 :
	solicitud
ÄÄ; D
.
ÄÄD E
Cedula
ÄÄE K
)
ÄÄK L
;
ÄÄL M
cmd
ÅÅ 
.
ÅÅ 

Parameters
ÅÅ "
.
ÅÅ" #
AddWithValue
ÅÅ# /
(
ÅÅ/ 0
$str
ÅÅ0 <
,
ÅÅ< =
	solicitud
ÅÅ> G
.
ÅÅG H
	Ocupacion
ÅÅH Q
)
ÅÅQ R
;
ÅÅR S
SqlParameter
ÑÑ  
outputParam
ÑÑ! ,
=
ÑÑ- .
new
ÑÑ/ 2
SqlParameter
ÑÑ3 ?
(
ÑÑ? @
$str
ÑÑ@ K
,
ÑÑK L
	SqlDbType
ÑÑM V
.
ÑÑV W
NVarChar
ÑÑW _
,
ÑÑ_ `
$num
ÑÑa d
)
ÑÑd e
{
ÖÖ 
	Direction
ÜÜ !
=
ÜÜ" # 
ParameterDirection
ÜÜ$ 6
.
ÜÜ6 7
Output
ÜÜ7 =
}
áá 
;
áá 
cmd
àà 
.
àà 

Parameters
àà "
.
àà" #
Add
àà# &
(
àà& '
outputParam
àà' 2
)
àà2 3
;
àà3 4
await
ãã 
cmd
ãã 
.
ãã "
ExecuteNonQueryAsync
ãã 2
(
ãã2 3
)
ãã3 4
;
ãã4 5
string
éé 
mensajeError
éé '
=
éé( )
outputParam
éé* 5
.
éé5 6
Value
éé6 ;
.
éé; <
ToString
éé< D
(
ééD E
)
ééE F
;
ééF G
if
ëë 
(
ëë 
!
ëë 
string
ëë 
.
ëë  
IsNullOrEmpty
ëë  -
(
ëë- .
mensajeError
ëë. :
)
ëë: ;
)
ëë; <
{
íí 
throw
ìì 
new
ìì !
	Exception
ìì" +
(
ìì+ ,
mensajeError
ìì, 8
)
ìì8 9
;
ìì9 :
}
îî 
return
ññ 
true
ññ 
;
ññ  
}
óó 
}
òò 
}
ôô 	
public
õõ 
async
õõ 
Task
õõ 
<
õõ 
List
õõ 
<
õõ 
SolicitudPrestamo
õõ 0
>
õõ0 1
>
õõ1 2*
ObtenerSolicitudesPendientes
õõ3 O
(
õõO P
)
õõP Q
{
úú 	
List
ùù 
<
ùù 
SolicitudPrestamo
ùù "
>
ùù" #
solicitudes
ùù$ /
=
ùù0 1
new
ùù2 5
List
ùù6 :
<
ùù: ;
SolicitudPrestamo
ùù; L
>
ùùL M
(
ùùM N
)
ùùN O
;
ùùO P
using
üü 
(
üü 
var
üü 
conexion
üü 
=
üü  !
new
üü" %
SqlConnection
üü& 3
(
üü3 4
con
üü4 7
.
üü7 8
	CadenaSQL
üü8 A
)
üüA B
)
üüB C
{
†† 
await
°° 
conexion
°° 
.
°° 
	OpenAsync
°° (
(
°°( )
)
°°) *
;
°°* +

SqlCommand
¢¢ 
cmd
¢¢ 
=
¢¢  
new
¢¢! $

SqlCommand
¢¢% /
(
¢¢/ 0
$str
¢¢0 Q
,
¢¢Q R
conexion
¢¢S [
)
¢¢[ \
;
¢¢\ ]
cmd
££ 
.
££ 
CommandType
££ 
=
££  !
CommandType
££" -
.
££- .
StoredProcedure
££. =
;
££= >
using
•• 
(
•• 
var
•• 
dr
•• 
=
•• 
await
••  %
cmd
••& )
.
••) * 
ExecuteReaderAsync
••* <
(
••< =
)
••= >
)
••> ?
{
¶¶ 
while
ßß 
(
ßß 
await
ßß  
dr
ßß! #
.
ßß# $
	ReadAsync
ßß$ -
(
ßß- .
)
ßß. /
)
ßß/ 0
{
®® 
solicitudes
©© #
.
©©# $
Add
©©$ '
(
©©' (
new
©©( +
SolicitudPrestamo
©©, =
{
™™ 
Id
´´ 
=
´´  
Convert
´´! (
.
´´( )
ToInt32
´´) 0
(
´´0 1
dr
´´1 3
[
´´3 4
$str
´´4 8
]
´´8 9
)
´´9 :
,
´´: ;
	IdUsuario
¨¨ %
=
¨¨& '
Convert
¨¨( /
.
¨¨/ 0
ToInt32
¨¨0 7
(
¨¨7 8
dr
¨¨8 :
[
¨¨: ;
$str
¨¨; F
]
¨¨F G
)
¨¨G H
,
¨¨H I
Monto
≠≠ !
=
≠≠" #
Convert
≠≠$ +
.
≠≠+ ,
	ToDecimal
≠≠, 5
(
≠≠5 6
dr
≠≠6 8
[
≠≠8 9
$str
≠≠9 @
]
≠≠@ A
)
≠≠A B
,
≠≠B C
Plazo
ÆÆ !
=
ÆÆ" #
Convert
ÆÆ$ +
.
ÆÆ+ ,
ToInt32
ÆÆ, 3
(
ÆÆ3 4
dr
ÆÆ4 6
[
ÆÆ6 7
$str
ÆÆ7 >
]
ÆÆ> ?
)
ÆÆ? @
,
ÆÆ@ A
Estado
ØØ "
=
ØØ# $
dr
ØØ% '
[
ØØ' (
$str
ØØ( 0
]
ØØ0 1
.
ØØ1 2
ToString
ØØ2 :
(
ØØ: ;
)
ØØ; <
,
ØØ< =
FechaSolicitud
∞∞ *
=
∞∞+ ,
Convert
∞∞- 4
.
∞∞4 5

ToDateTime
∞∞5 ?
(
∞∞? @
dr
∞∞@ B
[
∞∞B C
$str
∞∞C S
]
∞∞S T
)
∞∞T U
,
∞∞U V
Sueldo
±± "
=
±±# $
Convert
±±% ,
.
±±, -
	ToDecimal
±±- 6
(
±±6 7
dr
±±7 9
[
±±9 :
$str
±±: B
]
±±B C
)
±±C D
,
±±D E
EsCasado
≤≤ $
=
≤≤% &
Convert
≤≤' .
.
≤≤. /
	ToBoolean
≤≤/ 8
(
≤≤8 9
dr
≤≤9 ;
[
≤≤; <
$str
≤≤< F
]
≤≤F G
)
≤≤G H
,
≤≤H I
NumeroHijos
≥≥ '
=
≥≥( )
Convert
≥≥* 1
.
≥≥1 2
ToInt32
≥≥2 9
(
≥≥9 :
dr
≥≥: <
[
≥≥< =
$str
≥≥= J
]
≥≥J K
)
≥≥K L
,
≥≥L M

MetodoPago
¥¥ &
=
¥¥' (
dr
¥¥) +
[
¥¥+ ,
$str
¥¥, 8
]
¥¥8 9
.
¥¥9 :
ToString
¥¥: B
(
¥¥B C
)
¥¥C D
,
¥¥D E
Cedula
µµ "
=
µµ# $
dr
µµ% '
[
µµ' (
$str
µµ( 0
]
µµ0 1
.
µµ1 2
ToString
µµ2 :
(
µµ: ;
)
µµ; <
,
µµ< =
	Ocupacion
∂∂ %
=
∂∂& '
dr
∂∂( *
[
∂∂* +
$str
∂∂+ 6
]
∂∂6 7
.
∂∂7 8
ToString
∂∂8 @
(
∂∂@ A
)
∂∂A B
}
∑∑ 
)
∑∑ 
;
∑∑ 
}
∏∏ 
}
ππ 
}
∫∫ 
return
ªª 
solicitudes
ªª 
;
ªª 
}
ºº 	
public
ææ 
async
ææ 
Task
ææ 
<
ææ 
bool
ææ 
>
ææ '
ActualizarEstadoSolicitud
ææ  9
(
ææ9 :
int
ææ: =
id
ææ> @
,
ææ@ A
string
ææB H
estado
ææI O
)
ææO P
{
øø 	
try
¡¡ 
{
¬¬ 
using
√√ 
(
√√ 
var
√√ 
conexion
√√ #
=
√√$ %
new
√√& )
SqlConnection
√√* 7
(
√√7 8
con
√√8 ;
.
√√; <
	CadenaSQL
√√< E
)
√√E F
)
√√F G
{
ƒƒ 
await
≈≈ 
conexion
≈≈ "
.
≈≈" #
	OpenAsync
≈≈# ,
(
≈≈, -
)
≈≈- .
;
≈≈. /
Console
∆∆ 
.
∆∆ 
	WriteLine
∆∆ %
(
∆∆% &
estado
∆∆& ,
)
∆∆, -
;
∆∆- .

SqlCommand
«« 
cmd
«« "
=
««# $
new
««% (

SqlCommand
««) 3
(
««3 4
$str
««4 R
,
««R S
conexion
««T \
)
««\ ]
;
««] ^
cmd
»» 
.
»» 

Parameters
»» "
.
»»" #
AddWithValue
»»# /
(
»»/ 0
$str
»»0 5
,
»»5 6
id
»»7 9
)
»»9 :
;
»»: ;
cmd
…… 
.
…… 

Parameters
…… "
.
……" #
AddWithValue
……# /
(
……/ 0
$str
……0 9
,
……9 :
estado
……; A
)
……A B
;
……B C
cmd
   
.
   
CommandType
   #
=
  $ %
CommandType
  & 1
.
  1 2
StoredProcedure
  2 A
;
  A B
int
ÃÃ 
rowsAffected
ÃÃ $
=
ÃÃ% &
await
ÃÃ' ,
cmd
ÃÃ- 0
.
ÃÃ0 1"
ExecuteNonQueryAsync
ÃÃ1 E
(
ÃÃE F
)
ÃÃF G
;
ÃÃG H
return
ÕÕ 
rowsAffected
ÕÕ '
>
ÕÕ( )
$num
ÕÕ* +
;
ÕÕ+ ,
}
ŒŒ 
}
œœ 
catch
–– 
(
–– 
	Exception
–– 
ex
–– 
)
––  
{
—— 
return
““ 
false
““ 
;
““ 
}
”” 
}
‘‘ 	
public
÷÷ 
async
÷÷ 
Task
÷÷ 
<
÷÷ 
bool
÷÷ 
>
÷÷ &
CrearHistorialCrediticio
÷÷  8
(
÷÷8 9
Prestamo
÷÷9 A
.
÷÷A B
	Entidades
÷÷B K
.
÷÷K L!
HistorialCrediticio
÷÷L _
	historial
÷÷` i
)
÷÷i j
{
◊◊ 	
using
ÿÿ 
(
ÿÿ 
var
ÿÿ 
conexion
ÿÿ 
=
ÿÿ  !
new
ÿÿ" %
SqlConnection
ÿÿ& 3
(
ÿÿ3 4
con
ÿÿ4 7
.
ÿÿ7 8
	CadenaSQL
ÿÿ8 A
)
ÿÿA B
)
ÿÿB C
{
ŸŸ 
await
⁄⁄ 
conexion
⁄⁄ 
.
⁄⁄ 
	OpenAsync
⁄⁄ (
(
⁄⁄( )
)
⁄⁄) *
;
⁄⁄* +

SqlCommand
€€ 
cmd
€€ 
=
€€  
new
€€! $

SqlCommand
€€% /
(
€€/ 0
$str
€€0 M
,
€€M N
conexion
€€O W
)
€€W X
;
€€X Y
cmd
‹‹ 
.
‹‹ 

Parameters
‹‹ 
.
‹‹ 
AddWithValue
‹‹ +
(
‹‹+ ,
$str
‹‹, 8
,
‹‹8 9
	historial
‹‹: C
.
‹‹C D
	IdUsuario
‹‹D M
)
‹‹M N
;
‹‹N O
cmd
›› 
.
›› 

Parameters
›› 
.
›› 
AddWithValue
›› +
(
››+ ,
$str
››, ?
,
››? @
	historial
››A J
.
››J K
EstadoCrediticio
››K [
)
››[ \
;
››\ ]
cmd
ﬁﬁ 
.
ﬁﬁ 
CommandType
ﬁﬁ 
=
ﬁﬁ  !
CommandType
ﬁﬁ" -
.
ﬁﬁ- .
StoredProcedure
ﬁﬁ. =
;
ﬁﬁ= >
int
‡‡ 
rowsAffected
‡‡  
=
‡‡! "
await
‡‡# (
cmd
‡‡) ,
.
‡‡, -"
ExecuteNonQueryAsync
‡‡- A
(
‡‡A B
)
‡‡B C
;
‡‡C D
return
·· 
rowsAffected
·· #
>
··$ %
$num
··& '
;
··' (
}
‚‚ 
}
„„ 	
public
ÂÂ 
async
ÂÂ 
Task
ÂÂ 
<
ÂÂ 
bool
ÂÂ 
>
ÂÂ +
ActualizarHistorialCrediticio
ÂÂ  =
(
ÂÂ= >
int
ÂÂ> A
	idUsuario
ÂÂB K
,
ÂÂK L
bool
ÂÂM Q
aprobado
ÂÂR Z
)
ÂÂZ [
{
ÊÊ 	
using
ÁÁ 
(
ÁÁ 
var
ÁÁ 
conexion
ÁÁ 
=
ÁÁ  !
new
ÁÁ" %
SqlConnection
ÁÁ& 3
(
ÁÁ3 4
con
ÁÁ4 7
.
ÁÁ7 8
	CadenaSQL
ÁÁ8 A
)
ÁÁA B
)
ÁÁB C
{
ËË 
await
ÈÈ 
conexion
ÈÈ 
.
ÈÈ 
	OpenAsync
ÈÈ (
(
ÈÈ( )
)
ÈÈ) *
;
ÈÈ* +

SqlCommand
ÍÍ 
cmd
ÍÍ 
=
ÍÍ  
new
ÍÍ! $

SqlCommand
ÍÍ% /
(
ÍÍ/ 0
$str
ÍÍ0 R
,
ÍÍR S
conexion
ÍÍT \
)
ÍÍ\ ]
;
ÍÍ] ^
cmd
ÎÎ 
.
ÎÎ 

Parameters
ÎÎ 
.
ÎÎ 
AddWithValue
ÎÎ +
(
ÎÎ+ ,
$str
ÎÎ, 8
,
ÎÎ8 9
	idUsuario
ÎÎ: C
)
ÎÎC D
;
ÎÎD E
cmd
ÏÏ 
.
ÏÏ 

Parameters
ÏÏ 
.
ÏÏ 
AddWithValue
ÏÏ +
(
ÏÏ+ ,
$str
ÏÏ, 7
,
ÏÏ7 8
aprobado
ÏÏ9 A
)
ÏÏA B
;
ÏÏB C
cmd
ÌÌ 
.
ÌÌ 
CommandType
ÌÌ 
=
ÌÌ  !
CommandType
ÌÌ" -
.
ÌÌ- .
StoredProcedure
ÌÌ. =
;
ÌÌ= >
int
ÔÔ 
rowsAffected
ÔÔ  
=
ÔÔ! "
await
ÔÔ# (
cmd
ÔÔ) ,
.
ÔÔ, -"
ExecuteNonQueryAsync
ÔÔ- A
(
ÔÔA B
)
ÔÔB C
;
ÔÔC D
return
 
rowsAffected
 #
>
$ %
$num
& '
;
' (
}
ÒÒ 
}
ÚÚ 	
public
ÙÙ 
async
ÙÙ 
Task
ÙÙ 
<
ÙÙ !
HistorialCrediticio
ÙÙ -
>
ÙÙ- .(
ObtenerHistorialCrediticio
ÙÙ/ I
(
ÙÙI J
int
ÙÙJ M
	idUsuario
ÙÙN W
)
ÙÙW X
{
ıı 	
using
ˆˆ 
(
ˆˆ 
var
ˆˆ 
conexion
ˆˆ 
=
ˆˆ  !
new
ˆˆ" %
SqlConnection
ˆˆ& 3
(
ˆˆ3 4
con
ˆˆ4 7
.
ˆˆ7 8
	CadenaSQL
ˆˆ8 A
)
ˆˆA B
)
ˆˆB C
{
˜˜ 
await
¯¯ 
conexion
¯¯ 
.
¯¯ 
	OpenAsync
¯¯ (
(
¯¯( )
)
¯¯) *
;
¯¯* +

SqlCommand
˘˘ 
cmd
˘˘ 
=
˘˘  
new
˘˘! $

SqlCommand
˘˘% /
(
˘˘/ 0
$str
˘˘0 O
,
˘˘O P
conexion
˘˘Q Y
)
˘˘Y Z
;
˘˘Z [
cmd
˙˙ 
.
˙˙ 

Parameters
˙˙ 
.
˙˙ 
AddWithValue
˙˙ +
(
˙˙+ ,
$str
˙˙, 8
,
˙˙8 9
	idUsuario
˙˙: C
)
˙˙C D
;
˙˙D E
cmd
˚˚ 
.
˚˚ 
CommandType
˚˚ 
=
˚˚  !
CommandType
˚˚" -
.
˚˚- .
StoredProcedure
˚˚. =
;
˚˚= >
using
˝˝ 
(
˝˝ 
var
˝˝ 
dr
˝˝ 
=
˝˝ 
await
˝˝  %
cmd
˝˝& )
.
˝˝) * 
ExecuteReaderAsync
˝˝* <
(
˝˝< =
)
˝˝= >
)
˝˝> ?
{
˛˛ 
if
ˇˇ 
(
ˇˇ 
await
ˇˇ 
dr
ˇˇ  
.
ˇˇ  !
	ReadAsync
ˇˇ! *
(
ˇˇ* +
)
ˇˇ+ ,
)
ˇˇ, -
{
ÄÄ 
return
ÅÅ 
new
ÅÅ "!
HistorialCrediticio
ÅÅ# 6
{
ÇÇ 
	IdUsuario
ÉÉ %
=
ÉÉ& '
Convert
ÉÉ( /
.
ÉÉ/ 0
ToInt32
ÉÉ0 7
(
ÉÉ7 8
dr
ÉÉ8 :
[
ÉÉ: ;
$str
ÉÉ; F
]
ÉÉF G
)
ÉÉG H
,
ÉÉH I
EstadoCrediticio
ÑÑ ,
=
ÑÑ- .
Convert
ÑÑ/ 6
.
ÑÑ6 7
ToInt32
ÑÑ7 >
(
ÑÑ> ?
dr
ÑÑ? A
[
ÑÑA B
$str
ÑÑB T
]
ÑÑT U
)
ÑÑU V
}
ÖÖ 
;
ÖÖ 
}
ÜÜ 
}
áá 
}
àà 
return
ââ 
null
ââ 
;
ââ 
}
ää 	
public
åå 
async
åå 
Task
åå 
<
åå 
SolicitudPrestamo
åå +
>
åå+ ,#
ObtenerSolicitudPorId
åå- B
(
ååB C
int
ååC F
id
ååG I
)
ååI J
{
çç 	
using
éé 
(
éé 
var
éé 
conexion
éé 
=
éé  !
new
éé" %
SqlConnection
éé& 3
(
éé3 4
con
éé4 7
.
éé7 8
	CadenaSQL
éé8 A
)
ééA B
)
ééB C
{
èè 
await
êê 
conexion
êê 
.
êê 
	OpenAsync
êê (
(
êê( )
)
êê) *
;
êê* +

SqlCommand
ëë 
cmd
ëë 
=
ëë  
new
ëë! $

SqlCommand
ëë% /
(
ëë/ 0
$str
ëë0 J
,
ëëJ K
conexion
ëëL T
)
ëëT U
;
ëëU V
cmd
íí 
.
íí 

Parameters
íí 
.
íí 
AddWithValue
íí +
(
íí+ ,
$str
íí, 1
,
íí1 2
id
íí3 5
)
íí5 6
;
íí6 7
cmd
ìì 
.
ìì 
CommandType
ìì 
=
ìì  !
CommandType
ìì" -
.
ìì- .
StoredProcedure
ìì. =
;
ìì= >
using
ïï 
(
ïï 
var
ïï 
dr
ïï 
=
ïï 
await
ïï  %
cmd
ïï& )
.
ïï) * 
ExecuteReaderAsync
ïï* <
(
ïï< =
)
ïï= >
)
ïï> ?
{
ññ 
if
óó 
(
óó 
await
óó 
dr
óó  
.
óó  !
	ReadAsync
óó! *
(
óó* +
)
óó+ ,
)
óó, -
{
òò 
return
ôô 
new
ôô "
SolicitudPrestamo
ôô# 4
{
öö 
Id
õõ 
=
õõ  
Convert
õõ! (
.
õõ( )
ToInt32
õõ) 0
(
õõ0 1
dr
õõ1 3
[
õõ3 4
$str
õõ4 8
]
õõ8 9
)
õõ9 :
,
õõ: ;
	IdUsuario
úú %
=
úú& '
Convert
úú( /
.
úú/ 0
ToInt32
úú0 7
(
úú7 8
dr
úú8 :
[
úú: ;
$str
úú; F
]
úúF G
)
úúG H
,
úúH I
Monto
ùù !
=
ùù" #
Convert
ùù$ +
.
ùù+ ,
	ToDecimal
ùù, 5
(
ùù5 6
dr
ùù6 8
[
ùù8 9
$str
ùù9 @
]
ùù@ A
)
ùùA B
,
ùùB C
Plazo
ûû !
=
ûû" #
Convert
ûû$ +
.
ûû+ ,
ToInt32
ûû, 3
(
ûû3 4
dr
ûû4 6
[
ûû6 7
$str
ûû7 >
]
ûû> ?
)
ûû? @
,
ûû@ A
Estado
üü "
=
üü# $
dr
üü% '
[
üü' (
$str
üü( 0
]
üü0 1
.
üü1 2
ToString
üü2 :
(
üü: ;
)
üü; <
,
üü< =
FechaSolicitud
†† *
=
††+ ,
Convert
††- 4
.
††4 5

ToDateTime
††5 ?
(
††? @
dr
††@ B
[
††B C
$str
††C S
]
††S T
)
††T U
,
††U V
Sueldo
°° "
=
°°# $
Convert
°°% ,
.
°°, -
	ToDecimal
°°- 6
(
°°6 7
dr
°°7 9
[
°°9 :
$str
°°: B
]
°°B C
)
°°C D
,
°°D E
EsCasado
¢¢ $
=
¢¢% &
Convert
¢¢' .
.
¢¢. /
	ToBoolean
¢¢/ 8
(
¢¢8 9
dr
¢¢9 ;
[
¢¢; <
$str
¢¢< F
]
¢¢F G
)
¢¢G H
,
¢¢H I
NumeroHijos
££ '
=
££( )
Convert
££* 1
.
££1 2
ToInt32
££2 9
(
££9 :
dr
££: <
[
££< =
$str
££= J
]
££J K
)
££K L
,
££L M

MetodoPago
§§ &
=
§§' (
dr
§§) +
[
§§+ ,
$str
§§, 8
]
§§8 9
.
§§9 :
ToString
§§: B
(
§§B C
)
§§C D
,
§§D E
Cedula
•• "
=
••# $
dr
••% '
[
••' (
$str
••( 0
]
••0 1
.
••1 2
ToString
••2 :
(
••: ;
)
••; <
,
••< =
	Ocupacion
¶¶ %
=
¶¶& '
dr
¶¶( *
[
¶¶* +
$str
¶¶+ 6
]
¶¶6 7
.
¶¶7 8
ToString
¶¶8 @
(
¶¶@ A
)
¶¶A B
}
ßß 
;
ßß 
}
®® 
}
©© 
}
™™ 
return
´´ 
null
´´ 
;
´´ 
}
¨¨ 	
}
ÆÆ 
}ØØ ƒU
VC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Data\MonedaData.cs
	namespace 	
Prestamo
 
. 
Data 
{ 
public 

class 

MonedaData 
{		 
private

 
readonly

 
ConnectionStrings

 *
con

+ .
;

. /
public 

MonedaData 
( 
IOptions "
<" #
ConnectionStrings# 4
>4 5
options6 =
)= >
{ 	
con 
= 
options 
. 
Value 
;  
} 	
public 
async 
Task 
< 
List 
< 
Moneda %
>% &
>& '
Lista( -
(- .
). /
{ 	
List 
< 
Moneda 
> 
lista 
=  
new! $
List% )
<) *
Moneda* 0
>0 1
(1 2
)2 3
;3 4
using 
( 
var 
conexion 
=  !
new" %
SqlConnection& 3
(3 4
con4 7
.7 8
	CadenaSQL8 A
)A B
)B C
{ 
await 
conexion 
. 
	OpenAsync (
(( )
)) *
;* +

SqlCommand 
cmd 
=  
new! $

SqlCommand% /
(/ 0
$str0 @
,@ A
conexionB J
)J K
;K L
cmd 
. 
CommandType 
=  !
CommandType" -
.- .
StoredProcedure. =
;= >
using 
( 
var 
dr 
= 
await  %
cmd& )
.) *
ExecuteReaderAsync* <
(< =
)= >
)> ?
{ 
while 
( 
await  
dr! #
.# $
	ReadAsync$ -
(- .
). /
)/ 0
{ 
lista 
. 
Add !
(! "
new" %
Moneda& ,
(, -
)- .
{ 
IdMoneda   $
=  % &
Convert  ' .
.  . /
ToInt32  / 6
(  6 7
dr  7 9
[  9 :
$str  : D
]  D E
)  E F
,  F G
Nombre!! "
=!!# $
dr!!% '
[!!' (
$str!!( 0
]!!0 1
.!!1 2
ToString!!2 :
(!!: ;
)!!; <
!!!< =
,!!= >
Simbolo"" #
=""$ %
dr""& (
[""( )
$str"") 2
]""2 3
.""3 4
ToString""4 <
(""< =
)""= >
!""> ?
,""? @
FechaCreacion## )
=##* +
dr##, .
[##. /
$str##/ >
]##> ?
.##? @
ToString##@ H
(##H I
)##I J
!##J K
}$$ 
)$$ 
;$$ 
}%% 
}&& 
}'' 
return(( 
lista(( 
;(( 
})) 	
public++ 
async++ 
Task++ 
<++ 
string++  
>++  !
Crear++" '
(++' (
Moneda++( .
objeto++/ 5
)++5 6
{,, 	
string.. 
	respuesta.. 
=.. 
$str.. !
;..! "
using// 
(// 
var// 
conexion// 
=//  !
new//" %
SqlConnection//& 3
(//3 4
con//4 7
.//7 8
	CadenaSQL//8 A
)//A B
)//B C
{00 
await11 
conexion11 
.11 
	OpenAsync11 (
(11( )
)11) *
;11* +

SqlCommand22 
cmd22 
=22  
new22! $

SqlCommand22% /
(22/ 0
$str220 @
,22@ A
conexion22B J
)22J K
;22K L
cmd33 
.33 

Parameters33 
.33 
AddWithValue33 +
(33+ ,
$str33, 5
,335 6
objeto337 =
.33= >
Nombre33> D
)33D E
;33E F
cmd44 
.44 

Parameters44 
.44 
AddWithValue44 +
(44+ ,
$str44, 6
,446 7
objeto448 >
.44> ?
Simbolo44? F
)44F G
;44G H
cmd55 
.55 

Parameters55 
.55 
Add55 "
(55" #
$str55# .
,55. /
	SqlDbType550 9
.559 :
VarChar55: A
,55A B
$num55C F
)55F G
.55G H
	Direction55H Q
=55R S
ParameterDirection55T f
.55f g
Output55g m
;55m n
cmd66 
.66 
CommandType66 
=66  !
CommandType66" -
.66- .
StoredProcedure66. =
;66= >
try88 
{99 
await:: 
cmd:: 
.::  
ExecuteNonQueryAsync:: 2
(::2 3
)::3 4
;::4 5
	respuesta;; 
=;; 
Convert;;  '
.;;' (
ToString;;( 0
(;;0 1
cmd;;1 4
.;;4 5

Parameters;;5 ?
[;;? @
$str;;@ K
];;K L
.;;L M
Value;;M R
);;R S
!;;S T
;;;T U
}<< 
catch== 
{>> 
	respuesta?? 
=?? 
$str??  3
;??3 4
}@@ 
}AA 
returnBB 
	respuestaBB 
;BB 
}CC 	
publicEE 
asyncEE 
TaskEE 
<EE 
stringEE  
>EE  !
EditarEE" (
(EE( )
MonedaEE) /
objetoEE0 6
)EE6 7
{FF 	
stringHH 
	respuestaHH 
=HH 
$strHH !
;HH! "
usingII 
(II 
varII 
conexionII 
=II  !
newII" %
SqlConnectionII& 3
(II3 4
conII4 7
.II7 8
	CadenaSQLII8 A
)IIA B
)IIB C
{JJ 
awaitKK 
conexionKK 
.KK 
	OpenAsyncKK (
(KK( )
)KK) *
;KK* +

SqlCommandLL 
cmdLL 
=LL  
newLL! $

SqlCommandLL% /
(LL/ 0
$strLL0 A
,LLA B
conexionLLC K
)LLK L
;LLL M
cmdMM 
.MM 

ParametersMM 
.MM 
AddWithValueMM +
(MM+ ,
$strMM, 7
,MM7 8
objetoMM9 ?
.MM? @
IdMonedaMM@ H
)MMH I
;MMI J
cmdNN 
.NN 

ParametersNN 
.NN 
AddWithValueNN +
(NN+ ,
$strNN, 5
,NN5 6
objetoNN7 =
.NN= >
NombreNN> D
)NND E
;NNE F
cmdOO 
.OO 

ParametersOO 
.OO 
AddWithValueOO +
(OO+ ,
$strOO, 6
,OO6 7
objetoOO8 >
.OO> ?
SimboloOO? F
)OOF G
;OOG H
cmdPP 
.PP 

ParametersPP 
.PP 
AddPP "
(PP" #
$strPP# .
,PP. /
	SqlDbTypePP0 9
.PP9 :
VarCharPP: A
,PPA B
$numPPC F
)PPF G
.PPG H
	DirectionPPH Q
=PPR S
ParameterDirectionPPT f
.PPf g
OutputPPg m
;PPm n
cmdQQ 
.QQ 
CommandTypeQQ 
=QQ  !
CommandTypeQQ" -
.QQ- .
StoredProcedureQQ. =
;QQ= >
trySS 
{TT 
awaitUU 
cmdUU 
.UU  
ExecuteNonQueryAsyncUU 2
(UU2 3
)UU3 4
;UU4 5
	respuestaVV 
=VV 
ConvertVV  '
.VV' (
ToStringVV( 0
(VV0 1
cmdVV1 4
.VV4 5

ParametersVV5 ?
[VV? @
$strVV@ K
]VVK L
.VVL M
ValueVVM R
)VVR S
!VVS T
;VVT U
}WW 
catchXX 
{YY 
	respuestaZZ 
=ZZ 
$strZZ  3
;ZZ3 4
}[[ 
}\\ 
return]] 
	respuesta]] 
;]] 
}^^ 	
public`` 
async`` 
Task`` 
<`` 
string``  
>``  !
Eliminar``" *
(``* +
int``+ .
Id``/ 1
)``1 2
{aa 	
stringcc 
	respuestacc 
=cc 
$strcc !
;cc! "
usingdd 
(dd 
vardd 
conexiondd 
=dd  !
newdd" %
SqlConnectiondd& 3
(dd3 4
condd4 7
.dd7 8
	CadenaSQLdd8 A
)ddA B
)ddB C
{ee 
awaitff 
conexionff 
.ff 
	OpenAsyncff (
(ff( )
)ff) *
;ff* +

SqlCommandgg 
cmdgg 
=gg  
newgg! $

SqlCommandgg% /
(gg/ 0
$strgg0 C
,ggC D
conexionggE M
)ggM N
;ggN O
cmdhh 
.hh 

Parametershh 
.hh 
AddWithValuehh +
(hh+ ,
$strhh, 7
,hh7 8
Idhh9 ;
)hh; <
;hh< =
cmdii 
.ii 

Parametersii 
.ii 
Addii "
(ii" #
$strii# .
,ii. /
	SqlDbTypeii0 9
.ii9 :
VarCharii: A
,iiA B
$numiiC F
)iiF G
.iiG H
	DirectioniiH Q
=iiR S
ParameterDirectioniiT f
.iif g
Outputiig m
;iim n
cmdjj 
.jj 
CommandTypejj 
=jj  !
CommandTypejj" -
.jj- .
StoredProcedurejj. =
;jj= >
tryll 
{mm 
awaitnn 
cmdnn 
.nn  
ExecuteNonQueryAsyncnn 2
(nn2 3
)nn3 4
;nn4 5
	respuestaoo 
=oo 
Convertoo  '
.oo' (
ToStringoo( 0
(oo0 1
cmdoo1 4
.oo4 5

Parametersoo5 ?
[oo? @
$stroo@ K
]ooK L
.ooL M
ValueooM R
)ooR S
!ooS T
;ooT U
}pp 
catchqq 
{rr 
	respuestass 
=ss 
$strss  3
;ss3 4
}tt 
}uu 
returnvv 
	respuestavv 
;vv 
}ww 	
}xx 
}yy œ
XC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Data\EmailService.cs
	namespace

 	
Prestamo


 
.

 
Data

 
{ 
public 

class 
EmailService 
{ 
private 
readonly 
SmtpSettings %
_smtpSettings& 3
;3 4
public 
EmailService 
( 
IOptions $
<$ %
SmtpSettings% 1
>1 2
smtpSettings3 ?
)? @
{ 	
_smtpSettings 
= 
smtpSettings (
.( )
Value) .
;. /
} 	
public 
async 
Task 
EnviarCorreoAsync +
(+ ,
string, 2
destinatario3 ?
,? @
stringA G
asuntoH N
,N O
stringP V
mensajeW ^
)^ _
{ 	
using 
( 
var 
client 
= 
new  #

SmtpClient$ .
(. /
_smtpSettings/ <
.< =
Host= A
,A B
_smtpSettingsC P
.P Q
PortQ U
)U V
{ 
Credentials 
= 
new !
NetworkCredential" 3
(3 4
_smtpSettings4 A
.A B
UserNameB J
,J K
_smtpSettingsL Y
.Y Z
PasswordZ b
)b c
,c d
	EnableSsl 
= 
_smtpSettings )
.) *
	EnableSsl* 3
} 
) 
{ 
var 
mailMessage 
=  !
new" %
MailMessage& 1
{ 
From 
= 
new 
MailAddress *
(* +
_smtpSettings+ 8
.8 9
UserName9 A
)A B
,B C
Subject   
=   
asunto   $
,  $ %
Body!! 
=!! 
mensaje!! "
,!!" #

IsBodyHtml"" 
=""  
true""! %
}## 
;## 
mailMessage$$ 
.$$ 
To$$ 
.$$ 
Add$$ "
($$" #
destinatario$$# /
)$$/ 0
;$$0 1
await&& 
client&& 
.&& 
SendMailAsync&& *
(&&* +
mailMessage&&+ 6
)&&6 7
;&&7 8
}'' 
}(( 	
})) 
public++ 

class++ 
SmtpSettings++ 
{,, 
public-- 
string-- 
Host-- 
{-- 
get--  
;--  !
set--" %
;--% &
}--' (
=--) *
null--+ /
!--/ 0
;--0 1
public.. 
int.. 
Port.. 
{.. 
get.. 
;.. 
set.. "
;.." #
}..$ %
public// 
bool// 
	EnableSsl// 
{// 
get//  #
;//# $
set//% (
;//( )
}//* +
public00 
string00 
UserName00 
{00  
get00! $
;00$ %
set00& )
;00) *
}00+ ,
=00- .
null00/ 3
!003 4
;004 5
public11 
string11 
Password11 
{11  
get11! $
;11$ %
set11& )
;11) *
}11+ ,
=11- .
null11/ 3
!113 4
;114 5
}22 
}33 ÁN
VC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Data\CuentaData.cs
	namespace		 	
Prestamo		
 
.		 
Data		 
{

 
public 

class 

CuentaData 
{ 
private 
readonly 
ConnectionStrings *
con+ .
;. /
private 
readonly 
string 
encryptionKey  -
=. /
$str0 R
;R S
public 

CuentaData 
( 
IOptions "
<" #
ConnectionStrings# 4
>4 5
options6 =
)= >
{ 	
con 
= 
options 
. 
Value 
;  
} 	
private 
string 
Decrypt 
( 
string %

cipherText& 0
)0 1
{ 	
try 
{ 
var 

fullCipher 
=  
Convert! (
.( )
FromBase64String) 9
(9 :

cipherText: D
)D E
;E F
if 
( 

fullCipher 
. 
Length %
<& '
$num( *
)* +
{ 
throw 
new 
ArgumentException /
(/ 0
$str0 H
)H I
;I J
} 
using   
(   
var   
aes   
=    
Aes  ! $
.  $ %
Create  % +
(  + ,
)  , -
)  - .
{!! 
byte## 
[## 
]## 
iv## 
=## 
new##  #
byte##$ (
[##( )
$num##) +
]##+ ,
;##, -
Array$$ 
.$$ 
Copy$$ 
($$ 

fullCipher$$ )
,$$) *
$num$$+ ,
,$$, -
iv$$. 0
,$$0 1
$num$$2 3
,$$3 4
iv$$5 7
.$$7 8
Length$$8 >
)$$> ?
;$$? @
byte'' 
['' 
]'' 
cipher'' !
=''" #
new''$ '
byte''( ,
['', -

fullCipher''- 7
.''7 8
Length''8 >
-''? @
iv''A C
.''C D
Length''D J
]''J K
;''K L
Array(( 
.(( 
Copy(( 
((( 

fullCipher(( )
,(() *
iv((+ -
.((- .
Length((. 4
,((4 5
cipher((6 <
,((< =
$num((> ?
,((? @
cipher((A G
.((G H
Length((H N
)((N O
;((O P
byte++ 
[++ 
]++ 
key++ 
=++  
Encoding++! )
.++) *
UTF8++* .
.++. /
GetBytes++/ 7
(++7 8
encryptionKey++8 E
)++E F
;++F G
Array,, 
.,, 
Resize,,  
(,,  !
ref,,! $
key,,% (
,,,( )
$num,,* ,
),,, -
;,,- .
aes.. 
... 
Key.. 
=.. 
key.. !
;..! "
aes// 
.// 
IV// 
=// 
iv// 
;//  
using22 
(22 
var22 
	decryptor22 (
=22) *
aes22+ .
.22. /
CreateDecryptor22/ >
(22> ?
aes22? B
.22B C
Key22C F
,22F G
aes22H K
.22K L
IV22L N
)22N O
)22O P
using33 
(33 
var33 
ms33 !
=33" #
new33$ '
MemoryStream33( 4
(334 5
cipher335 ;
)33; <
)33< =
using44 
(44 
var44 
cs44 !
=44" #
new44$ '
CryptoStream44( 4
(444 5
ms445 7
,447 8
	decryptor449 B
,44B C
CryptoStreamMode44D T
.44T U
Read44U Y
)44Y Z
)44Z [
using55 
(55 
var55 
sr55 !
=55" #
new55$ '
StreamReader55( 4
(554 5
cs555 7
)557 8
)558 9
{66 
return77 
sr77 !
.77! "
	ReadToEnd77" +
(77+ ,
)77, -
;77- .
}88 
}99 
}:: 
catch;; 
(;; 
	Exception;; 
ex;; 
);;  
{<< 
return>> 
string>> 
.>> 
Empty>> #
;>># $
}?? 
}@@ 	
publicAA 
asyncAA 
TaskAA 
<AA 
CuentaAA  
>AA  !
ObtenerCuentaAA" /
(AA/ 0
intAA0 3
	idClienteAA4 =
)AA= >
{BB 	
CuentaCC 
cuentaCC 
=CC 
newCC 
CuentaCC  &
(CC& '
)CC' (
;CC( )
usingEE 
(EE 
varEE 
conexionEE 
=EE  !
newEE" %
SqlConnectionEE& 3
(EE3 4
conEE4 7
.EE7 8
	CadenaSQLEE8 A
)EEA B
)EEB C
{FF 
awaitGG 
conexionGG 
.GG 
	OpenAsyncGG (
(GG( )
)GG) *
;GG* +

SqlCommandHH 
cmdHH 
=HH  
newHH! $

SqlCommandHH% /
(HH/ 0
$strHH0 B
,HHB C
conexionHHD L
)HHL M
;HHM N
cmdII 
.II 

ParametersII 
.II 
AddWithValueII +
(II+ ,
$strII, 8
,II8 9
	idClienteII: C
)IIC D
;IID E
cmdJJ 
.JJ 
CommandTypeJJ 
=JJ  !
CommandTypeJJ" -
.JJ- .
StoredProcedureJJ. =
;JJ= >
usingLL 
(LL 
varLL 
drLL 
=LL 
awaitLL  %
cmdLL& )
.LL) *
ExecuteReaderAsyncLL* <
(LL< =
)LL= >
)LL> ?
{MM 
whileNN 
(NN 
awaitNN  
drNN! #
.NN# $
	ReadAsyncNN$ -
(NN- .
)NN. /
)NN/ 0
{OO 
cuentaPP 
=PP  
newPP! $
CuentaPP% +
(PP+ ,
)PP, -
{QQ 
IdCuentaRR $
=RR% &
ConvertRR' .
.RR. /
ToInt32RR/ 6
(RR6 7
drRR7 9
[RR9 :
$strRR: D
]RRD E
)RRE F
,RRF G
	IdClienteSS %
=SS& '
ConvertSS( /
.SS/ 0
ToInt32SS0 7
(SS7 8
drSS8 :
[SS: ;
$strSS; F
]SSF G
)SSG H
,SSH I
TarjetaTT #
=TT$ %
DecryptTT& -
(TT- .
drTT. 0
[TT0 1
$strTT1 :
]TT: ;
.TT; <
ToStringTT< D
(TTD E
)TTE F
!TTF G
)TTG H
,TTH I
MontoYY !
=YY" #
ConvertYY$ +
.YY+ ,
	ToDecimalYY, 5
(YY5 6
drYY6 8
[YY8 9
$strYY9 @
]YY@ A
)YYA B
}ZZ 
;ZZ 
;ZZ 
}[[ 
}\\ 
}]] 
return^^ 
cuenta^^ 
;^^ 
}__ 	
public`` 
async`` 
Task`` 
<`` 
string``  
>``  !
	Depositar``" +
(``+ ,
int``, /
	idCliente``0 9
,``9 :
decimal``; B
monto``C H
)``H I
{aa 	
stringbb 
	respuestabb 
=bb 
$strbb !
;bb! "
usingcc 
(cc 
varcc 
conexioncc 
=cc  !
newcc" %
SqlConnectioncc& 3
(cc3 4
concc4 7
.cc7 8
	CadenaSQLcc8 A
)ccA B
)ccB C
{dd 
awaitee 
conexionee 
.ee 
	OpenAsyncee (
(ee( )
)ee) *
;ee* +

SqlCommandff 
cmdff 
=ff  
newff! $

SqlCommandff% /
(ff/ 0
$strff0 D
,ffD E
conexionffF N
)ffN O
;ffO P
cmdgg 
.gg 

Parametersgg 
.gg 
AddWithValuegg +
(gg+ ,
$strgg, 8
,gg8 9
	idClientegg: C
)ggC D
;ggD E
cmdhh 
.hh 

Parametershh 
.hh 
AddWithValuehh +
(hh+ ,
$strhh, 4
,hh4 5
montohh6 ;
)hh; <
;hh< =
cmdii 
.ii 

Parametersii 
.ii 
Addii "
(ii" #
$strii# .
,ii. /
	SqlDbTypeii0 9
.ii9 :
VarCharii: A
,iiA B
$numiiC F
)iiF G
.iiG H
	DirectioniiH Q
=iiR S
ParameterDirectioniiT f
.iif g
Outputiig m
;iim n
cmdjj 
.jj 
CommandTypejj 
=jj  !
CommandTypejj" -
.jj- .
StoredProcedurejj. =
;jj= >
tryll 
{mm 
awaitnn 
cmdnn 
.nn  
ExecuteNonQueryAsyncnn 2
(nn2 3
)nn3 4
;nn4 5
	respuestaoo 
=oo 
Convertoo  '
.oo' (
ToStringoo( 0
(oo0 1
cmdoo1 4
.oo4 5

Parametersoo5 ?
[oo? @
$stroo@ K
]ooK L
.ooL M
ValueooM R
)ooR S
!ooS T
;ooT U
}pp 
catchqq 
{rr 
	respuestass 
=ss 
$strss  3
;ss3 4
}tt 
}uu 
returnvv 
	respuestavv 
;vv 
}ww 	
}xx 
}yy Ö
]C:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Data\ConnectionStrings.cs
	namespace 	
Prestamo
 
. 
Data 
{ 
public		 

class		 
ConnectionStrings		 "
{

 
public 
string 
	CadenaSQL 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
null0 4
!4 5
;5 6
} 
} è√
WC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Data\ClienteData.cs
	namespace 	
Prestamo
 
. 
Data 
{		 
public

 

class

 
ClienteData

 
{ 
private 
readonly 
ConnectionStrings *
con+ .
;. /
private 
readonly 
UsuarioData $
usuarioData% 0
;0 1
private 
readonly 
EmailService %
emailService& 2
;2 3
private 
readonly 
string 
encryptionKey  -
=. /
$str0 R
;R S
public 
ClienteData 
( 
IOptions #
<# $
ConnectionStrings$ 5
>5 6
options7 >
,> ?
UsuarioData@ K
usuarioDataL W
,W X
EmailServiceY e
emailServicef r
)r s
{ 	
con 
= 
options 
. 
Value 
;  
this 
. 
usuarioData 
= 
usuarioData *
;* +
this 
. 
emailService 
= 
emailService  ,
;, -
} 	
private 
string 
Encrypt 
( 
string %
	plainText& /
)/ 0
{ 	
using 
( 
var 
aes 
= 
Aes  
.  !
Create! '
(' (
)( )
)) *
{ 
byte 
[ 
] 
key 
= 
Encoding %
.% &
UTF8& *
.* +
GetBytes+ 3
(3 4
encryptionKey4 A
)A B
;B C
Array 
. 
Resize 
( 
ref  
key! $
,$ %
$num& (
)( )
;) *
aes 
. 
Key 
= 
key 
; 
aes!! 
.!! 

GenerateIV!! 
(!! 
)!!  
;!!  !
byte"" 
["" 
]"" 
iv"" 
="" 
aes"" 
.""  
IV""  "
;""" #
using$$ 
($$ 
var$$ 
	encryptor$$ $
=$$% &
aes$$' *
.$$* +
CreateEncryptor$$+ :
($$: ;
aes$$; >
.$$> ?
Key$$? B
,$$B C
aes$$D G
.$$G H
IV$$H J
)$$J K
)$$K L
using%% 
(%% 
var%% 
ms%% 
=%% 
new%%  #
MemoryStream%%$ 0
(%%0 1
)%%1 2
)%%2 3
{&& 
ms(( 
.(( 
Write(( 
((( 
iv(( 
,((  
$num((! "
,((" #
iv(($ &
.((& '
Length((' -
)((- .
;((. /
using)) 
()) 
var)) 
cs)) !
=))" #
new))$ '
CryptoStream))( 4
())4 5
ms))5 7
,))7 8
	encryptor))9 B
,))B C
CryptoStreamMode))D T
.))T U
Write))U Z
)))Z [
)))[ \
using** 
(** 
var** 
sw** !
=**" #
new**$ '
StreamWriter**( 4
(**4 5
cs**5 7
)**7 8
)**8 9
{++ 
sw,, 
.,, 
Write,,  
(,,  !
	plainText,,! *
),,* +
;,,+ ,
}-- 
return.. 
Convert.. "
..." #
ToBase64String..# 1
(..1 2
ms..2 4
...4 5
ToArray..5 <
(..< =
)..= >
)..> ?
;..? @
}// 
}00 
}11 	
public44 
async44 
Task44 
<44 
List44 
<44 
Cliente44 &
>44& '
>44' (
Lista44) .
(44. /
)44/ 0
{55 	
List66 
<66 
Cliente66 
>66 
lista66 
=66  !
new66" %
List66& *
<66* +
Cliente66+ 2
>662 3
(663 4
)664 5
;665 6
using88 
(88 
var88 
conexion88 
=88  !
new88" %
SqlConnection88& 3
(883 4
con884 7
.887 8
	CadenaSQL888 A
)88A B
)88B C
{99 
await:: 
conexion:: 
.:: 
	OpenAsync:: (
(::( )
)::) *
;::* +

SqlCommand;; 
cmd;; 
=;;  
new;;! $

SqlCommand;;% /
(;;/ 0
$str;;0 A
,;;A B
conexion;;C K
);;K L
;;;L M
cmd<< 
.<< 
CommandType<< 
=<<  !
CommandType<<" -
.<<- .
StoredProcedure<<. =
;<<= >
using>> 
(>> 
var>> 
dr>> 
=>> 
await>>  %
cmd>>& )
.>>) *
ExecuteReaderAsync>>* <
(>>< =
)>>= >
)>>> ?
{?? 
while@@ 
(@@ 
await@@  
dr@@! #
.@@# $
	ReadAsync@@$ -
(@@- .
)@@. /
)@@/ 0
{AA 
listaBB 
.BB 
AddBB !
(BB! "
newBB" %
ClienteBB& -
(BB- .
)BB. /
{CC 
	IdClienteDD %
=DD& '
ConvertDD( /
.DD/ 0
ToInt32DD0 7
(DD7 8
drDD8 :
[DD: ;
$strDD; F
]DDF G
)DDG H
,DDH I
NroDocumentoEE (
=EE) *
drEE+ -
[EE- .
$strEE. <
]EE< =
.EE= >
ToStringEE> F
(EEF G
)EEG H
!EEH I
,EEI J
NombreFF "
=FF# $
drFF% '
[FF' (
$strFF( 0
]FF0 1
.FF1 2
ToStringFF2 :
(FF: ;
)FF; <
!FF< =
,FF= >
ApellidoGG $
=GG% &
drGG' )
[GG) *
$strGG* 4
]GG4 5
.GG5 6
ToStringGG6 >
(GG> ?
)GG? @
!GG@ A
,GGA B
CorreoHH "
=HH# $
drHH% '
[HH' (
$strHH( 0
]HH0 1
.HH1 2
ToStringHH2 :
(HH: ;
)HH; <
!HH< =
,HH= >
TelefonoII $
=II% &
drII' )
[II) *
$strII* 4
]II4 5
.II5 6
ToStringII6 >
(II> ?
)II? @
!II@ A
,IIA B
FechaCreacionJJ )
=JJ* +
drJJ, .
[JJ. /
$strJJ/ >
]JJ> ?
.JJ? @
ToStringJJ@ H
(JJH I
)JJI J
!JJJ K
}KK 
)KK 
;KK 
}LL 
}MM 
}NN 
returnOO 
listaOO 
;OO 
}PP 	
publicQQ 
asyncQQ 
TaskQQ 
<QQ 
ClienteQQ !
>QQ! "
ObtenerQQ# *
(QQ* +
stringQQ+ 1
NroDocumentoQQ2 >
)QQ> ?
{RR 	
ClienteSS 
objetoSS 
=SS 
newSS  
ClienteSS! (
(SS( )
)SS) *
;SS* +
usingUU 
(UU 
varUU 
conexionUU 
=UU  !
newUU" %
SqlConnectionUU& 3
(UU3 4
conUU4 7
.UU7 8
	CadenaSQLUU8 A
)UUA B
)UUB C
{VV 
awaitWW 
conexionWW 
.WW 
	OpenAsyncWW (
(WW( )
)WW) *
;WW* +

SqlCommandXX 
cmdXX 
=XX  
newXX! $

SqlCommandXX% /
(XX/ 0
$strXX0 C
,XXC D
conexionXXE M
)XXM N
;XXN O
cmdYY 
.YY 

ParametersYY 
.YY 
AddWithValueYY +
(YY+ ,
$strYY, ;
,YY; <
NroDocumentoYY= I
)YYI J
;YYJ K
cmdZZ 
.ZZ 
CommandTypeZZ 
=ZZ  !
CommandTypeZZ" -
.ZZ- .
StoredProcedureZZ. =
;ZZ= >
using\\ 
(\\ 
var\\ 
dr\\ 
=\\ 
await\\  %
cmd\\& )
.\\) *
ExecuteReaderAsync\\* <
(\\< =
)\\= >
)\\> ?
{]] 
while^^ 
(^^ 
await^^  
dr^^! #
.^^# $
	ReadAsync^^$ -
(^^- .
)^^. /
)^^/ 0
{__ 
objeto`` 
=``  
new``! $
Cliente``% ,
(``, -
)``- .
{aa 
	IdClientebb %
=bb& '
Convertbb( /
.bb/ 0
ToInt32bb0 7
(bb7 8
drbb8 :
[bb: ;
$strbb; F
]bbF G
)bbG H
,bbH I
NroDocumentocc (
=cc) *
drcc+ -
[cc- .
$strcc. <
]cc< =
.cc= >
ToStringcc> F
(ccF G
)ccG H
!ccH I
,ccI J
Nombredd "
=dd# $
drdd% '
[dd' (
$strdd( 0
]dd0 1
.dd1 2
ToStringdd2 :
(dd: ;
)dd; <
!dd< =
,dd= >
Apellidoee $
=ee% &
dree' )
[ee) *
$stree* 4
]ee4 5
.ee5 6
ToStringee6 >
(ee> ?
)ee? @
!ee@ A
,eeA B
Correoff "
=ff# $
drff% '
[ff' (
$strff( 0
]ff0 1
.ff1 2
ToStringff2 :
(ff: ;
)ff; <
!ff< =
,ff= >
Telefonogg $
=gg% &
drgg' )
[gg) *
$strgg* 4
]gg4 5
.gg5 6
ToStringgg6 >
(gg> ?
)gg? @
!gg@ A
,ggA B
FechaCreacionhh )
=hh* +
drhh, .
[hh. /
$strhh/ >
]hh> ?
.hh? @
ToStringhh@ H
(hhH I
)hhI J
!hhJ K
}ii 
;ii 
}jj 
}kk 
}ll 
returnmm 
objetomm 
;mm 
}nn 	
privatepp 
stringpp 
GenerarTarjetapp %
(pp% &
)pp& '
{qq 	
usingrr 
(rr 
varrr 
rngrr 
=rr !
RandomNumberGeneratorrr 2
.rr2 3
Createrr3 9
(rr9 :
)rr: ;
)rr; <
{ss 
vartt 
bytestt 
=tt 
newtt 
bytett  $
[tt$ %
$numtt% &
]tt& '
;tt' (
rnguu 
.uu 
GetBytesuu 
(uu 
bytesuu "
)uu" #
;uu# $
varvv 
buildervv 
=vv 
newvv !
StringBuildervv" /
(vv/ 0
)vv0 1
;vv1 2
foreachww 
(ww 
varww 
bww 
inww !
bytesww" '
)ww' (
{xx 
builderzz 
.zz 
Appendzz "
(zz" #
(zz# $
bzz$ %
%zz& '
$numzz( *
)zz* +
.zz+ ,
ToStringzz, 4
(zz4 5
)zz5 6
)zz6 7
;zz7 8
builder{{ 
.{{ 
Append{{ "
({{" #
({{# $
({{$ %
b{{% &
/{{' (
$num{{) +
){{+ ,
%{{- .
$num{{/ 1
){{1 2
.{{2 3
ToString{{3 ;
({{; <
){{< =
){{= >
;{{> ?
}|| 
return~~ 
builder~~ 
.~~ 
ToString~~ '
(~~' (
)~~( )
.~~) *
	Substring~~* 3
(~~3 4
$num~~4 5
,~~5 6
$num~~7 9
)~~9 :
;~~: ;
} 
}
ÄÄ 	
public
ÅÅ 
async
ÅÅ 
Task
ÅÅ 
<
ÅÅ 
string
ÅÅ  
>
ÅÅ  !
CrearCuenta
ÅÅ" -
(
ÅÅ- .
Cuenta
ÅÅ. 4
cuenta
ÅÅ5 ;
)
ÅÅ; <
{
ÇÇ 	
string
ÉÉ 
	respuesta
ÉÉ 
=
ÉÉ 
$str
ÉÉ !
;
ÉÉ! "
using
ÑÑ 
(
ÑÑ 
var
ÑÑ 
conexion
ÑÑ 
=
ÑÑ  !
new
ÑÑ" %
SqlConnection
ÑÑ& 3
(
ÑÑ3 4
con
ÑÑ4 7
.
ÑÑ7 8
	CadenaSQL
ÑÑ8 A
)
ÑÑA B
)
ÑÑB C
{
ÖÖ 
await
ÜÜ 
conexion
ÜÜ 
.
ÜÜ 
	OpenAsync
ÜÜ (
(
ÜÜ( )
)
ÜÜ) *
;
ÜÜ* +

SqlCommand
áá 
cmd
áá 
=
áá  
new
áá! $

SqlCommand
áá% /
(
áá/ 0
$str
áá0 @
,
áá@ A
conexion
ááB J
)
ááJ K
;
ááK L
cmd
àà 
.
àà 

Parameters
àà 
.
àà 
AddWithValue
àà +
(
àà+ ,
$str
àà, 8
,
àà8 9
cuenta
àà: @
.
àà@ A
	IdCliente
ààA J
)
ààJ K
;
ààK L
cmd
ââ 
.
ââ 

Parameters
ââ 
.
ââ 
Add
ââ "
(
ââ" #
$str
ââ# -
,
ââ- .
	SqlDbType
ââ/ 8
.
ââ8 9
VarChar
ââ9 @
,
ââ@ A
$num
ââB E
)
ââE F
.
ââF G
Value
ââG L
=
ââM N
Encrypt
ââO V
(
ââV W
cuenta
ââW ]
.
ââ] ^
Tarjeta
ââ^ e
)
ââe f
;
ââf g
Console
ää 
.
ää 
	WriteLine
ää !
(
ää! "
$str
ää" 8
+
ää9 :
Encrypt
ää; B
(
ääB C
cuenta
ääC I
.
ääI J
Tarjeta
ääJ Q
)
ääQ R
)
ääR S
;
ääS T
cmd
ãã 
.
ãã 

Parameters
ãã 
.
ãã 
AddWithValue
ãã +
(
ãã+ ,
$str
ãã, 4
,
ãã4 5
cuenta
ãã6 <
.
ãã< =
Monto
ãã= B
)
ããB C
;
ããC D
cmd
åå 
.
åå 

Parameters
åå 
.
åå 
Add
åå "
(
åå" #
$str
åå# .
,
åå. /
	SqlDbType
åå0 9
.
åå9 :
VarChar
åå: A
,
ååA B
$num
ååC F
)
ååF G
.
ååG H
	Direction
ååH Q
=
ååR S 
ParameterDirection
ååT f
.
ååf g
Output
ååg m
;
ååm n
cmd
çç 
.
çç 
CommandType
çç 
=
çç  !
CommandType
çç" -
.
çç- .
StoredProcedure
çç. =
;
çç= >
try
èè 
{
êê 
await
ëë 
cmd
ëë 
.
ëë "
ExecuteNonQueryAsync
ëë 2
(
ëë2 3
)
ëë3 4
;
ëë4 5
	respuesta
íí 
=
íí 
Convert
íí  '
.
íí' (
ToString
íí( 0
(
íí0 1
cmd
íí1 4
.
íí4 5

Parameters
íí5 ?
[
íí? @
$str
íí@ K
]
ííK L
.
ííL M
Value
ííM R
)
ííR S
!
ííS T
;
ííT U
}
ìì 
catch
îî 
{
ïï 
	respuesta
ññ 
=
ññ 
$str
ññ  3
;
ññ3 4
}
óó 
}
òò 
return
ôô 
	respuesta
ôô 
;
ôô 
}
öö 	
public
úú 
async
úú 
Task
úú 
<
úú 
string
úú  
>
úú  !
Crear
úú" '
(
úú' (
Cliente
úú( /
objeto
úú0 6
)
úú6 7
{
ùù 	
string
ûû 
	respuesta
ûû 
=
ûû 
$str
ûû !
;
ûû! "
using
üü 
(
üü 
var
üü 
conexion
üü 
=
üü  !
new
üü" %
SqlConnection
üü& 3
(
üü3 4
con
üü4 7
.
üü7 8
	CadenaSQL
üü8 A
)
üüA B
)
üüB C
{
†† 
await
°° 
conexion
°° 
.
°° 
	OpenAsync
°° (
(
°°( )
)
°°) *
;
°°* +

SqlCommand
¢¢ 
cmd
¢¢ 
=
¢¢  
new
¢¢! $

SqlCommand
¢¢% /
(
¢¢/ 0
$str
¢¢0 A
,
¢¢A B
conexion
¢¢C K
)
¢¢K L
;
¢¢L M
cmd
££ 
.
££ 

Parameters
££ 
.
££ 
AddWithValue
££ +
(
££+ ,
$str
££, ;
,
££; <
objeto
££= C
.
££C D
NroDocumento
££D P
)
££P Q
;
££Q R
cmd
§§ 
.
§§ 

Parameters
§§ 
.
§§ 
AddWithValue
§§ +
(
§§+ ,
$str
§§, 5
,
§§5 6
objeto
§§7 =
.
§§= >
Nombre
§§> D
)
§§D E
;
§§E F
cmd
•• 
.
•• 

Parameters
•• 
.
•• 
AddWithValue
•• +
(
••+ ,
$str
••, 7
,
••7 8
objeto
••9 ?
.
••? @
Apellido
••@ H
)
••H I
;
••I J
cmd
¶¶ 
.
¶¶ 

Parameters
¶¶ 
.
¶¶ 
AddWithValue
¶¶ +
(
¶¶+ ,
$str
¶¶, 5
,
¶¶5 6
objeto
¶¶7 =
.
¶¶= >
Correo
¶¶> D
)
¶¶D E
;
¶¶E F
cmd
ßß 
.
ßß 

Parameters
ßß 
.
ßß 
AddWithValue
ßß +
(
ßß+ ,
$str
ßß, 7
,
ßß7 8
objeto
ßß9 ?
.
ßß? @
Telefono
ßß@ H
)
ßßH I
;
ßßI J
cmd
®® 
.
®® 

Parameters
®® 
.
®® 
Add
®® "
(
®®" #
$str
®®# /
,
®®/ 0
	SqlDbType
®®1 :
.
®®: ;
Int
®®; >
)
®®> ?
.
®®? @
	Direction
®®@ I
=
®®J K 
ParameterDirection
®®L ^
.
®®^ _
Output
®®_ e
;
®®e f
cmd
©© 
.
©© 

Parameters
©© 
.
©© 
Add
©© "
(
©©" #
$str
©©# .
,
©©. /
	SqlDbType
©©0 9
.
©©9 :
VarChar
©©: A
,
©©A B
$num
©©C F
)
©©F G
.
©©G H
	Direction
©©H Q
=
©©R S 
ParameterDirection
©©T f
.
©©f g
Output
©©g m
;
©©m n
cmd
™™ 
.
™™ 
CommandType
™™ 
=
™™  !
CommandType
™™" -
.
™™- .
StoredProcedure
™™. =
;
™™= >
try
¨¨ 
{
≠≠ 
await
ÆÆ 
cmd
ÆÆ 
.
ÆÆ "
ExecuteNonQueryAsync
ÆÆ 2
(
ÆÆ2 3
)
ÆÆ3 4
;
ÆÆ4 5
	respuesta
ØØ 
=
ØØ 
Convert
ØØ  '
.
ØØ' (
ToString
ØØ( 0
(
ØØ0 1
cmd
ØØ1 4
.
ØØ4 5

Parameters
ØØ5 ?
[
ØØ? @
$str
ØØ@ K
]
ØØK L
.
ØØL M
Value
ØØM R
)
ØØR S
!
ØØS T
;
ØØT U
if
±± 
(
±± 
	respuesta
±± !
==
±±" $
$str
±±% '
)
±±' (
{
≤≤ 
objeto
¥¥ 
.
¥¥ 
	IdCliente
¥¥ (
=
¥¥) *
Convert
¥¥+ 2
.
¥¥2 3
ToInt32
¥¥3 :
(
¥¥: ;
cmd
¥¥; >
.
¥¥> ?

Parameters
¥¥? I
[
¥¥I J
$str
¥¥J V
]
¥¥V W
.
¥¥W X
Value
¥¥X ]
)
¥¥] ^
;
¥¥^ _
string
∑∑ 
claveAleatoria
∑∑ -
=
∑∑. /
usuarioData
∑∑0 ;
.
∑∑; <#
GenerarClaveAleatoria
∑∑< Q
(
∑∑Q R
$num
∑∑R T
)
∑∑T U
;
∑∑U V
string
∫∫ 
hashedClave
∫∫ *
=
∫∫+ ,
BCrypt
∫∫- 3
.
∫∫3 4
Net
∫∫4 7
.
∫∫7 8
BCrypt
∫∫8 >
.
∫∫> ?
HashPassword
∫∫? K
(
∫∫K L
claveAleatoria
∫∫L Z
)
∫∫Z [
;
∫∫[ \
Usuario
ΩΩ 
nuevoUsuario
ΩΩ  ,
=
ΩΩ- .
new
ΩΩ/ 2
Usuario
ΩΩ3 :
{
ææ 
NombreCompleto
øø *
=
øø+ ,
objeto
øø- 3
.
øø3 4
Nombre
øø4 :
+
øø; <
$str
øø= @
+
øøA B
objeto
øøC I
.
øøI J
Apellido
øøJ R
,
øøR S
Correo
¿¿ "
=
¿¿# $
objeto
¿¿% +
.
¿¿+ ,
Correo
¿¿, 2
,
¿¿2 3
Clave
¡¡ !
=
¡¡" #
hashedClave
¡¡$ /
,
¡¡/ 0
Rol
¬¬ 
=
¬¬  !
$str
¬¬" +
}
√√ 
;
√√ 
await
≈≈ 
usuarioData
≈≈ )
.
≈≈) *
Crear
≈≈* /
(
≈≈/ 0
nuevoUsuario
≈≈0 <
)
≈≈< =
;
≈≈= >
string
»» 
asunto
»» %
=
»»& '
$str
»»( F
;
»»F G
string
…… 
mensaje
…… &
=
……' (
$"
……) +
$str
……+ 0
{
……0 1
objeto
……1 7
.
……7 8
Nombre
……8 >
+
……? @
$str
……A D
+
……E F
objeto
……G M
.
……M N
Apellido
……N V
}
……V W
$str……W û
{……û ü
claveAleatoria……ü ≠
}……≠ Æ
$str……Æ ﬁ
"……ﬁ ﬂ
;……ﬂ ‡
await
   
emailService
   *
.
  * +
EnviarCorreoAsync
  + <
(
  < =
objeto
  = C
.
  C D
Correo
  D J
,
  J K
asunto
  L R
,
  R S
mensaje
  T [
)
  [ \
;
  \ ]
Cuenta
ÃÃ 
nuevaCuenta
ÃÃ *
=
ÃÃ+ ,
new
ÃÃ- 0
Cuenta
ÃÃ1 7
{
ÕÕ 
	IdCliente
ŒŒ %
=
ŒŒ& '
objeto
ŒŒ( .
.
ŒŒ. /
	IdCliente
ŒŒ/ 8
,
ŒŒ8 9
Tarjeta
œœ #
=
œœ$ %
GenerarTarjeta
œœ& 4
(
œœ4 5
)
œœ5 6
,
œœ6 7
Monto
–– !
=
––" #
$num
––$ %
}
—— 
;
—— 
string
”” 
respuestaCuenta
”” .
=
””/ 0
await
””1 6
CrearCuenta
””7 B
(
””B C
nuevaCuenta
””C N
)
””N O
;
””O P
if
‘‘ 
(
‘‘ 
!
‘‘ 
string
‘‘ #
.
‘‘# $
IsNullOrEmpty
‘‘$ 1
(
‘‘1 2
respuestaCuenta
‘‘2 A
)
‘‘A B
)
‘‘B C
{
’’ 
throw
÷÷ !
new
÷÷" %
	Exception
÷÷& /
(
÷÷/ 0
respuestaCuenta
÷÷0 ?
)
÷÷? @
;
÷÷@ A
}
◊◊ 
}
ÿÿ 
}
ŸŸ 
catch
⁄⁄ 
(
⁄⁄ 
	Exception
⁄⁄  
ex
⁄⁄! #
)
⁄⁄# $
{
€€ 
	respuesta
‹‹ 
=
‹‹ 
$str
‹‹  5
+
‹‹6 7
ex
‹‹8 :
.
‹‹: ;
Message
‹‹; B
;
‹‹B C
Console
›› 
.
›› 
	WriteLine
›› %
(
››% &
$str
››& /
+
››0 1
ex
››2 4
.
››4 5
Message
››5 <
)
››< =
;
››= >
}
ﬁﬁ 
}
ﬂﬂ 
return
‡‡ 
	respuesta
‡‡ 
;
‡‡ 
}
·· 	
public
„„ 
async
„„ 
Task
„„ 
<
„„ 
string
„„  
>
„„  !
Editar
„„" (
(
„„( )
Cliente
„„) 0
objeto
„„1 7
)
„„7 8
{
‰‰ 	
string
ÊÊ 
	respuesta
ÊÊ 
=
ÊÊ 
$str
ÊÊ !
;
ÊÊ! "
using
ÁÁ 
(
ÁÁ 
var
ÁÁ 
conexion
ÁÁ 
=
ÁÁ  !
new
ÁÁ" %
SqlConnection
ÁÁ& 3
(
ÁÁ3 4
con
ÁÁ4 7
.
ÁÁ7 8
	CadenaSQL
ÁÁ8 A
)
ÁÁA B
)
ÁÁB C
{
ËË 
await
ÈÈ 
conexion
ÈÈ 
.
ÈÈ 
	OpenAsync
ÈÈ (
(
ÈÈ( )
)
ÈÈ) *
;
ÈÈ* +

SqlCommand
ÍÍ 
cmd
ÍÍ 
=
ÍÍ  
new
ÍÍ! $

SqlCommand
ÍÍ% /
(
ÍÍ/ 0
$str
ÍÍ0 B
,
ÍÍB C
conexion
ÍÍD L
)
ÍÍL M
;
ÍÍM N
cmd
ÎÎ 
.
ÎÎ 

Parameters
ÎÎ 
.
ÎÎ 
AddWithValue
ÎÎ +
(
ÎÎ+ ,
$str
ÎÎ, 8
,
ÎÎ8 9
objeto
ÎÎ: @
.
ÎÎ@ A
	IdCliente
ÎÎA J
)
ÎÎJ K
;
ÎÎK L
cmd
ÏÏ 
.
ÏÏ 

Parameters
ÏÏ 
.
ÏÏ 
AddWithValue
ÏÏ +
(
ÏÏ+ ,
$str
ÏÏ, ;
,
ÏÏ; <
objeto
ÏÏ= C
.
ÏÏC D
NroDocumento
ÏÏD P
)
ÏÏP Q
;
ÏÏQ R
cmd
ÌÌ 
.
ÌÌ 

Parameters
ÌÌ 
.
ÌÌ 
AddWithValue
ÌÌ +
(
ÌÌ+ ,
$str
ÌÌ, 5
,
ÌÌ5 6
objeto
ÌÌ7 =
.
ÌÌ= >
Nombre
ÌÌ> D
)
ÌÌD E
;
ÌÌE F
cmd
ÓÓ 
.
ÓÓ 

Parameters
ÓÓ 
.
ÓÓ 
AddWithValue
ÓÓ +
(
ÓÓ+ ,
$str
ÓÓ, 7
,
ÓÓ7 8
objeto
ÓÓ9 ?
.
ÓÓ? @
Apellido
ÓÓ@ H
)
ÓÓH I
;
ÓÓI J
cmd
ÔÔ 
.
ÔÔ 

Parameters
ÔÔ 
.
ÔÔ 
AddWithValue
ÔÔ +
(
ÔÔ+ ,
$str
ÔÔ, 5
,
ÔÔ5 6
objeto
ÔÔ7 =
.
ÔÔ= >
Correo
ÔÔ> D
)
ÔÔD E
;
ÔÔE F
cmd
 
.
 

Parameters
 
.
 
AddWithValue
 +
(
+ ,
$str
, 7
,
7 8
objeto
9 ?
.
? @
Telefono
@ H
)
H I
;
I J
cmd
ÒÒ 
.
ÒÒ 

Parameters
ÒÒ 
.
ÒÒ 
Add
ÒÒ "
(
ÒÒ" #
$str
ÒÒ# .
,
ÒÒ. /
	SqlDbType
ÒÒ0 9
.
ÒÒ9 :
VarChar
ÒÒ: A
,
ÒÒA B
$num
ÒÒC F
)
ÒÒF G
.
ÒÒG H
	Direction
ÒÒH Q
=
ÒÒR S 
ParameterDirection
ÒÒT f
.
ÒÒf g
Output
ÒÒg m
;
ÒÒm n
cmd
ÚÚ 
.
ÚÚ 
CommandType
ÚÚ 
=
ÚÚ  !
CommandType
ÚÚ" -
.
ÚÚ- .
StoredProcedure
ÚÚ. =
;
ÚÚ= >
try
ÙÙ 
{
ıı 
await
ˆˆ 
cmd
ˆˆ 
.
ˆˆ "
ExecuteNonQueryAsync
ˆˆ 2
(
ˆˆ2 3
)
ˆˆ3 4
;
ˆˆ4 5
	respuesta
˜˜ 
=
˜˜ 
Convert
˜˜  '
.
˜˜' (
ToString
˜˜( 0
(
˜˜0 1
cmd
˜˜1 4
.
˜˜4 5

Parameters
˜˜5 ?
[
˜˜? @
$str
˜˜@ K
]
˜˜K L
.
˜˜L M
Value
˜˜M R
)
˜˜R S
!
˜˜S T
;
˜˜T U
}
¯¯ 
catch
˘˘ 
{
˙˙ 
	respuesta
˚˚ 
=
˚˚ 
$str
˚˚  3
;
˚˚3 4
}
¸¸ 
}
˝˝ 
return
˛˛ 
	respuesta
˛˛ 
;
˛˛ 
}
ˇˇ 	
public
ÅÅ 
async
ÅÅ 
Task
ÅÅ 
<
ÅÅ 
string
ÅÅ  
>
ÅÅ  !
Eliminar
ÅÅ" *
(
ÅÅ* +
int
ÅÅ+ .
Id
ÅÅ/ 1
)
ÅÅ1 2
{
ÇÇ 	
string
ÑÑ 
	respuesta
ÑÑ 
=
ÑÑ 
$str
ÑÑ !
;
ÑÑ! "
using
ÖÖ 
(
ÖÖ 
var
ÖÖ 
conexion
ÖÖ 
=
ÖÖ  !
new
ÖÖ" %
SqlConnection
ÖÖ& 3
(
ÖÖ3 4
con
ÖÖ4 7
.
ÖÖ7 8
	CadenaSQL
ÖÖ8 A
)
ÖÖA B
)
ÖÖB C
{
ÜÜ 
await
áá 
conexion
áá 
.
áá 
	OpenAsync
áá (
(
áá( )
)
áá) *
;
áá* +

SqlCommand
àà 
cmd
àà 
=
àà  
new
àà! $

SqlCommand
àà% /
(
àà/ 0
$str
àà0 D
,
ààD E
conexion
ààF N
)
ààN O
;
ààO P
cmd
ââ 
.
ââ 

Parameters
ââ 
.
ââ 
AddWithValue
ââ +
(
ââ+ ,
$str
ââ, 8
,
ââ8 9
Id
ââ: <
)
ââ< =
;
ââ= >
cmd
ää 
.
ää 

Parameters
ää 
.
ää 
Add
ää "
(
ää" #
$str
ää# .
,
ää. /
	SqlDbType
ää0 9
.
ää9 :
VarChar
ää: A
,
ääA B
$num
ääC F
)
ääF G
.
ääG H
	Direction
ääH Q
=
ääR S 
ParameterDirection
ääT f
.
ääf g
Output
ääg m
;
ääm n
cmd
ãã 
.
ãã 
CommandType
ãã 
=
ãã  !
CommandType
ãã" -
.
ãã- .
StoredProcedure
ãã. =
;
ãã= >
try
çç 
{
éé 
await
èè 
cmd
èè 
.
èè "
ExecuteNonQueryAsync
èè 2
(
èè2 3
)
èè3 4
;
èè4 5
	respuesta
êê 
=
êê 
Convert
êê  '
.
êê' (
ToString
êê( 0
(
êê0 1
cmd
êê1 4
.
êê4 5

Parameters
êê5 ?
[
êê? @
$str
êê@ K
]
êêK L
.
êêL M
Value
êêM R
)
êêR S
!
êêS T
;
êêT U
}
ëë 
catch
íí 
{
ìì 
	respuesta
îî 
=
îî 
$str
îî  3
;
îî3 4
}
ïï 
}
ññ 
return
óó 
	respuesta
óó 
;
óó 
}
òò 	
public
öö 
async
öö 
Task
öö 
<
öö 
Cliente
öö !
>
öö! "
ObtenerPorCorreo
öö# 3
(
öö3 4
string
öö4 :
correo
öö; A
)
ööA B
{
õõ 	
Cliente
úú 
cliente
úú 
=
úú 
null
úú "
;
úú" #
if
üü 
(
üü 
string
üü 
.
üü 
IsNullOrEmpty
üü $
(
üü$ %
correo
üü% +
)
üü+ ,
)
üü, -
{
†† 
throw
°° 
new
°° 
ArgumentException
°° +
(
°°+ ,
$str
°°, L
)
°°L M
;
°°M N
}
¢¢ 
using
§§ 
(
§§ 
var
§§ 
conexion
§§ 
=
§§  !
new
§§" %
SqlConnection
§§& 3
(
§§3 4
con
§§4 7
.
§§7 8
	CadenaSQL
§§8 A
)
§§A B
)
§§B C
{
•• 
await
¶¶ 
conexion
¶¶ 
.
¶¶ 
	OpenAsync
¶¶ (
(
¶¶( )
)
¶¶) *
;
¶¶* +
using
®® 
(
®® 

SqlCommand
®® !
cmd
®®" %
=
®®& '
new
®®( +

SqlCommand
®®, 6
(
®®6 7
$str
®®7 S
,
®®S T
conexion
®®U ]
)
®®] ^
)
®®^ _
{
©© 
cmd
™™ 
.
™™ 
CommandType
™™ #
=
™™$ %
CommandType
™™& 1
.
™™1 2
StoredProcedure
™™2 A
;
™™A B
cmd
≠≠ 
.
≠≠ 

Parameters
≠≠ "
.
≠≠" #
AddWithValue
≠≠# /
(
≠≠/ 0
$str
≠≠0 9
,
≠≠9 :
correo
≠≠; A
??
≠≠B D
string
≠≠E K
.
≠≠K L
Empty
≠≠L Q
)
≠≠Q R
;
≠≠R S
using
ØØ 
(
ØØ 
var
ØØ 
dr
ØØ !
=
ØØ" #
await
ØØ$ )
cmd
ØØ* -
.
ØØ- . 
ExecuteReaderAsync
ØØ. @
(
ØØ@ A
)
ØØA B
)
ØØB C
{
∞∞ 
if
±± 
(
±± 
await
±± !
dr
±±" $
.
±±$ %
	ReadAsync
±±% .
(
±±. /
)
±±/ 0
)
±±0 1
{
≤≤ 
cliente
≥≥ #
=
≥≥$ %
new
≥≥& )
Cliente
≥≥* 1
(
≥≥1 2
)
≥≥2 3
{
¥¥ 
	IdCliente
µµ  )
=
µµ* +
Convert
µµ, 3
.
µµ3 4
ToInt32
µµ4 ;
(
µµ; <
dr
µµ< >
[
µµ> ?
$str
µµ? J
]
µµJ K
)
µµK L
,
µµL M
NroDocumento
∂∂  ,
=
∂∂- .
dr
∂∂/ 1
[
∂∂1 2
$str
∂∂2 @
]
∂∂@ A
.
∂∂A B
ToString
∂∂B J
(
∂∂J K
)
∂∂K L
,
∂∂L M
Nombre
∑∑  &
=
∑∑' (
dr
∑∑) +
[
∑∑+ ,
$str
∑∑, 4
]
∑∑4 5
.
∑∑5 6
ToString
∑∑6 >
(
∑∑> ?
)
∑∑? @
,
∑∑@ A
Apellido
∏∏  (
=
∏∏) *
dr
∏∏+ -
[
∏∏- .
$str
∏∏. 8
]
∏∏8 9
.
∏∏9 :
ToString
∏∏: B
(
∏∏B C
)
∏∏C D
,
∏∏D E
Correo
ππ  &
=
ππ' (
dr
ππ) +
[
ππ+ ,
$str
ππ, 4
]
ππ4 5
.
ππ5 6
ToString
ππ6 >
(
ππ> ?
)
ππ? @
,
ππ@ A
Telefono
∫∫  (
=
∫∫) *
dr
∫∫+ -
[
∫∫- .
$str
∫∫. 8
]
∫∫8 9
.
∫∫9 :
ToString
∫∫: B
(
∫∫B C
)
∫∫C D
,
∫∫D E
FechaCreacion
ªª  -
=
ªª. /
dr
ªª0 2
[
ªª2 3
$str
ªª3 B
]
ªªB C
.
ªªC D
ToString
ªªD L
(
ªªL M
)
ªªM N
}
ºº 
;
ºº 
}
ΩΩ 
}
ææ 
}
øø 
}
¿¿ 
return
¡¡ 
cliente
¡¡ 
;
¡¡ 
}
¬¬ 	
public
ƒƒ 
async
ƒƒ 
Task
ƒƒ 
<
ƒƒ 
Cliente
ƒƒ !
>
ƒƒ! "
ObtenerPorCedula
ƒƒ# 3
(
ƒƒ3 4
string
ƒƒ4 :
cedula
ƒƒ; A
)
ƒƒA B
{
≈≈ 	
Cliente
∆∆ 
cliente
∆∆ 
=
∆∆ 
null
∆∆ "
;
∆∆" #
if
…… 
(
…… 
string
…… 
.
…… 
IsNullOrEmpty
…… $
(
……$ %
cedula
……% +
)
……+ ,
)
……, -
{
   
throw
ÀÀ 
new
ÀÀ 
ArgumentException
ÀÀ +
(
ÀÀ+ ,
$str
ÀÀ, L
)
ÀÀL M
;
ÀÀM N
}
ÃÃ 
using
ŒŒ 
(
ŒŒ 
var
ŒŒ 
conexion
ŒŒ 
=
ŒŒ  !
new
ŒŒ" %
SqlConnection
ŒŒ& 3
(
ŒŒ3 4
con
ŒŒ4 7
.
ŒŒ7 8
	CadenaSQL
ŒŒ8 A
)
ŒŒA B
)
ŒŒB C
{
œœ 
await
–– 
conexion
–– 
.
–– 
	OpenAsync
–– (
(
––( )
)
––) *
;
––* +
using
““ 
(
““ 

SqlCommand
““ !
cmd
““" %
=
““& '
new
““( +

SqlCommand
““, 6
(
““6 7
$str
““7 J
,
““J K
conexion
““L T
)
““T U
)
““U V
{
”” 
cmd
‘‘ 
.
‘‘ 
CommandType
‘‘ #
=
‘‘$ %
CommandType
‘‘& 1
.
‘‘1 2
StoredProcedure
‘‘2 A
;
‘‘A B
cmd
◊◊ 
.
◊◊ 

Parameters
◊◊ "
.
◊◊" #
AddWithValue
◊◊# /
(
◊◊/ 0
$str
◊◊0 ?
,
◊◊? @
cedula
◊◊A G
??
◊◊H J
string
◊◊K Q
.
◊◊Q R
Empty
◊◊R W
)
◊◊W X
;
◊◊X Y
using
ŸŸ 
(
ŸŸ 
var
ŸŸ 
dr
ŸŸ !
=
ŸŸ" #
await
ŸŸ$ )
cmd
ŸŸ* -
.
ŸŸ- . 
ExecuteReaderAsync
ŸŸ. @
(
ŸŸ@ A
)
ŸŸA B
)
ŸŸB C
{
⁄⁄ 
if
€€ 
(
€€ 
await
€€ !
dr
€€" $
.
€€$ %
	ReadAsync
€€% .
(
€€. /
)
€€/ 0
)
€€0 1
{
‹‹ 
cliente
›› #
=
››$ %
new
››& )
Cliente
››* 1
(
››1 2
)
››2 3
{
ﬁﬁ 
	IdCliente
ﬂﬂ  )
=
ﬂﬂ* +
Convert
ﬂﬂ, 3
.
ﬂﬂ3 4
ToInt32
ﬂﬂ4 ;
(
ﬂﬂ; <
dr
ﬂﬂ< >
[
ﬂﬂ> ?
$str
ﬂﬂ? J
]
ﬂﬂJ K
)
ﬂﬂK L
,
ﬂﬂL M
NroDocumento
‡‡  ,
=
‡‡- .
dr
‡‡/ 1
[
‡‡1 2
$str
‡‡2 @
]
‡‡@ A
.
‡‡A B
ToString
‡‡B J
(
‡‡J K
)
‡‡K L
,
‡‡L M
Nombre
··  &
=
··' (
dr
··) +
[
··+ ,
$str
··, 4
]
··4 5
.
··5 6
ToString
··6 >
(
··> ?
)
··? @
,
··@ A
Apellido
‚‚  (
=
‚‚) *
dr
‚‚+ -
[
‚‚- .
$str
‚‚. 8
]
‚‚8 9
.
‚‚9 :
ToString
‚‚: B
(
‚‚B C
)
‚‚C D
,
‚‚D E
Correo
„„  &
=
„„' (
dr
„„) +
[
„„+ ,
$str
„„, 4
]
„„4 5
.
„„5 6
ToString
„„6 >
(
„„> ?
)
„„? @
,
„„@ A
Telefono
‰‰  (
=
‰‰) *
dr
‰‰+ -
[
‰‰- .
$str
‰‰. 8
]
‰‰8 9
.
‰‰9 :
ToString
‰‰: B
(
‰‰B C
)
‰‰C D
,
‰‰D E
FechaCreacion
ÂÂ  -
=
ÂÂ. /
dr
ÂÂ0 2
[
ÂÂ2 3
$str
ÂÂ3 B
]
ÂÂB C
.
ÂÂC D
ToString
ÂÂD L
(
ÂÂL M
)
ÂÂM N
}
ÊÊ 
;
ÊÊ 
}
ÁÁ 
}
ËË 
}
ÈÈ 
}
ÍÍ 
return
ÎÎ 
cliente
ÎÎ 
;
ÎÎ 
}
ÏÏ 	
public
ÓÓ 
async
ÓÓ 
Task
ÓÓ 
<
ÓÓ 
string
ÓÓ  
>
ÓÓ  !
	Depositar
ÓÓ" +
(
ÓÓ+ ,
int
ÓÓ, /
	idCliente
ÓÓ0 9
,
ÓÓ9 :
decimal
ÓÓ; B
monto
ÓÓC H
)
ÓÓH I
{
ÔÔ 	
string
 
	respuesta
 
=
 
$str
 !
;
! "
using
ÒÒ 
(
ÒÒ 
var
ÒÒ 
conexion
ÒÒ 
=
ÒÒ  !
new
ÒÒ" %
SqlConnection
ÒÒ& 3
(
ÒÒ3 4
con
ÒÒ4 7
.
ÒÒ7 8
	CadenaSQL
ÒÒ8 A
)
ÒÒA B
)
ÒÒB C
{
ÚÚ 
await
ÛÛ 
conexion
ÛÛ 
.
ÛÛ 
	OpenAsync
ÛÛ (
(
ÛÛ( )
)
ÛÛ) *
;
ÛÛ* +

SqlCommand
ÙÙ 
cmd
ÙÙ 
=
ÙÙ  
new
ÙÙ! $

SqlCommand
ÙÙ% /
(
ÙÙ/ 0
$str
ÙÙ0 D
,
ÙÙD E
conexion
ÙÙF N
)
ÙÙN O
;
ÙÙO P
cmd
ıı 
.
ıı 

Parameters
ıı 
.
ıı 
AddWithValue
ıı +
(
ıı+ ,
$str
ıı, 8
,
ıı8 9
	idCliente
ıı: C
)
ııC D
;
ııD E
cmd
ˆˆ 
.
ˆˆ 

Parameters
ˆˆ 
.
ˆˆ 
AddWithValue
ˆˆ +
(
ˆˆ+ ,
$str
ˆˆ, 4
,
ˆˆ4 5
monto
ˆˆ6 ;
)
ˆˆ; <
;
ˆˆ< =
cmd
˜˜ 
.
˜˜ 

Parameters
˜˜ 
.
˜˜ 
Add
˜˜ "
(
˜˜" #
$str
˜˜# .
,
˜˜. /
	SqlDbType
˜˜0 9
.
˜˜9 :
VarChar
˜˜: A
,
˜˜A B
$num
˜˜C F
)
˜˜F G
.
˜˜G H
	Direction
˜˜H Q
=
˜˜R S 
ParameterDirection
˜˜T f
.
˜˜f g
Output
˜˜g m
;
˜˜m n
cmd
¯¯ 
.
¯¯ 
CommandType
¯¯ 
=
¯¯  !
CommandType
¯¯" -
.
¯¯- .
StoredProcedure
¯¯. =
;
¯¯= >
try
˙˙ 
{
˚˚ 
await
¸¸ 
cmd
¸¸ 
.
¸¸ "
ExecuteNonQueryAsync
¸¸ 2
(
¸¸2 3
)
¸¸3 4
;
¸¸4 5
	respuesta
˝˝ 
=
˝˝ 
Convert
˝˝  '
.
˝˝' (
ToString
˝˝( 0
(
˝˝0 1
cmd
˝˝1 4
.
˝˝4 5

Parameters
˝˝5 ?
[
˝˝? @
$str
˝˝@ K
]
˝˝K L
.
˝˝L M
Value
˝˝M R
)
˝˝R S
!
˝˝S T
;
˝˝T U
}
˛˛ 
catch
ˇˇ 
{
ÄÄ 
	respuesta
ÅÅ 
=
ÅÅ 
$str
ÅÅ  3
;
ÅÅ3 4
}
ÇÇ 
}
ÉÉ 
return
ÑÑ 
	respuesta
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
}
ÜÜ 
}áá Ã
YC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Data\AuditoriaData.cs
	namespace 	
Prestamo
 
. 
Data 
{ 
public 

class 
AuditoriaData 
{ 
private 
readonly 
ConnectionStrings *
_connectionStrings+ =
;= >
public 
AuditoriaData 
( 
IOptions %
<% &
ConnectionStrings& 7
>7 8
options9 @
)@ A
{ 	
_connectionStrings 
=  
options! (
.( )
Value) .
;. /
} 	
public 
async 
Task 
< 
string  
>  !
Insertar" *
(* +
	Auditoria+ 4
log5 8
)8 9
{ 	
string 
	respuesta 
= 
$str !
;! "
using 
( 
var 
conexion 
=  !
new" %
SqlConnection& 3
(3 4
_connectionStrings4 F
.F G
	CadenaSQLG P
)P Q
)Q R
{ 
await 
conexion 
. 
	OpenAsync (
(( )
)) *
;* +

SqlCommand 
cmd 
=  
new! $

SqlCommand% /
(/ 0
$str0 F
,F G
conexionH P
)P Q
;Q R
cmd 
. 

Parameters 
. 
AddWithValue +
(+ ,
$str, 6
,6 7
log8 ;
.; <
Usuario< C
)C D
;D E
cmd 
. 

Parameters 
. 
AddWithValue +
(+ ,
$str, 5
,5 6
log7 :
.: ;
Accion; A
)A B
;B C
cmd 
. 

Parameters 
. 
AddWithValue +
(+ ,
$str, 4
,4 5
log6 9
.9 :
Fecha: ?
)? @
;@ A
cmd   
.   

Parameters   
.   
AddWithValue   +
(  + ,
$str  , 7
,  7 8
log  9 <
.  < =
Detalles  = E
)  E F
;  F G
cmd!! 
.!! 
CommandType!! 
=!!  !
CommandType!!" -
.!!- .
StoredProcedure!!. =
;!!= >
try## 
{$$ 
await%% 
cmd%% 
.%%  
ExecuteNonQueryAsync%% 2
(%%2 3
)%%3 4
;%%4 5
	respuesta&& 
=&& 
$str&&  >
;&&> ?
}'' 
catch(( 
{)) 
	respuesta** 
=** 
$str**  3
;**3 4
}++ 
},, 
return-- 
	respuesta-- 
;-- 
}.. 	
}// 
}00 