‡;
jC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Servives\SecurityHeadersService.cs
	namespace 	
Prestamo
 
. 
Web 
. 
Servives 
;  
public 
class "
SecurityHeadersService #
{ 
private 
readonly 

Dictionary 
<  
string  &
,& '
string( .
>. /
_scriptHashes0 =
=> ?
new@ C
(C D
)D E
;E F
private		 
readonly		 

Dictionary		 
<		  
string		  &
,		& '
string		( .
>		. /
_styleHashes		0 <
=		= >
new		? B
(		B C
)		C D
;		D E
public 

string 
ComputeHash 
( 
string $
content% ,
), -
{ 
using 
var 
sha256 
= 
SHA256 !
.! "
Create" (
(( )
)) *
;* +
var 
hash 
= 
sha256 
. 
ComputeHash %
(% &
Encoding& .
.. /
UTF8/ 3
.3 4
GetBytes4 <
(< =
content= D
)D E
)E F
;F G
return 
Convert 
. 
ToBase64String %
(% &
hash& *
)* +
;+ ,
} 
public 

string 
GetScriptHash 
(  
string  &
script' -
)- .
{ 
if 

( 
_scriptHashes 
. 
TryGetValue %
(% &
script& ,
,, -
out. 1
var2 5
hash6 :
): ;
); <
{ 	
return 
hash 
; 
} 	
hash 
= 
ComputeHash 
( 
script !
)! "
;" #
_scriptHashes 
[ 
script 
] 
= 
hash  $
;$ %
return 
hash 
; 
} 
public 

string 
GetStyleHash 
( 
string %
style& +
)+ ,
{ 
if   

(   
_styleHashes   
.   
TryGetValue   $
(  $ %
style  % *
,  * +
out  , /
var  0 3
hash  4 8
)  8 9
)  9 :
{!! 	
return"" 
hash"" 
;"" 
}## 	
hash%% 
=%% 
ComputeHash%% 
(%% 
style%%  
)%%  !
;%%! "
_styleHashes&& 
[&& 
style&& 
]&& 
=&& 
hash&& "
;&&" #
return'' 
hash'' 
;'' 
}(( 
public** 

string** 
GetCSPHeader** 
(** 
string** %
nonce**& +
)**+ ,
{++ 
var,, 
trustedScriptHashes,, 
=,,  !
string,," (
.,,( )
Join,,) -
(,,- .
$str,,. 1
,,,1 2
_scriptHashes,,3 @
.,,@ A
Values,,A G
.,,G H
Select,,H N
(,,N O
h,,O P
=>,,Q S
$",,T V
$str,,V ^
{,,^ _
h,,_ `
},,` a
$str,,a b
",,b c
),,c d
),,d e
;,,e f
var-- 
trustedStyleHashes-- 
=--  
string--! '
.--' (
Join--( ,
(--, -
$str--- 0
,--0 1
_styleHashes--2 >
.--> ?
Values--? E
.--E F
Select--F L
(--L M
h--M N
=>--O Q
$"--R T
$str--T \
{--\ ]
h--] ^
}--^ _
$str--_ `
"--` a
)--a b
)--b c
;--c d
var00 
trustedDomains00 
=00 
new00  
[00  !
]00! "
{11 	
$str22 #
,22# $
$str33 $
,33$ %
$str44 $
,44$ %
$str55 %
,55% &
$str66 (
}77 	
;77	 

var99 #
trustedWebsocketDomains99 #
=99$ %
new99& )
[99) *
]99* +
{:: 	
$str;; !
,;;! "
$str<< "
,<<" #
$str== "
,==" #
$str>> #
}?? 	
;??	 

varAA 
	scriptSrcAA 
=AA 
newAA 
[AA 
]AA 
{BB 	
$strCC 
,CC 
$"DD 
$strDD 
{DD 
nonceDD 
}DD 
$strDD 
"DD 
,DD 
trustedScriptHashesEE 
,EE  
$strFF 
}GG 	
.GG	 

WhereGG
 
(GG 
sGG 
=>GG 
!GG 
stringGG 
.GG 
IsNullOrEmptyGG *
(GG* +
sGG+ ,
)GG, -
)GG- .
;GG. /
varII 

connectSrcII 
=II 
newII 
[II 
]II 
{JJ 	
$strKK 
,KK 
stringLL 
.LL 
JoinLL 
(LL 
$strLL 
,LL 
trustedDomainsLL +
)LL+ ,
,LL, -
stringMM 
.MM 
JoinMM 
(MM 
$strMM 
,MM #
trustedWebsocketDomainsMM 4
)MM4 5
}NN 	
;NN	 

returnPP 
newPP 
StringBuilderPP  
(PP  !
)PP! "
.QQ 
AppendQQ 
(QQ 
$strQQ *
)QQ* +
.RR 
AppendRR 
(RR 
$"RR 
$strRR !
{RR! "
stringRR" (
.RR( )
JoinRR) -
(RR- .
$strRR. 1
,RR1 2
	scriptSrcRR3 <
)RR< =
}RR= >
$strRR> @
"RR@ A
)RRA B
.SS 
AppendSS 
(SS 
$"SS 
$strSS .
{SS. /
nonceSS/ 4
}SS4 5
$strSS5 7
{SS7 8
trustedStyleHashesSS8 J
}SSJ K
$strSSK M
"SSM N
)SSN O
.TT 
AppendTT 
(TT 
$strTT ,
)TT, -
.UU 
AppendUU 
(UU 
$strUU -
)UU- .
.VV 
AppendVV 
(VV 
$"VV 
$strVV "
{VV" #
stringVV# )
.VV) *
JoinVV* .
(VV. /
$strVV/ 2
,VV2 3

connectSrcVV4 >
)VV> ?
}VV? @
$strVV@ B
"VVB C
)VVC D
.WW 
AppendWW 
(WW 
$strWW .
)WW. /
.XX 
AppendXX 
(XX 
$strXX *
)XX* +
.YY 
AppendYY 
(YY 
$strYY '
)YY' (
.ZZ 
AppendZZ 
(ZZ 
$strZZ )
)ZZ) *
.[[ 
Append[[ 
([[ 
$str[[ 0
)[[0 1
.\\ 
ToString\\ 
(\\ 
)\\ 
;\\ 
}]] 
}^^ ∞
dC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Servives\AuditoriaService.cs
	namespace 	
Prestamo
 
. 
Web 
. 
Servives 
{ 
public 

class 
AuditoriaService !
{ 
private 
readonly 
AuditoriaData &
_auditoriaData' 5
;5 6
public

 
AuditoriaService

 
(

  
AuditoriaData

  -
auditoriaData

. ;
)

; <
{ 	
_auditoriaData 
= 
auditoriaData *
;* +
} 	
public 
async 
Task 
RegistrarLog &
(& '
string' -
usuario. 5
,5 6
string7 =
accion> D
,D E
stringF L
detallesM U
)U V
{ 	
var 
log 
= 
new 
	Auditoria #
{ 
Usuario 
= 
usuario !
,! "
Accion 
= 
accion 
,  
Fecha 
= 
DateTime  
.  !
UtcNow! '
,' (
Detalles 
= 
detalles #
} 
; 
await 
_auditoriaData  
.  !
Insertar! )
() *
log* -
)- .
;. /
} 	
} 
} πq
RC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Program.cs
var

 
builder

 
=

 
WebApplication

 
.

 
CreateBuilder

 *
(

* +
args

+ /
)

/ 0
;

0 1
builder 
. 
Services 
. #
AddControllersWithViews (
(( )
)) *
;* +
builder 
. 
Services 
. 
	Configure 
< 
ConnectionStrings ,
>, -
(- .
builder. 5
.5 6
Configuration6 C
.C D

GetSectionD N
(N O
$strO b
)b c
)c d
;d e
builder 
. 
Services 
. 
AddSingleton 
< 
EmailService *
>* +
(+ ,
), -
;- .
builder 
. 
Services 
. 
	Configure 
< 
SmtpSettings '
>' (
(( )
builder) 0
.0 1
Configuration1 >
.> ?

GetSection? I
(I J
$strJ P
)P Q
)Q R
;R S
builder 
. 
Services 
. 
AddSingleton 
< 

MonedaData (
>( )
() *
)* +
;+ ,
builder 
. 
Services 
. 
AddSingleton 
< 
ClienteData )
>) *
(* +
)+ ,
;, -
builder 
. 
Services 
. 
AddSingleton 
< 
PrestamoData *
>* +
(+ ,
), -
;- .
builder 
. 
Services 
. 
AddSingleton 
< 
ResumenData )
>) *
(* +
)+ ,
;, -
builder 
. 
Services 
. 
AddSingleton 
< 
UsuarioData )
>) *
(* +
)+ ,
;, -
builder 
. 
Services 
. 
	AddScoped 
< 
ResumenClienteData -
>- .
(. /
)/ 0
;0 1
builder 
. 
Services 
. 
AddSingleton 
< 
AuditoriaData +
>+ ,
(, -
)- .
;. /
builder 
. 
Services 
. 
	AddScoped 
< 
AuditoriaService +
>+ ,
(, -
)- .
;. /
builder 
. 
Services 
. 
AddSingleton 
< 

CuentaData (
>( )
() *
)* +
;+ ,
builder 
. 
Services 
. 
AddSingleton 
< "
SecurityHeadersService 4
>4 5
(5 6
)6 7
;7 8
builder 
. 
Services 
. 
AddCors 
( 
options  
=>! #
{ 
options   
.   
AddDefaultPolicy   
(   
policy   #
=>  $ &
{!! 
policy"" 
."" 
WithOrigins"" 
("" 
$str## #
,### $
$str$$ $
)%% 	
.&& 	
WithMethods&&	 
(&& 
$str&& 
,&& 
$str&& "
,&&" #
$str&&$ -
)&&- .
.'' 	
WithHeaders''	 
('' 
$str'' #
,''# $
$str''% 4
,''4 5
$str''6 H
)''H I
.(( 	
AllowCredentials((	 
((( 
)(( 
;(( 
})) 
))) 
;)) 
}** 
)** 
;** 
builder-- 
.-- 
Services-- 
.-- 
AddAuthentication-- "
(--" #
options--# *
=>--+ -
{.. 
options// 
.// 
DefaultScheme// 
=// (
CookieAuthenticationDefaults// 8
.//8 9 
AuthenticationScheme//9 M
;//M N
options00 
.00 "
DefaultChallengeScheme00 "
=00# $(
CookieAuthenticationDefaults00% A
.00A B 
AuthenticationScheme00B V
;00V W
options11 
.11 %
DefaultAuthenticateScheme11 %
=11& '(
CookieAuthenticationDefaults11( D
.11D E 
AuthenticationScheme11E Y
;11Y Z
}22 
)22 
.44 
	AddCookie44 

(44
 (
CookieAuthenticationDefaults44 '
.44' ( 
AuthenticationScheme44( <
,44< =
options44> E
=>44F H
{55 
options66 
.66 
	LoginPath66 
=66 
$str66  
;66  !
options77 
.77 
AccessDeniedPath77 
=77 
$str77 '
;77' (
options88 
.88 
ExpireTimeSpan88 
=88 
TimeSpan88 %
.88% &
FromMinutes88& 1
(881 2
$num882 4
)884 5
;885 6
options99 
.99 
Cookie99 
.99 
Name99 
=99 
$str99 (
;99( )
options:: 
.:: 
SlidingExpiration:: 
=:: 
true::  $
;::$ %
options;; 
.;; 
Cookie;; 
.;; 
IsEssential;; 
=;;  
true;;! %
;;;% &
options<< 
.<< 
Cookie<< 
.<< 
SecurePolicy<< 
=<<  !
CookieSecurePolicy<<" 4
.<<4 5
Always<<5 ;
;<<; <
options== 
.== 
Cookie== 
.== 
SameSite== 
=== 
SameSiteMode== *
.==* +
Strict==+ 1
;==1 2
options>> 
.>> 
Cookie>> 
.>> 

Expiration>> 
=>> 
null>>  $
;>>$ %
}?? 
)?? 
.AA 
AddJwtBearerAA 
(AA 
JwtBearerDefaultsAA 
.AA   
AuthenticationSchemeAA  4
,AA4 5
optionsAA6 =
=>AA> @
{BB 
optionsCC 
.CC 
	SaveTokenCC 
=CC 
trueCC 
;CC 
optionsDD 
.DD  
RequireHttpsMetadataDD  
=DD! "
falseDD# (
;DD( )
optionsEE 
.EE %
TokenValidationParametersEE %
=EE& '
newEE( +%
TokenValidationParametersEE, E
{FF 
ValidateIssuerGG 
=GG 
trueGG 
,GG 
ValidateAudienceHH 
=HH 
trueHH 
,HH  
ValidateLifetimeII 
=II 
trueII 
,II  $
ValidateIssuerSigningKeyJJ  
=JJ! "
trueJJ# '
,JJ' (
ValidIssuerKK 
=KK 
builderKK 
.KK 
ConfigurationKK +
[KK+ ,
$strKK, 8
]KK8 9
,KK9 :
ValidAudienceLL 
=LL 
builderLL 
.LL  
ConfigurationLL  -
[LL- .
$strLL. :
]LL: ;
,LL; <
IssuerSigningKeyMM 
=MM 
newMM  
SymmetricSecurityKeyMM 3
(MM3 4
EncodingMM4 <
.MM< =
UTF8MM= A
.MMA B
GetBytesMMB J
(MMJ K
builderMMK R
.MMR S
ConfigurationMMS `
[MM` a
$strMMa j
]MMj k
!MMk l
)MMl m
)MMm n
}NN 
;NN 
optionsOO 
.OO 
EventsOO 
=OO 
newOO 
JwtBearerEventsOO (
{PP 
OnMessageReceivedQQ 
=QQ 
contextQQ #
=>QQ$ &
{QQ' (
contextRR 
.RR 
TokenRR 
=RR 
contextRR #
.RR# $
RequestRR$ +
.RR+ ,
CookiesRR, 3
[RR3 4
$strRR4 B
]RRB C
;RRC D
returnSS 
TaskSS 
.SS 
CompletedTaskSS %
;SS% &
}TT 	
}UU 
;UU 
}VV 
)VV 
;VV 
builderXX 
.XX 
ServicesXX 
.XX 
AddAuthorizationXX !
(XX! "
)XX" #
;XX# $
builder[[ 
.[[ 
Services[[ 
.[[ %
AddDistributedMemoryCache[[ *
([[* +
)[[+ ,
;[[, -
builder\\ 
.\\ 
Services\\ 
.\\ 

AddSession\\ 
(\\ 
options\\ #
=>\\$ &
{]] 
options^^ 
.^^ 
IdleTimeout^^ 
=^^ 
TimeSpan^^ "
.^^" #
FromMinutes^^# .
(^^. /
$num^^/ 1
)^^1 2
;^^2 3
options__ 
.__ 
Cookie__ 
.__ 
HttpOnly__ 
=__ 
true__ "
;__" #
options`` 
.`` 
Cookie`` 
.`` 
IsEssential`` 
=``  
true``! %
;``% &
}aa 
)aa 
;aa 
varcc 
appcc 
=cc 	
buildercc
 
.cc 
Buildcc 
(cc 
)cc 
;cc 
ifff 
(ff 
!ff 
appff 
.ff 	
Environmentff	 
.ff 
IsDevelopmentff "
(ff" #
)ff# $
)ff$ %
{gg 
apphh 
.hh 
UseExceptionHandlerhh 
(hh 
$strhh )
)hh) *
;hh* +
appii 
.ii 
UseHstsii 
(ii 
)ii 
;ii 
}jj 
varmm 
securityHeadersmm 
=mm 
appmm 
.mm 
Servicesmm "
.mm" #
GetRequiredServicemm# 5
<mm5 6"
SecurityHeadersServicemm6 L
>mmL M
(mmM N
)mmN O
;mmO P
appoo 
.oo 
Useoo 
(oo 
asyncoo 
(oo 
contextoo 
,oo 
nextoo 
)oo 
=>oo  
{pp 
varrr 
scriptNoncerr 
=rr 
Convertrr 
.rr 
ToBase64Stringrr ,
(rr, -!
RandomNumberGeneratorrr- B
.rrB C
GetBytesrrC K
(rrK L
$numrrL N
)rrN O
)rrO P
;rrP Q
contextss 
.ss 
Itemsss 
[ss 
$strss 
]ss  
=ss! "
scriptNoncess# .
;ss. /
contextvv 
.vv 
Responsevv 
.vv 
Headersvv 
.vv 
Addvv  
(vv  !
$strvv! 2
,vv2 3
$strvv4 @
)vv@ A
;vvA B
contextyy 
.yy 
Responseyy 
.yy 
Headersyy 
.yy 
Addyy  
(yy  !
$strzz !
,zz! "
securityHeaders{{ 
.{{ 
GetCSPHeader{{ $
({{$ %
scriptNonce{{% 0
){{0 1
)|| 
;|| 
context 
. 
Response 
. 
Headers 
. 
Add  
(  !
$str! 9
,9 :
$str; D
)D E
;E F
context
ÄÄ 
.
ÄÄ 
Response
ÄÄ 
.
ÄÄ 
Headers
ÄÄ 
.
ÄÄ 
Add
ÄÄ  
(
ÄÄ  !
$str
ÄÄ! 2
,
ÄÄ2 3
$str
ÄÄ4 U
)
ÄÄU V
;
ÄÄV W
context
ÅÅ 
.
ÅÅ 
Response
ÅÅ 
.
ÅÅ 
Headers
ÅÅ 
.
ÅÅ 
Add
ÅÅ  
(
ÅÅ  !
$str
ÅÅ! 5
,
ÅÅ5 6
$str
ÇÇ w
)
ÇÇw x
;
ÇÇx y
context
ÉÉ 
.
ÉÉ 
Response
ÉÉ 
.
ÉÉ 
Headers
ÉÉ 
.
ÉÉ 
Add
ÉÉ  
(
ÉÉ  !
$str
ÉÉ! ?
,
ÉÉ? @
$str
ÉÉA O
)
ÉÉO P
;
ÉÉP Q
context
ÑÑ 
.
ÑÑ 
Response
ÑÑ 
.
ÑÑ 
Headers
ÑÑ 
.
ÑÑ 
Add
ÑÑ  
(
ÑÑ  !
$str
ÑÑ! =
,
ÑÑ= >
$str
ÑÑ? L
)
ÑÑL M
;
ÑÑM N
context
ÖÖ 
.
ÖÖ 
Response
ÖÖ 
.
ÖÖ 
Headers
ÖÖ 
.
ÖÖ 
Add
ÖÖ  
(
ÖÖ  !
$str
ÖÖ! ?
,
ÖÖ? @
$str
ÖÖA N
)
ÖÖN O
;
ÖÖO P
await
áá 	
next
áá
 
(
áá 
)
áá 
;
áá 
}àà 
)
àà 
;
àà 
appåå 
.
åå 
UseCors
åå 
(
åå 
)
åå 
;
åå 
appéé 
.
éé 
UseStaticFiles
éé 
(
éé 
)
éé 
;
éé 
appêê 
.
êê 

UseRouting
êê 
(
êê 
)
êê 
;
êê 
appíí 
.
íí 
UseAuthentication
íí 
(
íí 
)
íí 
;
íí 
appìì 
.
ìì 
UseAuthorization
ìì 
(
ìì 
)
ìì 
;
ìì 
appîî 
.
îî 

UseSession
îî 
(
îî 
)
îî 
;
îî 
appññ 
.
ññ  
MapControllerRoute
ññ 
(
ññ 
name
óó 
:
óó 	
$str
óó
 
,
óó 
pattern
òò 
:
òò 
$str
òò 6
)
òò6 7
;
òò7 8
appöö 
.
öö 
Run
öö 
(
öö 
)
öö 	
;
öö	 
«
^C:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Models\SmtpSettings.cs
	namespace 	
Prestamo
 
. 
Web 
. 
Models 
{ 
public 

class 
SmtpSettings 
{ 
public 
string 
Host 
{ 
get  
;  !
set" %
;% &
}' (
public 
int 
Port 
{ 
get 
; 
set "
;" #
}$ %
public 
bool 
	EnableSsl 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
string		 
Password		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
}

 
} Ö
cC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Models\PrestamoViewModel.cs
	namespace 	
Prestamo
 
. 
Web 
. 
Models 
{ 
public 

class 
PrestamoViewModel "
{ 
public 
int 

IdPrestamo 
{ 
get  #
;# $
set% (
;( )
}* +
public 
ClienteInfo 
Cliente "
{# $
get% (
;( )
set* -
;- .
}/ 0
public		 
decimal		 
MontoPrestamo		 $
{		% &
get		' *
;		* +
set		, /
;		/ 0
}		1 2
public

 
decimal

 
ValorInteres

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
public 
decimal 

ValorTotal !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

MonedaInfo 
Moneda  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
Estado 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
FechaCreacion #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
public 

class 
ClienteInfo 
{ 
public 
int 
	IdCliente 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Nombre 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Apellido 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
public 

class 

MonedaInfo 
{ 
public 
int 
IdMoneda 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Nombre 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} Ÿ
`C:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Models\ErrorViewModel.cs
	namespace 	
Prestamo
 
. 
Web 
. 
Models 
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 ¥
iC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Models\ChangePasswordViewModel.cs
	namespace 	
Prestamo
 
. 
Web 
. 
Models 
{ 
public 

class #
ChangePasswordViewModel (
{ 
[ 	
Required	 
] 
[ 	
DataType	 
( 
DataType 
. 
Password #
)# $
]$ %
[		 	
Display			 
(		 
Name		 
=		 
$str		 +
)		+ ,
]		, -
public

 
string

 
CurrentPassword

 %
{

& '
get

( +
;

+ ,
set

- 0
;

0 1
}

2 3
[ 	
Required	 
] 
[ 	
DataType	 
( 
DataType 
. 
Password #
)# $
]$ %
[ 	
Display	 
( 
Name 
= 
$str *
)* +
]+ ,
public 
string 
NewPassword !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Required	 
] 
[ 	
DataType	 
( 
DataType 
. 
Password #
)# $
]$ %
[ 	
Display	 
( 
Name 
= 
$str 4
)4 5
]5 6
[ 	
Compare	 
( 
$str 
, 
ErrorMessage  ,
=- .
$str/ u
)u v
]v w
public 
string 
ConfirmPassword %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 	
Display	 
( 
Name 
= 
$str 0
)0 1
]1 2
public 
string 
? 
VerificationCode '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
=6 7
null8 <
!< =
;= >
} 
} ∫∂
rC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Controllers\SolicitudPrestamoController.cs
	namespace		 	
Prestamo		
 
.		 
Web		 
.		 
Controllers		 "
{

 
[ 
	Authorize 
] 
public 

class '
SolicitudPrestamoController ,
:- .

Controller/ 9
{ 
private 
readonly 
PrestamoData %
_prestamoData& 3
;3 4
private 
readonly 
ClienteData $
_clienteData% 1
;1 2
private 
readonly 
ResumenClienteData +
_resumenClienteData, ?
;? @
private 
readonly 
EmailService %
_emailService& 3
;3 4
private 
readonly 
AuditoriaService )
_auditoriaService* ;
;; <
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
public '
SolicitudPrestamoController *
(* +
PrestamoData+ 7
prestamoData8 D
,D E
ClienteDataF Q
clienteDataR ]
,] ^
ResumenClienteData_ q
resumenClienteData	r Ñ
,
Ñ Ö
EmailService
Ü í
emailService
ì ü
,
ü †
AuditoriaService
° ±
auditoriaService
≤ ¬
)
¬ √
{ 	
_prestamoData 
= 
prestamoData (
;( )
_clienteData 
= 
clienteData &
;& '
_resumenClienteData 
=  !
resumenClienteData" 4
;4 5
_emailService 
= 
emailService (
;( )
_auditoriaService 
= 
auditoriaService  0
;0 1
} 	
[!! 	
	Authorize!!	 
(!! !
AuthenticationSchemes!! (
=!!) *
JwtBearerDefaults!!+ <
.!!< = 
AuthenticationScheme!!= Q
)!!Q R
]!!R S
["" 	
HttpGet""	 
]"" 
[## 	
	Authorize##	 
(## 
Roles## 
=## 
$str## $
)##$ %
]##% &
public$$ 
async$$ 
Task$$ 
<$$ 
IActionResult$$ '
>$$' ( 
ObtenerCedulaCliente$$) =
($$= >
)$$> ?
{%% 	
var&& 
correo&& 
=&& 
User&& 
.&& 
	FindFirst&& '
(&&' (

ClaimTypes&&( 2
.&&2 3
Email&&3 8
)&&8 9
?&&9 :
.&&: ;
Value&&; @
;&&@ A
if'' 
('' 
string'' 
.'' 
IsNullOrEmpty'' $
(''$ %
correo''% +
)''+ ,
)'', -
{(( 
return)) 
RedirectToAction)) '
())' (
$str))( /
,))/ 0
$str))1 7
)))7 8
;))8 9
}** 
var,, 
cliente,, 
=,, 
await,, 
_clienteData,,  ,
.,,, -
ObtenerPorCorreo,,- =
(,,= >
correo,,> D
),,D E
;,,E F
if-- 
(-- 
cliente-- 
==-- 
null-- 
)--  
{.. 
return// 
RedirectToAction// '
(//' (
$str//( /
,/// 0
$str//1 7
)//7 8
;//8 9
}00 
return11 
Ok11 
(11 
new11 
{11 
cedula11 "
=11# $
cliente11% ,
.11, -
NroDocumento11- 9
}11: ;
)11; <
;11< =
}33 	
[55 	
	Authorize55	 
(55 !
AuthenticationSchemes55 (
=55) *
JwtBearerDefaults55+ <
.55< = 
AuthenticationScheme55= Q
)55Q R
]55R S
[66 	
HttpPost66	 
]66 
[77 	
	Authorize77	 
(77 
Roles77 
=77 
$str77 $
)77$ %
]77% &
public88 
async88 
Task88 
<88 
IActionResult88 '
>88' (
CrearSolicitud88) 7
(887 8
[888 9
FromBody889 A
]88A B
SolicitudPrestamo88C T
	solicitud88U ^
)88^ _
{99 	
if:: 
(:: 
!:: 

ModelState:: 
.:: 
IsValid:: #
)::# $
{;; 
return<< 

BadRequest<< !
(<<! "

ModelState<<" ,
)<<, -
;<<- .
}== 
var?? 
userId?? 
=?? 
User?? 
.?? 
	FindFirst?? '
(??' (

ClaimTypes??( 2
.??2 3
NameIdentifier??3 A
)??A B
???B C
.??C D
Value??D I
;??I J
if@@ 
(@@ 
userId@@ 
==@@ 
null@@ 
)@@ 
{AA 
returnBB 
JsonBB 
(BB 
newBB 
{BB  !
successBB" )
=BB* +
falseBB, 1
,BB1 2
messageBB3 :
=BB; <
$strBB= U
}BBV W
)BBW X
;BBX Y
}CC 
	solicitudEE 
.EE 
	IdUsuarioEE 
=EE  !
intEE" %
.EE% &
ParseEE& +
(EE+ ,
userIdEE, 2
)EE2 3
;EE3 4
	solicitudFF 
.FF 
EstadoFF 
=FF 
$strFF *
;FF* +
	solicitudGG 
.GG 
FechaSolicitudGG $
=GG% &
DateTimeGG' /
.GG/ 0
NowGG0 3
;GG3 4
ifJJ 
(JJ 
	solicitudJJ 
.JJ 
NumeroHijosJJ %
>JJ& '
$numJJ( )
)JJ) *
{KK 
	solicitudLL 
.LL 
MontoLL 
-=LL  "
	solicitudLL# ,
.LL, -
NumeroHijosLL- 8
*LL9 :
$numLL; >
;LL> ?
}MM 
varPP 
	historialPP 
=PP 
awaitPP !
_prestamoDataPP" /
.PP/ 0&
ObtenerHistorialCrediticioPP0 J
(PPJ K
	solicitudPPK T
.PPT U
	IdUsuarioPPU ^
)PP^ _
;PP_ `
ifQQ 
(QQ 
	historialQQ 
==QQ 
nullQQ !
)QQ! "
{RR 
	historialSS 
=SS 
newSS 
	EntidadesSS  )
.SS) *
HistorialCrediticioSS* =
{SS> ?
	IdUsuarioSS@ I
=SSJ K
	solicitudSSL U
.SSU V
	IdUsuarioSSV _
,SS_ `
EstadoCrediticioSSa q
=SSr s
$numSSt u
}SSv w
;SSw x
awaitTT 
_auditoriaServiceTT '
.TT' (
RegistrarLogTT( 4
(TT4 5
UserTT5 9
.TT9 :
IdentityTT: B
.TTB C
NameTTC G
,TTG H
$strTTI P
,TTP Q
$"TTR T
$str	TTT Ö
{
TTÖ Ü
	solicitud
TTÜ è
.
TTè ê
	IdUsuario
TTê ô
}
TTô ö
"
TTö õ
)
TTõ ú
;
TTú ù
awaitUU 
_prestamoDataUU #
.UU# $$
CrearHistorialCrediticioUU$ <
(UU< =
	historialUU= F
)UUF G
;UUG H
}VV 
elseWW 
ifWW 
(WW 
	historialWW 
.WW 
EstadoCrediticioWW /
<WW0 1
$numWW2 3
)WW3 4
{XX 
returnYY 
JsonYY 
(YY 
newYY 
{YY  !
successYY" )
=YY* +
falseYY, 1
,YY1 2
messageYY3 :
=YY; <
$strYY= y
}YYz {
)YY{ |
;YY| }
}ZZ 
var]] 
correo]] 
=]] 
User]] 
.]] 
	FindFirst]] '
(]]' (

ClaimTypes]]( 2
.]]2 3
Email]]3 8
)]]8 9
?]]9 :
.]]: ;
Value]]; @
;]]@ A
var^^ 
cliente^^ 
=^^ 
await^^ 
_clienteData^^  ,
.^^, -
ObtenerPorCorreo^^- =
(^^= >
correo^^> D
)^^D E
;^^E F
var__ 
prestamo__ 
=__ 
await__  
_prestamoData__! .
.__. /'
ObtenerIdPrestamoPorCliente__/ J
(__J K
cliente__K R
.__R S
	IdCliente__S \
)__\ ]
;__] ^
var`` 
resumen`` 
=`` 
await`` 
_resumenClienteData``  3
.``3 4
ObtenerResumen``4 B
(``B C
cliente``C J
.``J K
	IdCliente``K T
,``T U
prestamo``V ^
)``^ _
;``_ `
ifbb 
(bb 
resumenbb 
.bb "
PagosClientePendientesbb .
!=bb/ 1
$strbb2 5
)bb5 6
{cc 
returndd 
Jsondd 
(dd 
newdd 
{dd  !
successdd" )
=dd* +
falsedd, 1
,dd1 2
messagedd3 :
=dd; <
$strdd= p
}ddq r
)ddr s
;dds t
}ee 
ifhh 
(hh 
	solicitudhh 
.hh 
Montohh 
>hh  !
	solicitudhh" +
.hh+ ,
Sueldohh, 2
*hh3 4
$numhh5 6
)hh6 7
{ii 
returnjj 
Jsonjj 
(jj 
newjj 
{jj  !
successjj" )
=jj* +
falsejj, 1
,jj1 2
messagejj3 :
=jj; <
$strjj= z
}jj{ |
)jj| }
;jj} ~
}kk 
trymm 
{nn 
booloo 
	resultadooo 
=oo  
awaitoo! &
_prestamoDataoo' 4
.oo4 5"
CrearSolicitudPrestamooo5 K
(ooK L
	solicitudooL U
)ooU V
;ooV W
ifpp 
(pp 
	resultadopp 
)pp 
{qq 
awaitrr 
_auditoriaServicerr +
.rr+ ,
RegistrarLogrr, 8
(rr8 9
Userrr9 =
.rr= >
Identityrr> F
.rrF G
NamerrG K
,rrK L
$strrrM T
,rrT U
$"rrV X
$str	rrX ä
{
rrä ã
	solicitud
rrã î
.
rrî ï
	IdUsuario
rrï û
}
rrû ü
"
rrü †
)
rr† °
;
rr° ¢
}ss 
returntt 
Jsontt 
(tt 
newtt 
{tt  !
successtt" )
=tt* +
	resultadott, 5
}tt6 7
)tt7 8
;tt8 9
}uu 
catchvv 
(vv 
	Exceptionvv 
exvv 
)vv  
{ww 
returnxx 
Jsonxx 
(xx 
newxx 
{xx  !
successxx" )
=xx* +
falsexx, 1
,xx1 2
messagexx3 :
=xx; <
exxx= ?
.xx? @
Messagexx@ G
}xxH I
)xxI J
;xxJ K
}yy 
}zz 	
[}} 	
	Authorize}}	 
(}} 
Roles}} 
=}} 
$str}} *
)}}* +
]}}+ ,
public~~ 
IActionResult~~  
GestionarSolicitudes~~ 1
(~~1 2
)~~2 3
{ 	
return
ÄÄ 
View
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
[
ÉÉ 	
	Authorize
ÉÉ	 
(
ÉÉ #
AuthenticationSchemes
ÉÉ (
=
ÉÉ) *
JwtBearerDefaults
ÉÉ+ <
.
ÉÉ< ="
AuthenticationScheme
ÉÉ= Q
)
ÉÉQ R
]
ÉÉR S
[
ÑÑ 	
	Authorize
ÑÑ	 
(
ÑÑ 
Roles
ÑÑ 
=
ÑÑ 
$str
ÑÑ *
)
ÑÑ* +
]
ÑÑ+ ,
[
ÖÖ 	
HttpGet
ÖÖ	 
]
ÖÖ 
public
ÜÜ 
async
ÜÜ 
Task
ÜÜ 
<
ÜÜ 
IActionResult
ÜÜ '
>
ÜÜ' (*
ObtenerSolicitudesPendientes
ÜÜ) E
(
ÜÜE F
)
ÜÜF G
{
áá 	
var
àà 
solicitudes
àà 
=
àà 
await
àà #
_prestamoData
àà$ 1
.
àà1 2*
ObtenerSolicitudesPendientes
àà2 N
(
ààN O
)
ààO P
;
ààP Q
return
ââ 
Json
ââ 
(
ââ 
new
ââ 
{
ââ 
data
ââ "
=
ââ# $
solicitudes
ââ% 0
}
ââ1 2
)
ââ2 3
;
ââ3 4
}
ää 	
[
åå 	
	Authorize
åå	 
(
åå #
AuthenticationSchemes
åå (
=
åå) *
JwtBearerDefaults
åå+ <
.
åå< ="
AuthenticationScheme
åå= Q
)
ååQ R
]
ååR S
[
çç 	
	Authorize
çç	 
(
çç 
Roles
çç 
=
çç 
$str
çç *
)
çç* +
]
çç+ ,
[
éé 	
HttpGet
éé	 
]
éé 
public
èè 
async
èè 
Task
èè 
<
èè 
IActionResult
èè '
>
èè' (
ObtenerSolicitud
èè) 9
(
èè9 :
int
èè: =
id
èè> @
)
èè@ A
{
êê 	
if
ëë 
(
ëë 
!
ëë 

ModelState
ëë 
.
ëë 
IsValid
ëë #
)
ëë# $
{
íí 
return
ìì 

BadRequest
ìì !
(
ìì! "

ModelState
ìì" ,
)
ìì, -
;
ìì- .
}
îî 
var
ïï 
	solicitud
ïï 
=
ïï 
await
ïï !
_prestamoData
ïï" /
.
ïï/ 0#
ObtenerSolicitudPorId
ïï0 E
(
ïïE F
id
ïïF H
)
ïïH I
;
ïïI J
if
ññ 
(
ññ 
	solicitud
ññ 
==
ññ 
null
ññ !
)
ññ! "
{
óó 
return
òò 
Json
òò 
(
òò 
new
òò 
{
òò  !
success
òò" )
=
òò* +
false
òò, 1
,
òò1 2
message
òò3 :
=
òò; <
$str
òò= V
}
òòW X
)
òòX Y
;
òòY Z
}
ôô 
return
öö 
Json
öö 
(
öö 
new
öö 
{
öö 
success
öö %
=
öö& '
true
öö( ,
,
öö, -
data
öö. 2
=
öö3 4
	solicitud
öö5 >
}
öö? @
)
öö@ A
;
ööA B
}
õõ 	
[
ùù 	
	Authorize
ùù	 
(
ùù #
AuthenticationSchemes
ùù (
=
ùù) *
JwtBearerDefaults
ùù+ <
.
ùù< ="
AuthenticationScheme
ùù= Q
)
ùùQ R
]
ùùR S
[
ûû 	
	Authorize
ûû	 
(
ûû 
Roles
ûû 
=
ûû 
$str
ûû *
)
ûû* +
]
ûû+ ,
[
üü 	
HttpPost
üü	 
]
üü 
public
†† 
async
†† 
Task
†† 
<
†† 
IActionResult
†† '
>
††' ('
ActualizarEstadoSolicitud
††) B
(
††B C
[
††C D
FromBody
††D L
]
††L M*
SolicitudEstadoUpdateRequest
††N j
request
††k r
)
††r s
{
°° 	
if
¢¢ 
(
¢¢ 
!
¢¢ 

ModelState
¢¢ 
.
¢¢ 
IsValid
¢¢ #
)
¢¢# $
{
££ 
return
§§ 

BadRequest
§§ !
(
§§! "

ModelState
§§" ,
)
§§, -
;
§§- .
}
•• 
try
¶¶ 
{
ßß 
bool
®® 
	resultado
®® 
=
®®  
await
®®! &
_prestamoData
®®' 4
.
®®4 5'
ActualizarEstadoSolicitud
®®5 N
(
®®N O
request
®®O V
.
®®V W
Id
®®W Y
,
®®Y Z
request
®®[ b
.
®®b c
Estado
®®c i
)
®®i j
;
®®j k
if
©© 
(
©© 
	resultado
©© 
)
©© 
{
™™ 
var
´´ 
	solicitud
´´ !
=
´´" #
await
´´$ )
_prestamoData
´´* 7
.
´´7 8#
ObtenerSolicitudPorId
´´8 M
(
´´M N
request
´´N U
.
´´U V
Id
´´V X
)
´´X Y
;
´´Y Z
if
¨¨ 
(
¨¨ 
	solicitud
¨¨ !
==
¨¨" $
null
¨¨% )
)
¨¨) *
{
≠≠ 
return
ÆÆ 
Json
ÆÆ #
(
ÆÆ# $
new
ÆÆ$ '
{
ÆÆ( )
success
ÆÆ* 1
=
ÆÆ2 3
false
ÆÆ4 9
,
ÆÆ9 :
message
ÆÆ; B
=
ÆÆC D
$str
ÆÆE ^
}
ÆÆ_ `
)
ÆÆ` a
;
ÆÆa b
}
ØØ 
var
±± 
cliente
±± 
=
±±  !
await
±±" '
_clienteData
±±( 4
.
±±4 5
ObtenerPorCedula
±±5 E
(
±±E F
	solicitud
±±F O
.
±±O P
Cedula
±±P V
)
±±V W
;
±±W X
if
≤≤ 
(
≤≤ 
cliente
≤≤ 
==
≤≤  "
null
≤≤# '
)
≤≤' (
{
≥≥ 
return
¥¥ 
Json
¥¥ #
(
¥¥# $
new
¥¥$ '
{
¥¥( )
success
¥¥* 1
=
¥¥2 3
false
¥¥4 9
,
¥¥9 :
message
¥¥; B
=
¥¥C D
$str
¥¥E \
}
¥¥] ^
)
¥¥^ _
;
¥¥_ `
}
µµ 
if
∑∑ 
(
∑∑ 
request
∑∑ 
.
∑∑  
Estado
∑∑  &
==
∑∑' )
$str
∑∑* 5
)
∑∑5 6
{
∏∏ 
string
ππ 
asunto
ππ %
=
ππ& '
$str
ππ( I
;
ππI J
string
∫∫ 
mensaje
∫∫ &
=
∫∫' (
$"
∫∫) +
$str
∫∫+ 4
{
∫∫4 5
cliente
∫∫5 <
.
∫∫< =
Nombre
∫∫= C
+
∫∫D E
$str
∫∫F I
+
∫∫J K
cliente
∫∫L S
.
∫∫S T
Apellido
∫∫T \
}
∫∫\ ]
$str∫∫] ·
"∫∫· ‚
;∫∫‚ „
await
ªª 
_auditoriaService
ªª /
.
ªª/ 0
RegistrarLog
ªª0 <
(
ªª< =
User
ªª= A
.
ªªA B
Identity
ªªB J
.
ªªJ K
Name
ªªK O
,
ªªO P
$str
ªªQ ]
,
ªª] ^
$"
ªª_ a
$strªªa ñ
{ªªñ ó
clienteªªó û
.ªªû ü
	IdClienteªªü ®
}ªª® ©
"ªª© ™
)ªª™ ´
;ªª´ ¨
await
ºº 
_emailService
ºº +
.
ºº+ ,
EnviarCorreoAsync
ºº, =
(
ºº= >
cliente
ºº> E
.
ººE F
Correo
ººF L
,
ººL M
asunto
ººN T
,
ººT U
mensaje
ººV ]
)
ºº] ^
;
ºº^ _
}
ΩΩ 
else
ææ 
if
ææ 
(
ææ 
request
ææ $
.
ææ$ %
Estado
ææ% +
==
ææ, .
$str
ææ/ 9
)
ææ9 :
{
øø 
var
¡¡ 
	historial
¡¡ %
=
¡¡& '
await
¡¡( -
_prestamoData
¡¡. ;
.
¡¡; <(
ObtenerHistorialCrediticio
¡¡< V
(
¡¡V W
	solicitud
¡¡W `
.
¡¡` a
	IdUsuario
¡¡a j
)
¡¡j k
;
¡¡k l
if
¬¬ 
(
¬¬ 
	historial
¬¬ %
!=
¬¬& (
null
¬¬) -
)
¬¬- .
{
√√ 
await
ƒƒ !
_prestamoData
ƒƒ" /
.
ƒƒ/ 0+
ActualizarHistorialCrediticio
ƒƒ0 M
(
ƒƒM N
	historial
ƒƒN W
.
ƒƒW X
	IdUsuario
ƒƒX a
,
ƒƒa b
true
ƒƒc g
)
ƒƒg h
;
ƒƒh i
}
≈≈ 
string
«« 
asunto
«« %
=
««& '
$str
««( H
;
««H I
string
»» 
mensaje
»» &
=
»»' (
$"
»») +
$str
»»+ 4
{
»»4 5
cliente
»»5 <
.
»»< =
Nombre
»»= C
+
»»D E
$str
»»F I
+
»»J K
cliente
»»L S
.
»»S T
Apellido
»»T \
}
»»\ ]
$str»»] ÿ
"»»ÿ Ÿ
;»»Ÿ ⁄
await
…… 
_emailService
…… +
.
……+ ,
EnviarCorreoAsync
……, =
(
……= >
cliente
……> E
.
……E F
Correo
……F L
,
……L M
asunto
……N T
,
……T U
mensaje
……V ]
)
……] ^
;
……^ _
await
   
_auditoriaService
   /
.
  / 0
RegistrarLog
  0 <
(
  < =
User
  = A
.
  A B
Identity
  B J
.
  J K
Name
  K O
,
  O P
$str
  Q ]
,
  ] ^
$"
  _ a
$str  a ï
{  ï ñ
cliente  ñ ù
.  ù û
	IdCliente  û ß
}  ß ®
"  ® ©
)  © ™
;  ™ ´
return
ÃÃ 
Json
ÃÃ #
(
ÃÃ# $
new
ÃÃ$ '
{
ÃÃ( )
success
ÃÃ* 1
=
ÃÃ2 3
true
ÃÃ4 8
,
ÃÃ8 9
redirectUrl
ÃÃ: E
=
ÃÃF G
$str
ÃÃH Y
,
ÃÃY Z
	historial
ÃÃ[ d
}
ÃÃe f
)
ÃÃf g
;
ÃÃg h
}
ÕÕ 
}
ŒŒ 
return
œœ 
Json
œœ 
(
œœ 
new
œœ 
{
œœ  !
success
œœ" )
=
œœ* +
	resultado
œœ, 5
}
œœ6 7
)
œœ7 8
;
œœ8 9
}
–– 
catch
—— 
(
—— 
	Exception
—— 
ex
—— 
)
——  
{
““ 
Console
‘‘ 
.
‘‘ 
	WriteLine
‘‘ !
(
‘‘! "
ex
‘‘" $
.
‘‘$ %
Message
‘‘% ,
)
‘‘, -
;
‘‘- .
return
’’ 

StatusCode
’’ !
(
’’! "
StatusCodes
’’" -
.
’’- .*
Status500InternalServerError
’’. J
,
’’J K
new
’’L O
{
’’P Q
success
’’R Y
=
’’Z [
false
’’\ a
,
’’a b
message
’’c j
=
’’k l
$str’’m ú
}’’ù û
)’’û ü
;’’ü †
}
÷÷ 
}
◊◊ 	
public
ŸŸ 
class
ŸŸ *
SolicitudEstadoUpdateRequest
ŸŸ 1
{
⁄⁄ 	
public
€€ 
int
€€ 
Id
€€ 
{
€€ 
get
€€ 
;
€€  
set
€€! $
;
€€$ %
}
€€& '
public
‹‹ 
string
‹‹ 
Estado
‹‹  
{
‹‹! "
get
‹‹# &
;
‹‹& '
set
‹‹( +
;
‹‹+ ,
}
‹‹- .
}
›› 	
}
ﬁﬁ 
}ﬂﬂ ∫3
iC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Controllers\RegisterController.cs
	namespace 	
Prestamo
 
. 
Web 
. 
Controllers "
{ 
public 

class 
RegisterController #
:$ %

Controller& 0
{ 
private 
readonly 
UsuarioData $
_usuarioData% 1
;1 2
public 
RegisterController !
(! "
UsuarioData" -
usuarioData. 9
)9 :
{ 	
_usuarioData 
= 
usuarioData &
;& '
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
[ 	$
ValidateAntiForgeryToken	 !
]! "
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
string/ 5
nombreCompleto6 D
,D E
stringF L
correoM S
,S T
stringU [
clave\ a
)a b
{   	
if!! 
(!! 
string!! 
.!! 
IsNullOrEmpty!! $
(!!$ %
nombreCompleto!!% 3
)!!3 4
||!!5 7
string!!8 >
.!!> ?
IsNullOrEmpty!!? L
(!!L M
correo!!M S
)!!S T
||!!U W
string!!X ^
.!!^ _
IsNullOrEmpty!!_ l
(!!l m
clave!!m r
)!!r s
)!!s t
{"" 
ViewData## 
[## 
$str## "
]##" #
=##$ %
$str##& I
;##I J
return$$ 
View$$ 
($$ 
)$$ 
;$$ 
}%% 
if(( 
((( 
!(( 
Regex(( 
.(( 
IsMatch(( 
((( 
correo(( %
,((% &
$str((' D
,((D E
RegexOptions((F R
.((R S
None((S W
,((W X
TimeSpan((Y a
.((a b
FromMilliseconds((b r
(((r s
$num((s v
)((v w
)((w x
)((x y
{)) 
ViewData** 
[** 
$str** "
]**" #
=**$ %
$str**& O
;**O P
return++ 
View++ 
(++ 
)++ 
;++ 
},, 
var// 
usuarioExistente//  
=//! "
await//# (
_usuarioData//) 5
.//5 6
ObtenerPorCorreo//6 F
(//F G
correo//G M
)//M N
;//N O
if00 
(00 
usuarioExistente00  
!=00! #
null00$ (
)00( )
{11 
ViewData22 
[22 
$str22 "
]22" #
=22$ %
$str22& P
;22P Q
return33 
View33 
(33 
)33 
;33 
}44 
string77 
hashedClave77 
=77  
BCrypt77! '
.77' (
Net77( +
.77+ ,
BCrypt77, 2
.772 3
HashPassword773 ?
(77? @
clave77@ E
)77E F
;77F G
Usuario99 
nuevoUsuario99  
=99! "
new99# &
Usuario99' .
{:: 
NombreCompleto;; 
=;;  
nombreCompleto;;! /
,;;/ 0
Correo<< 
=<< 
correo<< 
,<<  
Clave== 
=== 
hashedClave== #
,==# $
Rol>> 
=>> 
$str>> %
}?? 
;?? 
boolAA 
usuarioCreadoAA 
=AA  
awaitAA! &
_usuarioDataAA' 3
.AA3 4
CrearAA4 9
(AA9 :
nuevoUsuarioAA: F
)AAF G
;AAG H
ifCC 
(CC 
!CC 
usuarioCreadoCC 
)CC 
{DD 
ViewDataEE 
[EE 
$strEE "
]EE" #
=EE$ %
$strEE& A
;EEA B
returnFF 
ViewFF 
(FF 
)FF 
;FF 
}GG 
ViewDataII 
[II 
$strII 
]II 
=II  !
$strII" ?
;II? @
ListLL 
<LL 
ClaimLL 
>LL 
claimsLL 
=LL  
newLL! $
ListLL% )
<LL) *
ClaimLL* /
>LL/ 0
{MM 
newNN 
ClaimNN 
(NN 

ClaimTypesNN $
.NN$ %
NameNN% )
,NN) *
nuevoUsuarioNN+ 7
.NN7 8
NombreCompletoNN8 F
)NNF G
,NNG H
newOO 
ClaimOO 
(OO 

ClaimTypesOO $
.OO$ %
NameIdentifierOO% 3
,OO3 4
nuevoUsuarioOO5 A
.OOA B
	IdUsuarioOOB K
.OOK L
ToStringOOL T
(OOT U
)OOU V
)OOV W
,OOW X
newPP 
ClaimPP 
(PP 

ClaimTypesPP $
.PP$ %
RolePP% )
,PP) *
nuevoUsuarioPP+ 7
.PP7 8
RolPP8 ;
)PP; <
}QQ 
;QQ 
ClaimsIdentitySS 
claimsIdentitySS )
=SS* +
newSS, /
ClaimsIdentitySS0 >
(SS> ?
claimsSS? E
,SSE F(
CookieAuthenticationDefaultsSSG c
.SSc d 
AuthenticationSchemeSSd x
)SSx y
;SSy z$
AuthenticationPropertiesTT $

propertiesTT% /
=TT0 1
newTT2 5$
AuthenticationPropertiesTT6 N
{UU 
AllowRefreshVV 
=VV 
trueVV #
}WW 
;WW 
awaitYY 
HttpContextYY 
.YY 
SignInAsyncYY )
(YY) *(
CookieAuthenticationDefaultsYY* F
.YYF G 
AuthenticationSchemeYYG [
,YY[ \
newYY] `
ClaimsPrincipalYYa p
(YYp q
claimsIdentityYYq 
)	YY Ä
,
YYÄ Å

properties
YYÇ å
)
YYå ç
;
YYç é
returnZZ 
RedirectToActionZZ #
(ZZ# $
$strZZ$ +
,ZZ+ ,
$strZZ- 3
)ZZ3 4
;ZZ4 5
}[[ 	
}\\ 
}]] ÕØ
iC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Controllers\PrestamoController.cs
	namespace 	
Prestamo
 
. 
Web 
. 
Controllers "
{ 
[ 
	Authorize 
] 
public 

class 
PrestamoController #
:$ %

Controller& 0
{ 
private 
readonly 
ClienteData $
_clienteData% 1
;1 2
private 
readonly 
PrestamoData %
_prestamoData& 3
;3 4
private 
readonly 
AuditoriaService )
_auditoriaService* ;
;; <
public 
PrestamoController !
(! "
ClienteData" -
clienteData. 9
,9 :
PrestamoData; G
prestamoDataH T
,T U
AuditoriaServiceV f
auditoriaServiceg w
)w x
{ 	
_clienteData 
= 
clienteData &
;& '
_prestamoData 
= 
prestamoData (
;( )
_auditoriaService 
= 
auditoriaService  0
;0 1
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
public   
IActionResult   
Nuevo   "
(  " #
)  # $
{!! 	
return"" 
View"" 
("" 
)"" 
;"" 
}## 	
[%% 	
	Authorize%%	 
(%% !
AuthenticationSchemes%% (
=%%) *
JwtBearerDefaults%%+ <
.%%< = 
AuthenticationScheme%%= Q
)%%Q R
]%%R S
[&& 	
HttpGet&&	 
]&& 
['' 	
	Authorize''	 
('' 
Roles'' 
='' 
$str'' 2
)''2 3
]''3 4
public(( 
async(( 
Task(( 
<(( 
IActionResult(( '
>((' (
ObtenerCliente(() 7
(((7 8
string((8 >
NroDocumento((? K
)((K L
{)) 	
Cliente** 
objeto** 
=** 
await** "
_clienteData**# /
.**/ 0
Obtener**0 7
(**7 8
NroDocumento**8 D
)**D E
;**E F
return++ 

StatusCode++ 
(++ 
StatusCodes++ )
.++) *
Status200OK++* 5
,++5 6
new++7 :
{++; <
data++= A
=++B C
objeto++D J
}++K L
)++L M
;++M N
},, 	
[.. 	
	Authorize..	 
(.. !
AuthenticationSchemes.. (
=..) *
JwtBearerDefaults..+ <
...< = 
AuthenticationScheme..= Q
)..Q R
]..R S
[// 	
HttpGet//	 
]// 
[00 	
	Authorize00	 
(00 
Roles00 
=00 
$str00 3
)003 4
]004 5
public11 
async11 
Task11 
<11 
IActionResult11 '
>11' ( 
ObtenerCedulaCliente11) =
(11= >
)11> ?
{22 	
var33 
correo33 
=33 
User33 
.33 
	FindFirst33 '
(33' (

ClaimTypes33( 2
.332 3
Email333 8
)338 9
?339 :
.33: ;
Value33; @
;33@ A
Console44 
.44 
	WriteLine44 
(44 
correo44 $
)44$ %
;44% &
if55 
(55 
string55 
.55 
IsNullOrEmpty55 $
(55$ %
correo55% +
)55+ ,
)55, -
{66 
return77 
RedirectToAction77 '
(77' (
$str77( /
,77/ 0
$str771 7
)777 8
;778 9
}88 
var:: 
cliente:: 
=:: 
await:: 
_clienteData::  ,
.::, -
ObtenerPorCorreo::- =
(::= >
correo::> D
)::D E
;::E F
Console;; 
.;; 
	WriteLine;; 
(;; 
cliente;; %
.;;% &
NroDocumento;;& 2
);;2 3
;;;3 4
if<< 
(<< 
cliente<< 
==<< 
null<< 
)<<  
{== 
return>> 
RedirectToAction>> '
(>>' (
$str>>( /
,>>/ 0
$str>>1 7
)>>7 8
;>>8 9
}?? 
return@@ 
Ok@@ 
(@@ 
new@@ 
{@@ 
cedula@@ "
=@@# $
cliente@@% ,
.@@, -
NroDocumento@@- 9
}@@: ;
)@@; <
;@@< =
}BB 	
[DD 	
	AuthorizeDD	 
(DD !
AuthenticationSchemesDD (
=DD) *
JwtBearerDefaultsDD+ <
.DD< = 
AuthenticationSchemeDD= Q
)DDQ R
]DDR S
[EE 	
HttpPostEE	 
]EE 
[FF 	
	AuthorizeFF	 
(FF 
RolesFF 
=FF 
$strFF *
)FF* +
]FF+ ,
publicGG 
asyncGG 
TaskGG 
<GG 
IActionResultGG '
>GG' (
CrearGG) .
(GG. /
[GG/ 0
FromBodyGG0 8
]GG8 9
PrestamoGG: B
.GGB C
	EntidadesGGC L
.GGL M
PrestamoGGM U
objetoGGV \
)GG\ ]
{HH 	
ifII 
(II 
!II 

ModelStateII 
.II 
IsValidII #
)II# $
{JJ 
returnKK 

BadRequestKK !
(KK! "

ModelStateKK" ,
)KK, -
;KK- .
}LL 
stringMM 
	respuestaMM 
=MM 
awaitMM $
_prestamoDataMM% 2
.MM2 3
CrearMM3 8
(MM8 9
objetoMM9 ?
)MM? @
;MM@ A
awaitNN 
_auditoriaServiceNN #
.NN# $
RegistrarLogNN$ 0
(NN0 1
UserNN1 5
.NN5 6
IdentityNN6 >
.NN> ?
NameNN? C
,NNC D
$strNNE L
,NNL M
$"NNN P
$strNNP a
{NNa b
objetoNNb h
.NNh i

IdPrestamoNNi s
}NNs t
"NNt u
)NNu v
;NNv w
returnOO 

StatusCodeOO 
(OO 
StatusCodesOO )
.OO) *
Status200OKOO* 5
,OO5 6
newOO7 :
{OO; <
dataOO= A
=OOB C
	respuestaOOD M
}OON O
)OOO P
;OOP Q
}PP 	
[RR 	
	AuthorizeRR	 
(RR !
AuthenticationSchemesRR (
=RR) *
JwtBearerDefaultsRR+ <
.RR< = 
AuthenticationSchemeRR= Q
)RRQ R
]RRR S
[SS 	
HttpGetSS	 
]SS 
[TT 	
	AuthorizeTT	 
(TT 
RolesTT 
=TT 
$strTT 3
)TT3 4
]TT4 5
publicUU 
asyncUU 
TaskUU 
<UU 
IActionResultUU '
>UU' (
ObtenerPrestamosUU) 9
(UU9 :
intUU: =

IdPrestamoUU> H
,UUH I
stringUUJ P
NroDocumentoUUQ ]
)UU] ^
{VV 	
ifWW 
(WW 
!WW 

ModelStateWW 
.WW 
IsValidWW #
)WW# $
{XX 
returnYY 

BadRequestYY !
(YY! "

ModelStateYY" ,
)YY, -
;YY- .
}ZZ 
List[[ 
<[[ 
Prestamo[[ 
.[[ 
	Entidades[[ #
.[[# $
Prestamo[[$ ,
>[[, -
objeto[[. 4
=[[5 6
await[[7 <
_prestamoData[[= J
.[[J K
ObtenerPrestamos[[K [
([[[ \

IdPrestamo[[\ f
,[[f g
NroDocumento[[g s
==[[t v
null[[w {
?[[| }
$str	[[~ Ä
:
[[Ä Å
NroDocumento
[[Ç é
)
[[é è
;
[[è ê
return\\ 

StatusCode\\ 
(\\ 
StatusCodes\\ )
.\\) *
Status200OK\\* 5
,\\5 6
new\\7 :
{\\; <
data\\= A
=\\B C
objeto\\D J
}\\K L
)\\L M
;\\M N
}]] 	
[__ 	
	Authorize__	 
(__ !
AuthenticationSchemes__ (
=__) *
JwtBearerDefaults__+ <
.__< = 
AuthenticationScheme__= Q
)__Q R
]__R S
[`` 	
HttpGet``	 
]`` 
[aa 	
	Authorizeaa	 
(aa 
Rolesaa 
=aa 
$straa 3
)aa3 4
]aa4 5
publicbb 
asyncbb 
Taskbb 
<bb 
IActionResultbb '
>bb' (
ObtenerPrestamos2bb) :
(bb: ;
intbb; >

IdPrestamobb? I
,bbI J
stringbbK Q
NroDocumentobbR ^
)bb^ _
{cc 	
ifdd 
(dd 
!dd 

ModelStatedd 
.dd 
IsValiddd #
)dd# $
{ee 
returnff 

BadRequestff !
(ff! "

ModelStateff" ,
)ff, -
;ff- .
}gg 
Listhh 
<hh 
Prestamohh 
.hh 
	Entidadeshh #
.hh# $
Prestamohh$ ,
>hh, -
objetohh. 4
=hh5 6
awaithh7 <
_prestamoDatahh= J
.hhJ K
ObtenerPrestamos2hhK \
(hh\ ]

IdPrestamohh] g
,hhg h
NroDocumentohhi u
==hhv x
nullhhy }
?hh~ 
$str
hhÄ Ç
:
hhÉ Ñ
NroDocumento
hhÖ ë
)
hhë í
;
hhí ì
returnii 

StatusCodeii 
(ii 
StatusCodesii )
.ii) *
Status200OKii* 5
,ii5 6
newii7 :
{ii; <
dataii= A
=iiB C
objetoiiD J
}iiK L
)iiL M
;iiM N
}jj 	
[ll 	
	Authorizell	 
(ll !
AuthenticationSchemesll (
=ll) *
JwtBearerDefaultsll+ <
.ll< = 
AuthenticationSchemell= Q
)llQ R
]llR S
[mm 	
HttpGetmm	 
]mm 
[nn 	
	Authorizenn	 
(nn 
Rolesnn 
=nn 
$strnn *
)nn* +
]nn+ ,
publicoo 
asyncoo 
Taskoo 
<oo 
IActionResultoo '
>oo' (
ImprimirPrestamooo) 9
(oo9 :
intoo: =

IdPrestamooo> H
)ooH I
{pp 	
ifqq 
(qq 
!qq 

ModelStateqq 
.qq 
IsValidqq #
)qq# $
{rr 
returnss 

BadRequestss !
(ss! "

ModelStatess" ,
)ss, -
;ss- .
}tt 
Listuu 
<uu 
Prestamouu 
.uu 
	Entidadesuu #
.uu# $
Prestamouu$ ,
>uu, -
listauu. 3
=uu4 5
awaituu6 ;
_prestamoDatauu< I
.uuI J
ObtenerPrestamosuuJ Z
(uuZ [

IdPrestamouu[ e
,uue f
$struug i
)uui j
;uuj k
Prestamovv 
.vv 
	Entidadesvv 
.vv 
Prestamovv '
objetovv( .
=vv/ 0
listavv1 6
[vv6 7
$numvv7 8
]vv8 9
;vv9 :
QuestPDFxx 
.xx 
Settingsxx 
.xx 
Licensexx %
=xx& '
QuestPDFxx( 0
.xx0 1
Infrastructurexx1 ?
.xx? @
LicenseTypexx@ K
.xxK L
	CommunityxxL U
;xxU V
varyy 
pdfyy 
=yy 
Documentyy 
.yy 
Createyy %
(yy% &
documentyy& .
=>yy/ 1
{zz 
document{{ 
.{{ 
Page{{ 
({{ 
page{{ "
=>{{# %
{|| 
page~~ 
.~~ 
Margin~~ 
(~~  
$num~~  "
)~~" #
;~~# $
page
ÄÄ 
.
ÄÄ 
Header
ÄÄ 
(
ÄÄ  
)
ÄÄ  !
.
ÄÄ! "
ShowOnce
ÄÄ" *
(
ÄÄ* +
)
ÄÄ+ ,
.
ÄÄ, -

Background
ÄÄ- 7
(
ÄÄ7 8
$str
ÄÄ8 A
)
ÄÄA B
.
ÄÄB C
Padding
ÄÄC J
(
ÄÄJ K
$num
ÄÄK L
)
ÄÄL M
.
ÄÄM N
Row
ÄÄN Q
(
ÄÄQ R
row
ÄÄR U
=>
ÄÄV X
{
ÅÅ 
row
ÇÇ 
.
ÇÇ 
RelativeItem
ÇÇ (
(
ÇÇ( )
)
ÇÇ) *
.
ÇÇ* +
	AlignLeft
ÇÇ+ 4
(
ÇÇ4 5
)
ÇÇ5 6
.
ÇÇ6 7
Text
ÇÇ7 ;
(
ÇÇ; <
$str
ÇÇ< F
)
ÇÇF G
.
ÇÇG H
Bold
ÇÇH L
(
ÇÇL M
)
ÇÇM N
.
ÇÇN O
FontSize
ÇÇO W
(
ÇÇW X
$num
ÇÇX Z
)
ÇÇZ [
;
ÇÇ[ \
row
ÉÉ 
.
ÉÉ 
RelativeItem
ÉÉ (
(
ÉÉ( )
)
ÉÉ) *
.
ÉÉ* +

AlignRight
ÉÉ+ 5
(
ÉÉ5 6
)
ÉÉ6 7
.
ÉÉ7 8
Text
ÉÉ8 <
(
ÉÉ< =
$"
ÉÉ= ?
$str
ÉÉ? D
{
ÉÉD E
objeto
ÉÉE K
.
ÉÉK L

IdPrestamo
ÉÉL V
}
ÉÉV W
"
ÉÉW X
)
ÉÉX Y
.
ÉÉY Z
Bold
ÉÉZ ^
(
ÉÉ^ _
)
ÉÉ_ `
.
ÉÉ` a
FontSize
ÉÉa i
(
ÉÉi j
$num
ÉÉj l
)
ÉÉl m
;
ÉÉm n
}
ÑÑ 
)
ÑÑ 
;
ÑÑ 
page
ÜÜ 
.
ÜÜ 
Content
ÜÜ  
(
ÜÜ  !
)
ÜÜ! "
.
ÜÜ" #
PaddingVertical
ÜÜ# 2
(
ÜÜ2 3
$num
ÜÜ3 5
)
ÜÜ5 6
.
ÜÜ6 7
Column
ÜÜ7 =
(
ÜÜ= >
col1
ÜÜ> B
=>
ÜÜC E
{
áá 
col1
àà 
.
àà 
Spacing
àà $
(
àà$ %
$num
àà% '
)
àà' (
;
àà( )
col1
ää 
.
ää 
Item
ää !
(
ää! "
)
ää" #
.
ää# $
Column
ää$ *
(
ää* +
col2
ää+ /
=>
ää0 2
{
ãã 
col2
åå  
.
åå  !
Spacing
åå! (
(
åå( )
$num
åå) *
)
åå* +
;
åå+ ,
col2
çç  
.
çç  !
Item
çç! %
(
çç% &
)
çç& '
.
çç' (
Row
çç( +
(
çç+ ,
row
çç, /
=>
çç0 2
{
éé 
row
èè  #
.
èè# $
RelativeItem
èè$ 0
(
èè0 1
)
èè1 2
.
èè2 3
BorderBottom
èè3 ?
(
èè? @
$num
èè@ A
)
èèA B
.
èèB C
	AlignLeft
èèC L
(
èèL M
)
èèM N
.
èèN O
Text
èèO S
(
èèS T
$str
èèT g
)
èèg h
.
èèh i
Bold
èèi m
(
èèm n
)
èèn o
.
èèo p
FontSize
èèp x
(
èèx y
$num
èèy {
)
èè{ |
;
èè| }
}
êê 
)
êê 
;
êê 
col2
ëë  
.
ëë  !
Item
ëë! %
(
ëë% &
)
ëë& '
.
ëë' (
Row
ëë( +
(
ëë+ ,
row
ëë, /
=>
ëë0 2
{
íí 
row
îî  #
.
îî# $
RelativeItem
îî$ 0
(
îî0 1
)
îî1 2
.
îî2 3
Column
îî3 9
(
îî9 :
col
îî: =
=>
îî> @
{
ïï  !
col
ññ$ '
.
ññ' (
Item
ññ( ,
(
ññ, -
)
ññ- .
.
ññ. /
Text
ññ/ 3
(
ññ3 4
txt
ññ4 7
=>
ññ8 :
{
óó$ %
txt
òò( +
.
òò+ ,
Span
òò, 0
(
òò0 1
$str
òò1 E
)
òòE F
.
òòF G
SemiBold
òòG O
(
òòO P
)
òòP Q
.
òòQ R
FontSize
òòR Z
(
òòZ [
$num
òò[ ]
)
òò] ^
;
òò^ _
txt
ôô( +
.
ôô+ ,
Span
ôô, 0
(
ôô0 1
objeto
ôô1 7
.
ôô7 8
Cliente
ôô8 ?
.
ôô? @
NroDocumento
ôô@ L
)
ôôL M
.
ôôM N
FontSize
ôôN V
(
ôôV W
$num
ôôW Y
)
ôôY Z
;
ôôZ [
}
öö$ %
)
öö% &
;
öö& '
col
õõ$ '
.
õõ' (
Item
õõ( ,
(
õõ, -
)
õõ- .
.
õõ. /
Text
õõ/ 3
(
õõ3 4
txt
õõ4 7
=>
õõ8 :
{
úú$ %
txt
ùù( +
.
ùù+ ,
Span
ùù, 0
(
ùù0 1
$str
ùù1 ;
)
ùù; <
.
ùù< =
SemiBold
ùù= E
(
ùùE F
)
ùùF G
.
ùùG H
FontSize
ùùH P
(
ùùP Q
$num
ùùQ S
)
ùùS T
;
ùùT U
txt
ûû( +
.
ûû+ ,
Span
ûû, 0
(
ûû0 1
objeto
ûû1 7
.
ûû7 8
Cliente
ûû8 ?
.
ûû? @
Nombre
ûû@ F
)
ûûF G
.
ûûG H
FontSize
ûûH P
(
ûûP Q
$num
ûûQ S
)
ûûS T
;
ûûT U
}
üü$ %
)
üü% &
;
üü& '
col
††$ '
.
††' (
Item
††( ,
(
††, -
)
††- .
.
††. /
Text
††/ 3
(
††3 4
txt
††4 7
=>
††8 :
{
°°$ %
txt
¢¢( +
.
¢¢+ ,
Span
¢¢, 0
(
¢¢0 1
$str
¢¢1 =
)
¢¢= >
.
¢¢> ?
SemiBold
¢¢? G
(
¢¢G H
)
¢¢H I
.
¢¢I J
FontSize
¢¢J R
(
¢¢R S
$num
¢¢S U
)
¢¢U V
;
¢¢V W
txt
££( +
.
££+ ,
Span
££, 0
(
££0 1
objeto
££1 7
.
££7 8
Cliente
££8 ?
.
££? @
Apellido
££@ H
)
££H I
.
££I J
FontSize
££J R
(
££R S
$num
££S U
)
££U V
;
££V W
}
§§$ %
)
§§% &
;
§§& '
}
••  !
)
••! "
;
••" #
row
¶¶  #
.
¶¶# $
ConstantItem
¶¶$ 0
(
¶¶0 1
$num
¶¶1 3
)
¶¶3 4
;
¶¶4 5
row
ßß  #
.
ßß# $
RelativeItem
ßß$ 0
(
ßß0 1
)
ßß1 2
.
ßß2 3
Column
ßß3 9
(
ßß9 :
col
ßß: =
=>
ßß> @
{
®®  !
col
©©$ '
.
©©' (
Item
©©( ,
(
©©, -
)
©©- .
.
©©. /
Text
©©/ 3
(
©©3 4
txt
©©4 7
=>
©©8 :
{
™™$ %
txt
´´( +
.
´´+ ,
Span
´´, 0
(
´´0 1
$str
´´1 ;
)
´´; <
.
´´< =
SemiBold
´´= E
(
´´E F
)
´´F G
.
´´G H
FontSize
´´H P
(
´´P Q
$num
´´Q S
)
´´S T
;
´´T U
txt
¨¨( +
.
¨¨+ ,
Span
¨¨, 0
(
¨¨0 1
objeto
¨¨1 7
.
¨¨7 8
Cliente
¨¨8 ?
.
¨¨? @
Correo
¨¨@ F
)
¨¨F G
.
¨¨G H
FontSize
¨¨H P
(
¨¨P Q
$num
¨¨Q S
)
¨¨S T
;
¨¨T U
}
≠≠$ %
)
≠≠% &
;
≠≠& '
col
ÆÆ$ '
.
ÆÆ' (
Item
ÆÆ( ,
(
ÆÆ, -
)
ÆÆ- .
.
ÆÆ. /
Text
ÆÆ/ 3
(
ÆÆ3 4
txt
ÆÆ4 7
=>
ÆÆ8 :
{
ØØ$ %
txt
∞∞( +
.
∞∞+ ,
Span
∞∞, 0
(
∞∞0 1
$str
∞∞1 =
)
∞∞= >
.
∞∞> ?
SemiBold
∞∞? G
(
∞∞G H
)
∞∞H I
.
∞∞I J
FontSize
∞∞J R
(
∞∞R S
$num
∞∞S U
)
∞∞U V
;
∞∞V W
txt
±±( +
.
±±+ ,
Span
±±, 0
(
±±0 1
objeto
±±1 7
.
±±7 8
Cliente
±±8 ?
.
±±? @
Telefono
±±@ H
)
±±H I
.
±±I J
FontSize
±±J R
(
±±R S
$num
±±S U
)
±±U V
;
±±V W
}
≤≤$ %
)
≤≤% &
;
≤≤& '
}
≥≥  !
)
≥≥! "
;
≥≥" #
}
¥¥ 
)
¥¥ 
;
¥¥ 
}
µµ 
)
µµ 
;
µµ 
col1
∑∑ 
.
∑∑ 
Item
∑∑ !
(
∑∑! "
)
∑∑" #
.
∑∑# $
Column
∑∑$ *
(
∑∑* +
col2
∑∑+ /
=>
∑∑0 2
{
∏∏ 
col2
ππ  
.
ππ  !
Spacing
ππ! (
(
ππ( )
$num
ππ) *
)
ππ* +
;
ππ+ ,
col2
∫∫  
.
∫∫  !
Item
∫∫! %
(
∫∫% &
)
∫∫& '
.
∫∫' (
Row
∫∫( +
(
∫∫+ ,
row
∫∫, /
=>
∫∫0 2
{
ªª 
row
ºº  #
.
ºº# $
RelativeItem
ºº$ 0
(
ºº0 1
)
ºº1 2
.
ºº2 3
BorderBottom
ºº3 ?
(
ºº? @
$num
ºº@ A
)
ººA B
.
ººB C
	AlignLeft
ººC L
(
ººL M
)
ººM N
.
ººN O
Text
ººO S
(
ººS T
$str
ººT h
)
ººh i
.
ººi j
Bold
ººj n
(
ººn o
)
ººo p
.
ººp q
FontSize
ººq y
(
ººy z
$num
ººz |
)
ºº| }
;
ºº} ~
}
ΩΩ 
)
ΩΩ 
;
ΩΩ 
col2
øø  
.
øø  !
Item
øø! %
(
øø% &
)
øø& '
.
øø' (
Row
øø( +
(
øø+ ,
row
øø, /
=>
øø0 2
{
¿¿ 
row
¡¡  #
.
¡¡# $
RelativeItem
¡¡$ 0
(
¡¡0 1
)
¡¡1 2
.
¡¡2 3
Column
¡¡3 9
(
¡¡9 :
col
¡¡: =
=>
¡¡> @
{
¬¬  !
col
√√$ '
.
√√' (
Item
√√( ,
(
√√, -
)
√√- .
.
√√. /
Text
√√/ 3
(
√√3 4
txt
√√4 7
=>
√√8 :
{
ƒƒ$ %
txt
≈≈( +
.
≈≈+ ,
Span
≈≈, 0
(
≈≈0 1
$str
≈≈1 C
)
≈≈C D
.
≈≈D E
SemiBold
≈≈E M
(
≈≈M N
)
≈≈N O
.
≈≈O P
FontSize
≈≈P X
(
≈≈X Y
$num
≈≈Y [
)
≈≈[ \
;
≈≈\ ]
txt
∆∆( +
.
∆∆+ ,
Span
∆∆, 0
(
∆∆0 1
objeto
∆∆1 7
.
∆∆7 8
MontoPrestamo
∆∆8 E
)
∆∆E F
.
∆∆F G
FontSize
∆∆G O
(
∆∆O P
$num
∆∆P R
)
∆∆R S
;
∆∆S T
}
««$ %
)
««% &
;
««& '
col
»»$ '
.
»»' (
Item
»»( ,
(
»», -
)
»»- .
.
»». /
Text
»»/ 3
(
»»3 4
txt
»»4 7
=>
»»8 :
{
……$ %
txt
  ( +
.
  + ,
Span
  , 0
(
  0 1
$str
  1 >
)
  > ?
.
  ? @
SemiBold
  @ H
(
  H I
)
  I J
.
  J K
FontSize
  K S
(
  S T
$num
  T V
)
  V W
;
  W X
txt
ÀÀ( +
.
ÀÀ+ ,
Span
ÀÀ, 0
(
ÀÀ0 1
objeto
ÀÀ1 7
.
ÀÀ7 8
InteresPorcentaje
ÀÀ8 I
)
ÀÀI J
.
ÀÀJ K
FontSize
ÀÀK S
(
ÀÀS T
$num
ÀÀT V
)
ÀÀV W
;
ÀÀW X
}
ÃÃ$ %
)
ÃÃ% &
;
ÃÃ& '
col
ÕÕ$ '
.
ÕÕ' (
Item
ÕÕ( ,
(
ÕÕ, -
)
ÕÕ- .
.
ÕÕ. /
Text
ÕÕ/ 3
(
ÕÕ3 4
txt
ÕÕ4 7
=>
ÕÕ8 :
{
ŒŒ$ %
txt
œœ( +
.
œœ+ ,
Span
œœ, 0
(
œœ0 1
$str
œœ1 B
)
œœB C
.
œœC D
SemiBold
œœD L
(
œœL M
)
œœM N
.
œœN O
FontSize
œœO W
(
œœW X
$num
œœX Z
)
œœZ [
;
œœ[ \
txt
––( +
.
––+ ,
Span
––, 0
(
––0 1
objeto
––1 7
.
––7 8
	NroCuotas
––8 A
.
––A B
ToString
––B J
(
––J K
)
––K L
)
––L M
.
––M N
FontSize
––N V
(
––V W
$num
––W Y
)
––Y Z
;
––Z [
}
——$ %
)
——% &
;
——& '
col
““$ '
.
““' (
Item
““( ,
(
““, -
)
““- .
.
““. /
Text
““/ 3
(
““3 4
txt
““4 7
=>
““8 :
{
””$ %
txt
‘‘( +
.
‘‘+ ,
Span
‘‘, 0
(
‘‘0 1
$str
‘‘1 B
)
‘‘B C
.
‘‘C D
SemiBold
‘‘D L
(
‘‘L M
)
‘‘M N
.
‘‘N O
FontSize
‘‘O W
(
‘‘W X
$num
‘‘X Z
)
‘‘Z [
;
‘‘[ \
txt
’’( +
.
’’+ ,
Span
’’, 0
(
’’0 1
objeto
’’1 7
.
’’7 8
FormaDePago
’’8 C
)
’’C D
.
’’D E
FontSize
’’E M
(
’’M N
$num
’’N P
)
’’P Q
;
’’Q R
}
÷÷$ %
)
÷÷% &
;
÷÷& '
col
◊◊$ '
.
◊◊' (
Item
◊◊( ,
(
◊◊, -
)
◊◊- .
.
◊◊. /
Text
◊◊/ 3
(
◊◊3 4
txt
◊◊4 7
=>
◊◊8 :
{
ÿÿ$ %
txt
ŸŸ( +
.
ŸŸ+ ,
Span
ŸŸ, 0
(
ŸŸ0 1
$str
ŸŸ1 @
)
ŸŸ@ A
.
ŸŸA B
SemiBold
ŸŸB J
(
ŸŸJ K
)
ŸŸK L
.
ŸŸL M
FontSize
ŸŸM U
(
ŸŸU V
$num
ŸŸV X
)
ŸŸX Y
;
ŸŸY Z
txt
⁄⁄( +
.
⁄⁄+ ,
Span
⁄⁄, 0
(
⁄⁄0 1
objeto
⁄⁄1 7
.
⁄⁄7 8
Moneda
⁄⁄8 >
.
⁄⁄> ?
Nombre
⁄⁄? E
)
⁄⁄E F
.
⁄⁄F G
FontSize
⁄⁄G O
(
⁄⁄O P
$num
⁄⁄P R
)
⁄⁄R S
;
⁄⁄S T
}
€€$ %
)
€€% &
;
€€& '
}
‹‹  !
)
‹‹! "
;
‹‹" #
row
››  #
.
››# $
ConstantItem
››$ 0
(
››0 1
$num
››1 3
)
››3 4
;
››4 5
row
ﬁﬁ  #
.
ﬁﬁ# $
RelativeItem
ﬁﬁ$ 0
(
ﬁﬁ0 1
)
ﬁﬁ1 2
.
ﬁﬁ2 3
Column
ﬁﬁ3 9
(
ﬁﬁ9 :
col
ﬁﬁ: =
=>
ﬁﬁ> @
{
ﬂﬂ  !
col
‡‡$ '
.
‡‡' (
Item
‡‡( ,
(
‡‡, -
)
‡‡- .
.
‡‡. /
Text
‡‡/ 3
(
‡‡3 4
txt
‡‡4 7
=>
‡‡8 :
{
··$ %
txt
‚‚( +
.
‚‚+ ,
Span
‚‚, 0
(
‚‚0 1
$str
‚‚1 D
)
‚‚D E
.
‚‚E F
SemiBold
‚‚F N
(
‚‚N O
)
‚‚O P
.
‚‚P Q
FontSize
‚‚Q Y
(
‚‚Y Z
$num
‚‚Z \
)
‚‚\ ]
;
‚‚] ^
txt
„„( +
.
„„+ ,
Span
„„, 0
(
„„0 1
objeto
„„1 7
.
„„7 8
ValorPorCuota
„„8 E
)
„„E F
.
„„F G
FontSize
„„G O
(
„„O P
$num
„„P R
)
„„R S
;
„„S T
}
‰‰$ %
)
‰‰% &
;
‰‰& '
col
ÂÂ$ '
.
ÂÂ' (
Item
ÂÂ( ,
(
ÂÂ, -
)
ÂÂ- .
.
ÂÂ. /
Text
ÂÂ/ 3
(
ÂÂ3 4
txt
ÂÂ4 7
=>
ÂÂ8 :
{
ÊÊ$ %
txt
ÁÁ( +
.
ÁÁ+ ,
Span
ÁÁ, 0
(
ÁÁ0 1
$str
ÁÁ1 B
)
ÁÁB C
.
ÁÁC D
SemiBold
ÁÁD L
(
ÁÁL M
)
ÁÁM N
.
ÁÁN O
FontSize
ÁÁO W
(
ÁÁW X
$num
ÁÁX Z
)
ÁÁZ [
;
ÁÁ[ \
txt
ËË( +
.
ËË+ ,
Span
ËË, 0
(
ËË0 1
objeto
ËË1 7
.
ËË7 8
ValorInteres
ËË8 D
)
ËËD E
.
ËËE F
FontSize
ËËF N
(
ËËN O
$num
ËËO Q
)
ËËQ R
;
ËËR S
}
ÈÈ$ %
)
ÈÈ% &
;
ÈÈ& '
col
ÍÍ$ '
.
ÍÍ' (
Item
ÍÍ( ,
(
ÍÍ, -
)
ÍÍ- .
.
ÍÍ. /
Text
ÍÍ/ 3
(
ÍÍ3 4
txt
ÍÍ4 7
=>
ÍÍ8 :
{
ÎÎ$ %
txt
ÏÏ( +
.
ÏÏ+ ,
Span
ÏÏ, 0
(
ÏÏ0 1
$str
ÏÏ1 @
)
ÏÏ@ A
.
ÏÏA B
SemiBold
ÏÏB J
(
ÏÏJ K
)
ÏÏK L
.
ÏÏL M
FontSize
ÏÏM U
(
ÏÏU V
$num
ÏÏV X
)
ÏÏX Y
;
ÏÏY Z
txt
ÌÌ( +
.
ÌÌ+ ,
Span
ÌÌ, 0
(
ÌÌ0 1
objeto
ÌÌ1 7
.
ÌÌ7 8

ValorTotal
ÌÌ8 B
)
ÌÌB C
.
ÌÌC D
FontSize
ÌÌD L
(
ÌÌL M
$num
ÌÌM O
)
ÌÌO P
;
ÌÌP Q
}
ÓÓ$ %
)
ÓÓ% &
;
ÓÓ& '
}
ÔÔ  !
)
ÔÔ! "
;
ÔÔ" #
}
 
)
 
;
 
}
ÒÒ 
)
ÒÒ 
;
ÒÒ 
col1
ÙÙ 
.
ÙÙ 
Item
ÙÙ !
(
ÙÙ! "
)
ÙÙ" #
.
ÙÙ# $
Column
ÙÙ$ *
(
ÙÙ* +
col2
ÙÙ+ /
=>
ÙÙ0 2
{
ıı 
col2
ˆˆ  
.
ˆˆ  !
Spacing
ˆˆ! (
(
ˆˆ( )
$num
ˆˆ) *
)
ˆˆ* +
;
ˆˆ+ ,
col2
˜˜  
.
˜˜  !
Item
˜˜! %
(
˜˜% &
)
˜˜& '
.
˜˜' (
Row
˜˜( +
(
˜˜+ ,
row
˜˜, /
=>
˜˜0 2
{
¯¯ 
row
˘˘  #
.
˘˘# $
RelativeItem
˘˘$ 0
(
˘˘0 1
)
˘˘1 2
.
˘˘2 3
BorderBottom
˘˘3 ?
(
˘˘? @
$num
˘˘@ A
)
˘˘A B
.
˘˘B C
	AlignLeft
˘˘C L
(
˘˘L M
)
˘˘M N
.
˘˘N O
Text
˘˘O S
(
˘˘S T
$str
˘˘T d
)
˘˘d e
.
˘˘e f
Bold
˘˘f j
(
˘˘j k
)
˘˘k l
.
˘˘l m
FontSize
˘˘m u
(
˘˘u v
$num
˘˘v x
)
˘˘x y
;
˘˘y z
}
˙˙ 
)
˙˙ 
;
˙˙ 
col2
˚˚  
.
˚˚  !
Item
˚˚! %
(
˚˚% &
)
˚˚& '
.
˚˚' (
Table
˚˚( -
(
˚˚- .
tabla
˚˚. 3
=>
˚˚4 6
{
¸¸ 
tabla
˝˝  %
.
˝˝% &
ColumnsDefinition
˝˝& 7
(
˝˝7 8
columns
˝˝8 ?
=>
˝˝@ B
{
˛˛  !
columns
ˇˇ$ +
.
ˇˇ+ ,
RelativeColumn
ˇˇ, :
(
ˇˇ: ;
$num
ˇˇ; <
)
ˇˇ< =
;
ˇˇ= >
columns
ÄÄ$ +
.
ÄÄ+ ,
RelativeColumn
ÄÄ, :
(
ÄÄ: ;
)
ÄÄ; <
;
ÄÄ< =
columns
ÅÅ$ +
.
ÅÅ+ ,
RelativeColumn
ÅÅ, :
(
ÅÅ: ;
)
ÅÅ; <
;
ÅÅ< =
columns
ÇÇ$ +
.
ÇÇ+ ,
RelativeColumn
ÇÇ, :
(
ÇÇ: ;
)
ÇÇ; <
;
ÇÇ< =
}
ÑÑ  !
)
ÑÑ! "
;
ÑÑ" #
tabla
ÜÜ  %
.
ÜÜ% &
Header
ÜÜ& ,
(
ÜÜ, -
header
ÜÜ- 3
=>
ÜÜ4 6
{
áá  !
header
àà$ *
.
àà* +
Cell
àà+ /
(
àà/ 0
)
àà0 1
.
àà1 2

Background
àà2 <
(
àà< =
$str
àà= F
)
ààF G
.
ââ$ %
Padding
ââ% ,
(
ââ, -
$num
ââ- .
)
ââ. /
.
ââ/ 0
Text
ââ0 4
(
ââ4 5
$str
ââ5 A
)
ââA B
.
ââB C
	FontColor
ââC L
(
ââL M
$str
ââM S
)
ââS T
;
ââT U
header
ãã$ *
.
ãã* +
Cell
ãã+ /
(
ãã/ 0
)
ãã0 1
.
ãã1 2

Background
ãã2 <
(
ãã< =
$str
ãã= F
)
ããF G
.
åå# $
Padding
åå$ +
(
åå+ ,
$num
åå, -
)
åå- .
.
åå. /
Text
åå/ 3
(
åå3 4
$str
åå4 C
)
ååC D
.
ååD E
	FontColor
ååE N
(
ååN O
$str
ååO U
)
ååU V
;
ååV W
header
éé$ *
.
éé* +
Cell
éé+ /
(
éé/ 0
)
éé0 1
.
éé1 2

Background
éé2 <
(
éé< =
$str
éé= F
)
ééF G
.
èè# $
Padding
èè$ +
(
èè+ ,
$num
èè, -
)
èè- .
.
èè. /
Text
èè/ 3
(
èè3 4
$str
èè4 C
)
èèC D
.
èèD E
	FontColor
èèE N
(
èèN O
$str
èèO U
)
èèU V
;
èèV W
header
ëë$ *
.
ëë* +
Cell
ëë+ /
(
ëë/ 0
)
ëë0 1
.
ëë1 2

Background
ëë2 <
(
ëë< =
$str
ëë= F
)
ëëF G
.
íí# $
Padding
íí$ +
(
íí+ ,
$num
íí, -
)
íí- .
.
íí. /
Text
íí/ 3
(
íí3 4
$str
íí4 <
)
íí< =
.
íí= >
	FontColor
íí> G
(
ííG H
$str
ííH N
)
ííN O
;
ííO P
}
ìì  !
)
ìì! "
;
ìì" #
foreach
ïï  '
(
ïï( )
var
ïï) ,
item
ïï- 1
in
ïï2 4
objeto
ïï5 ;
.
ïï; <
PrestamoDetalle
ïï< K
)
ïïK L
{
ññ  !
tabla
ôô$ )
.
ôô) *
Cell
ôô* .
(
ôô. /
)
ôô/ 0
.
ôô0 1
Border
ôô1 7
(
ôô7 8
$num
ôô8 <
)
ôô< =
.
ôô= >
BorderColor
ôô> I
(
ôôI J
$str
ôôJ S
)
ôôS T
.
öö( )
Padding
öö) 0
(
öö0 1
$num
öö1 2
)
öö2 3
.
öö3 4
Text
öö4 8
(
öö8 9
item
öö9 =
.
öö= >
NroCuota
öö> F
.
ööF G
ToString
ööG O
(
ööO P
)
ööP Q
)
ööQ R
.
ööR S
FontSize
ööS [
(
öö[ \
$num
öö\ ^
)
öö^ _
;
öö_ `
tabla
úú$ )
.
úú) *
Cell
úú* .
(
úú. /
)
úú/ 0
.
úú0 1
Border
úú1 7
(
úú7 8
$num
úú8 <
)
úú< =
.
úú= >
BorderColor
úú> I
(
úúI J
$str
úúJ S
)
úúS T
.
ùù% &
Padding
ùù& -
(
ùù- .
$num
ùù. /
)
ùù/ 0
.
ùù0 1
Text
ùù1 5
(
ùù5 6
item
ùù6 :
.
ùù: ;
	FechaPago
ùù; D
)
ùùD E
.
ùùE F
FontSize
ùùF N
(
ùùN O
$num
ùùO Q
)
ùùQ R
;
ùùR S
tabla
üü$ )
.
üü) *
Cell
üü* .
(
üü. /
)
üü/ 0
.
üü0 1
Border
üü1 7
(
üü7 8
$num
üü8 <
)
üü< =
.
üü= >
BorderColor
üü> I
(
üüI J
$str
üüJ S
)
üüS T
.
††% &
Padding
††& -
(
††- .
$num
††. /
)
††/ 0
.
††0 1
Text
††1 5
(
††5 6
$"
††6 8
{
††8 9
objeto
††9 ?
.
††? @
Moneda
††@ F
.
††F G
Simbolo
††G N
}
††N O
$str
††O P
{
††P Q
item
††Q U
.
††U V

MontoCuota
††V `
}
††` a
"
††a b
)
††b c
.
††c d
FontSize
††d l
(
††l m
$num
††m o
)
††o p
;
††p q
tabla
¢¢$ )
.
¢¢) *
Cell
¢¢* .
(
¢¢. /
)
¢¢/ 0
.
¢¢0 1
Border
¢¢1 7
(
¢¢7 8
$num
¢¢8 <
)
¢¢< =
.
¢¢= >
BorderColor
¢¢> I
(
¢¢I J
$str
¢¢J S
)
¢¢S T
.
££% &
Padding
££& -
(
££- .
$num
££. /
)
££/ 0
.
££0 1

AlignRight
££1 ;
(
££; <
)
££< =
.
££= >
Text
££> B
(
££B C
$"
££C E
{
££E F
item
££F J
.
££J K
Estado
££K Q
}
££Q R
"
££R S
)
££S T
.
££T U
FontSize
££U ]
(
££] ^
$num
££^ `
)
££` a
;
££a b
}
§§  !
}
¶¶ 
)
¶¶ 
;
¶¶ 
}
ßß 
)
ßß 
;
ßß 
}
©© 
)
©© 
;
©© 
page
¨¨ 
.
¨¨ 
Footer
¨¨ 
(
¨¨  
)
¨¨  !
.
≠≠ 

AlignRight
≠≠ 
(
≠≠  
)
≠≠  !
.
ÆÆ 
Text
ÆÆ 
(
ÆÆ 
txt
ÆÆ 
=>
ÆÆ  
{
ØØ 
txt
∞∞ 
.
∞∞ 
Span
∞∞  
(
∞∞  !
$str
∞∞! *
)
∞∞* +
.
∞∞+ ,
FontSize
∞∞, 4
(
∞∞4 5
$num
∞∞5 7
)
∞∞7 8
;
∞∞8 9
txt
±± 
.
±± 
CurrentPageNumber
±± -
(
±±- .
)
±±. /
.
±±/ 0
FontSize
±±0 8
(
±±8 9
$num
±±9 ;
)
±±; <
;
±±< =
txt
≤≤ 
.
≤≤ 
Span
≤≤  
(
≤≤  !
$str
≤≤! '
)
≤≤' (
.
≤≤( )
FontSize
≤≤) 1
(
≤≤1 2
$num
≤≤2 4
)
≤≤4 5
;
≤≤5 6
txt
≥≥ 
.
≥≥ 

TotalPages
≥≥ &
(
≥≥& '
)
≥≥' (
.
≥≥( )
FontSize
≥≥) 1
(
≥≥1 2
$num
≥≥2 4
)
≥≥4 5
;
≥≥5 6
}
¥¥ 
)
¥¥ 
;
¥¥ 
}
µµ 
)
µµ 
;
µµ 
}
∂∂ 
)
∂∂ 
.
∂∂ 
GeneratePdf
∂∂ 
(
∂∂ 
)
∂∂ 
;
∂∂ 
Stream
ππ 
	pdfStream
ππ 
=
ππ 
new
ππ "
MemoryStream
ππ# /
(
ππ/ 0
pdf
ππ0 3
)
ππ3 4
;
ππ4 5
return
∫∫ 
File
∫∫ 
(
∫∫ 
	pdfStream
∫∫ !
,
∫∫! "
$str
∫∫# 4
)
∫∫4 5
;
∫∫5 6
}
ªª 	
}
ºº 
}ΩΩ ¯>
gC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Controllers\MonedaController.cs
	namespace		 	
Prestamo		
 
.		 
Web		 
.		 
Controllers		 "
{

 
[ 
	Authorize 
] 
public 

class 
MonedaController !
:" #

Controller$ .
{ 
private 
readonly 

MonedaData #
_monedaData$ /
;/ 0
private 
readonly 
AuditoriaService )
_auditoriaService* ;
;; <
public 
MonedaController 
(  

MonedaData  *

monedaData+ 5
,5 6
AuditoriaService7 G
auditoriaServiceH X
)X Y
{ 	
_monedaData 
= 

monedaData $
;$ %
_auditoriaService 
= 
auditoriaService  0
;0 1
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
	Authorize	 
( !
AuthenticationSchemes (
=) *
JwtBearerDefaults+ <
.< = 
AuthenticationScheme= Q
)Q R
]R S
[ 	
HttpGet	 
] 
[ 	
	Authorize	 
( 
Roles 
= 
$str *
)* +
]+ ,
public 
async 
Task 
< 
IActionResult '
>' (
Lista) .
(. /
)/ 0
{   	
List!! 
<!! 
Moneda!! 
>!! 
lista!! 
=!!  
await!!! &
_monedaData!!' 2
.!!2 3
Lista!!3 8
(!!8 9
)!!9 :
;!!: ;
await"" 
_auditoriaService"" #
.""# $
RegistrarLog""$ 0
(""0 1
User""1 5
.""5 6
Identity""6 >
.""> ?
Name""? C
,""C D
$str""E L
,""L M
$str""N x
)""x y
;""y z
return## 

StatusCode## 
(## 
StatusCodes## )
.##) *
Status200OK##* 5
,##5 6
new##7 :
{##; <
data##= A
=##B C
lista##D I
}##J K
)##K L
;##L M
}$$ 	
[&& 	
	Authorize&&	 
(&& !
AuthenticationSchemes&& (
=&&) *
JwtBearerDefaults&&+ <
.&&< = 
AuthenticationScheme&&= Q
)&&Q R
]&&R S
['' 	
HttpPost''	 
]'' 
[(( 	
	Authorize((	 
((( 
Roles(( 
=(( 
$str(( *
)((* +
]((+ ,
public)) 
async)) 
Task)) 
<)) 
IActionResult)) '
>))' (
Crear))) .
()). /
[))/ 0
FromBody))0 8
]))8 9
Moneda)): @
objeto))A G
)))G H
{** 	
if++ 
(++ 
!++ 

ModelState++ 
.++ 
IsValid++ #
)++# $
{,, 
return-- 

BadRequest-- !
(--! "

ModelState--" ,
)--, -
;--- .
}.. 
string// 
	respuesta// 
=// 
await// $
_monedaData//% 0
.//0 1
Crear//1 6
(//6 7
objeto//7 =
)//= >
;//> ?
await00 
_auditoriaService00 #
.00# $
RegistrarLog00$ 0
(000 1
User001 5
.005 6
Identity006 >
.00> ?
Name00? C
,00C D
$str00E L
,00L M
$"00N P
$str00P _
{00_ `
objeto00` f
.00f g
Nombre00g m
}00m n
"00n o
)00o p
;00p q
return11 

StatusCode11 
(11 
StatusCodes11 )
.11) *
Status200OK11* 5
,115 6
new117 :
{11; <
data11= A
=11B C
	respuesta11D M
}11N O
)11O P
;11P Q
}22 	
[44 	
	Authorize44	 
(44 !
AuthenticationSchemes44 (
=44) *
JwtBearerDefaults44+ <
.44< = 
AuthenticationScheme44= Q
)44Q R
]44R S
[55 	
HttpPut55	 
]55 
[66 	
	Authorize66	 
(66 
Roles66 
=66 
$str66 *
)66* +
]66+ ,
public77 
async77 
Task77 
<77 
IActionResult77 '
>77' (
Editar77) /
(77/ 0
[770 1
FromBody771 9
]779 :
Moneda77; A
objeto77B H
)77H I
{88 	
if99 
(99 
!99 

ModelState99 
.99 
IsValid99 #
)99# $
{:: 
return;; 

BadRequest;; !
(;;! "

ModelState;;" ,
);;, -
;;;- .
}<< 
string== 
	respuesta== 
=== 
await== $
_monedaData==% 0
.==0 1
Editar==1 7
(==7 8
objeto==8 >
)==> ?
;==? @
await>> 
_auditoriaService>> #
.>># $
RegistrarLog>>$ 0
(>>0 1
User>>1 5
.>>5 6
Identity>>6 >
.>>> ?
Name>>? C
!>>C D
,>>D E
$str>>F N
,>>N O
$">>P R
$str>>R b
{>>b c
objeto>>c i
.>>i j
Nombre>>j p
}>>p q
">>q r
)>>r s
;>>s t
return?? 

StatusCode?? 
(?? 
StatusCodes?? )
.??) *
Status200OK??* 5
,??5 6
new??7 :
{??; <
data??= A
=??B C
	respuesta??D M
}??N O
)??O P
;??P Q
}@@ 	
[BB 	
	AuthorizeBB	 
(BB !
AuthenticationSchemesBB (
=BB) *
JwtBearerDefaultsBB+ <
.BB< = 
AuthenticationSchemeBB= Q
)BBQ R
]BBR S
[CC 	

HttpDeleteCC	 
]CC 
[DD 	
	AuthorizeDD	 
(DD 
RolesDD 
=DD 
$strDD *
)DD* +
]DD+ ,
publicEE 
asyncEE 
TaskEE 
<EE 
IActionResultEE '
>EE' (
EliminarEE) 1
(EE1 2
intEE2 5
IdEE6 8
)EE8 9
{FF 	
ifGG 
(GG 
!GG 

ModelStateGG 
.GG 
IsValidGG #
)GG# $
{HH 
returnII 

BadRequestII !
(II! "

ModelStateII" ,
)II, -
;II- .
}JJ 
stringKK 
	respuestaKK 
=KK 
awaitKK $
_monedaDataKK% 0
.KK0 1
EliminarKK1 9
(KK9 :
IdKK: <
)KK< =
;KK= >
awaitLL 
_auditoriaServiceLL #
.LL# $
RegistrarLogLL$ 0
(LL0 1
UserLL1 5
.LL5 6
IdentityLL6 >
.LL> ?
NameLL? C
,LLC D
$strLLE O
,LLO P
$"LLQ S
$strLLS l
{LLl m
IdLLm o
}LLo p
"LLp q
)LLq r
;LLr s
returnMM 

StatusCodeMM 
(MM 
StatusCodesMM )
.MM) *
Status200OKMM* 5
,MM5 6
newMM7 :
{MM; <
dataMM= A
=MMB C
	respuestaMMD M
}MMN O
)MMO P
;MMP Q
}NN 	
}OO 
}PP Â™
fC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Controllers\LoginController.cs
	namespace 	
Prestamo
 
. 
Web 
. 
Controllers "
{ 
public 

class 
LoginController  
:! "

Controller# -
{ 
private 
readonly 
UsuarioData $
_usuarioData% 1
;1 2
private 
readonly 
EmailService %
_emailService& 3
;3 4
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
private 
readonly 
AuditoriaService )
_auditoriaService* ;
;; <
public 
LoginController 
( 
UsuarioData *
usuarioData+ 6
,6 7
EmailService8 D
emailServiceE Q
,Q R
IConfigurationS a
configurationb o
,o p
AuditoriaService	q Å
auditoriaService
Ç í
)
í ì
{ 	
_usuarioData 
= 
usuarioData &
;& '
_emailService 
= 
emailService (
;( )
_configuration   
=   
configuration   *
;  * +
_auditoriaService!! 
=!! 
auditoriaService!!  0
;!!0 1
}"" 	
public## 
IActionResult## 
Index## "
(##" #
)### $
{$$ 	
return%% 
View%% 
(%% 
)%% 
;%% 
}&& 	
[(( 	
HttpPost((	 
](( 
public)) 
async)) 
Task)) 
<)) 
IActionResult)) '
>))' (
Index))) .
()). /
string))/ 5
correo))6 <
,))< =
string))> D
clave))E J
)))J K
{** 	
if++ 
(++ 
string++ 
.++ 
IsNullOrEmpty++ $
(++$ %
correo++% +
)+++ ,
||++- /
string++0 6
.++6 7
IsNullOrEmpty++7 D
(++D E
clave++E J
)++J K
)++K L
{,, 
ViewData-- 
[-- 
$str-- "
]--" #
=--$ %
$str--& I
;--I J
return.. 
View.. 
(.. 
).. 
;.. 
}// 
var22 
usuario22 
=22 
await22 
_usuarioData22  ,
.22, -
ObtenerPorCorreo22- =
(22= >
correo22> D
)22D E
;22E F
if33 
(33 
usuario33 
==33 
null33 
)33  
{44 
ViewData55 
[55 
$str55 "
]55" #
=55$ %
$str55& @
;55@ A
return66 
View66 
(66 
)66 
;66 
}77 
if:: 
(:: 
usuario:: 
.:: 
IsLocked::  
)::  !
{;; 
if<< 
(<< 
usuario<< 
.<< 

LockoutEnd<< &
><<' (
DateTime<<) 1
.<<1 2
UtcNow<<2 8
)<<8 9
{== 
ViewData>> 
[>> 
$str>> &
]>>& '
=>>( )
$str>>* k
;>>k l
return?? 
View?? 
(??  
)??  !
;??! "
}@@ 
elseAA 
{BB 
awaitDD 
_usuarioDataDD &
.DD& '
ResetLockoutDD' 3
(DD3 4
usuarioDD4 ;
.DD; <
	IdUsuarioDD< E
)DDE F
;DDF G
}EE 
}FF 
ifII 
(II 
usuarioII 
.II 

LockoutEndII "
!=II# %
nullII& *
&&II+ -
usuarioII. 5
.II5 6

LockoutEndII6 @
>IIA B
DateTimeIIC K
.IIK L
UtcNowIIL R
)IIR S
{JJ 
varKK 
tiempoRestanteKK "
=KK# $
(KK% &
usuarioKK& -
.KK- .

LockoutEndKK. 8
.KK8 9
ValueKK9 >
-KK? @
DateTimeKKA I
.KKI J
UtcNowKKJ P
)KKP Q
.KKQ R
TotalSecondsKKR ^
;KK^ _
ConsoleLL 
.LL 
	WriteLineLL !
(LL! "
$"LL" $
$strLL$ 5
{LL5 6
tiempoRestanteLL6 D
}LLD E
"LLE F
)LLF G
;LLG H
ifNN 
(NN 
tiempoRestanteNN "
>NN# $
$numNN% &
)NN& '
{OO 
ViewDataPP 
[PP 
$strPP &
]PP& '
=PP( )
$"PP* ,
$strPP, =
{PP= >
(PP> ?
intPP? B
)PPB C
tiempoRestantePPC Q
}PPQ R
$strPPR y
"PPy z
;PPz {
ViewDataQQ 
[QQ 
$strQQ .
]QQ. /
=QQ0 1
(QQ2 3
intQQ3 6
)QQ6 7
MathQQ7 ;
.QQ; <
CeilingQQ< C
(QQC D
tiempoRestanteQQD R
)QQR S
;QQS T
ConsoleRR 
.RR 
	WriteLineRR %
(RR% &
$"RR& (
$strRR( :
{RR: ;
tiempoRestanteRR; I
}RRI J
"RRJ K
)RRK L
;RRL M
ConsoleSS 
.SS 
	WriteLineSS %
(SS% &
ViewDataSS& .
[SS. /
$strSS/ @
]SS@ A
)SSA B
;SSB C
returnTT 
ViewTT 
(TT  
)TT  !
;TT! "
}UU 
elseVV 
{WW 
ViewDataXX 
[XX 
$strXX .
]XX. /
=XX0 1
nullXX2 6
;XX6 7
}YY 
}ZZ 
if]] 
(]] 
string]] 
.]] 
IsNullOrEmpty]] $
(]]$ %
usuario]]% ,
.]], -
Clave]]- 2
)]]2 3
)]]3 4
{^^ 
ViewData__ 
[__ 
$str__ "
]__" #
=__$ %
$str__& T
;__T U
return`` 
View`` 
(`` 
)`` 
;`` 
}aa 
boolcc 
isPasswordValidcc  
=cc! "
BCryptcc# )
.cc) *
Netcc* -
.cc- .
BCryptcc. 4
.cc4 5
Verifycc5 ;
(cc; <
clavecc< A
,ccA B
usuarioccC J
.ccJ K
ClaveccK P
)ccP Q
;ccQ R
ifee 
(ee 
!ee 
isPasswordValidee  
)ee  !
{ff 
usuariogg 
.gg 
FailedAttemptsgg &
++gg& (
;gg( )
usuariohh 
.hh 
LastFailedAttempthh )
=hh* +
DateTimehh, 4
.hh4 5
UtcNowhh5 ;
;hh; <
intjj 
tiempoBloqueadojj #
=jj$ %
$numjj& '
;jj' (
ifkk 
(kk 
usuariokk 
.kk 
FailedAttemptskk *
==kk+ -
$numkk. /
)kk/ 0
{ll 
tiempoBloqueadomm #
=mm$ %
$nummm& (
;mm( )
usuarionn 
.nn 

LockoutEndnn &
=nn' (
DateTimenn) 1
.nn1 2
UtcNownn2 8
.nn8 9

AddSecondsnn9 C
(nnC D
tiempoBloqueadonnD S
)nnS T
;nnT U
}oo 
elsepp 
ifpp 
(pp 
usuariopp  
.pp  !
FailedAttemptspp! /
==pp0 2
$numpp3 4
)pp4 5
{qq 
tiempoBloqueadorr #
=rr$ %
$numrr& (
;rr( )
usuarioss 
.ss 

LockoutEndss &
=ss' (
DateTimess) 1
.ss1 2
UtcNowss2 8
.ss8 9

AddSecondsss9 C
(ssC D
tiempoBloqueadossD S
)ssS T
;ssT U
}tt 
elseuu 
ifuu 
(uu 
usuariouu  
.uu  !
FailedAttemptsuu! /
>=uu0 2
$numuu3 4
)uu4 5
{vv 
usuarioww 
.ww 
IsLockedww $
=ww% &
trueww' +
;ww+ ,
usuarioxx 
.xx 

LockoutEndxx &
=xx' (
DateTimexx) 1
.xx1 2
MaxValuexx2 :
;xx: ;
awaityy 
_usuarioDatayy &
.yy& '
UpdateLockoutStatusyy' :
(yy: ;
usuarioyy; B
)yyB C
;yyC D
ViewDatazz 
[zz 
$strzz &
]zz& '
=zz( )
$strzz* s
;zzs t
return{{ 
View{{ 
({{  
){{  !
;{{! "
}|| 
await~~ 
_usuarioData~~ "
.~~" #
UpdateLockoutStatus~~# 6
(~~6 7
usuario~~7 >
)~~> ?
;~~? @
if
ÄÄ 
(
ÄÄ 
tiempoBloqueado
ÄÄ #
>
ÄÄ$ %
$num
ÄÄ& '
)
ÄÄ' (
{
ÅÅ 
ViewData
ÇÇ 
[
ÇÇ 
$str
ÇÇ &
]
ÇÇ& '
=
ÇÇ( )
$str
ÇÇ* q
;
ÇÇq r
ViewData
ÉÉ 
[
ÉÉ 
$str
ÉÉ .
]
ÉÉ. /
=
ÉÉ0 1
tiempoBloqueado
ÉÉ2 A
;
ÉÉA B
return
ÑÑ 
View
ÑÑ 
(
ÑÑ  
)
ÑÑ  !
;
ÑÑ! "
}
ÖÖ 
ViewData
áá 
[
áá 
$str
áá "
]
áá" #
=
áá$ %
$"
áá& (
$str
áá( V
{
ááV W
$num
ááW X
-
ááY Z
usuario
áá[ b
.
ááb c
FailedAttempts
áác q
}
ááq r
"
áár s
;
áás t
return
àà 
View
àà 
(
àà 
)
àà 
;
àà 
}
ââ 
await
åå 
_usuarioData
åå 
.
åå 
ResetLockout
åå +
(
åå+ ,
usuario
åå, 3
.
åå3 4
	IdUsuario
åå4 =
)
åå= >
;
åå> ?
var
èè  
codigoVerificacion
èè "
=
èè# $'
GenerarCodigoVerificacion
èè% >
(
èè> ?
)
èè? @
;
èè@ A
HttpContext
êê 
.
êê 
Session
êê 
.
êê  
	SetString
êê  )
(
êê) *
$str
êê* >
,
êê> ? 
codigoVerificacion
êê@ R
)
êêR S
;
êêS T
HttpContext
ëë 
.
ëë 
Session
ëë 
.
ëë  
	SetString
ëë  )
(
ëë) *
$str
ëë* >
,
ëë> ?
correo
ëë@ F
)
ëëF G
;
ëëG H
string
îî 
asunto
îî 
=
îî 
$str
îî 4
;
îî4 5
string
ïï 
mensaje
ïï 
=
ïï 
$"
ïï 
$str
ïï =
{
ïï= > 
codigoVerificacion
ïï> P
}
ïïP Q
"
ïïQ R
;
ïïR S
await
ññ 
_emailService
ññ 
.
ññ  
EnviarCorreoAsync
ññ  1
(
ññ1 2
correo
ññ2 8
,
ññ8 9
asunto
ññ: @
,
ññ@ A
mensaje
ññB I
)
ññI J
;
ññJ K
var
ôô 
claims
ôô 
=
ôô 
new
ôô 
[
ôô 
]
ôô 
{
öö 
new
õõ 
Claim
õõ 
(
õõ 

ClaimTypes
õõ $
.
õõ$ %
Name
õõ% )
,
õõ) *
usuario
õõ+ 2
.
õõ2 3
NombreCompleto
õõ3 A
)
õõA B
,
õõB C
new
úú 
Claim
úú 
(
úú 

ClaimTypes
úú $
.
úú$ %
NameIdentifier
úú% 3
,
úú3 4
usuario
úú5 <
.
úú< =
	IdUsuario
úú= F
.
úúF G
ToString
úúG O
(
úúO P
)
úúP Q
)
úúQ R
,
úúR S
new
ùù 
Claim
ùù 
(
ùù 

ClaimTypes
ùù $
.
ùù$ %
Email
ùù% *
,
ùù* +
usuario
ùù, 3
.
ùù3 4
Correo
ùù4 :
)
ùù: ;
,
ùù; <
new
ûû 
Claim
ûû 
(
ûû 

ClaimTypes
ûû $
.
ûû$ %
Role
ûû% )
,
ûû) *
usuario
ûû+ 2
.
ûû2 3
Rol
ûû3 6
)
ûû6 7
}
üü 
;
üü 
var
°° 
key
°° 
=
°° 
new
°° "
SymmetricSecurityKey
°° .
(
°°. /
Encoding
°°/ 7
.
°°7 8
UTF8
°°8 <
.
°°< =
GetBytes
°°= E
(
°°E F
_configuration
°°F T
[
°°T U
$str
°°U ^
]
°°^ _
!
°°_ `
)
°°` a
)
°°a b
;
°°b c
var
¢¢ 
credentials
¢¢ 
=
¢¢ 
new
¢¢ ! 
SigningCredentials
¢¢" 4
(
¢¢4 5
key
¢¢5 8
,
¢¢8 9 
SecurityAlgorithms
¢¢: L
.
¢¢L M

HmacSha256
¢¢M W
)
¢¢W X
;
¢¢X Y
var
££ 
expires
££ 
=
££ 
DateTime
££ "
.
££" #
Now
££# &
.
££& '

AddMinutes
££' 1
(
££1 2
Convert
££2 9
.
££9 :
ToDouble
££: B
(
££B C
_configuration
££C Q
[
££Q R
$str
££R _
]
££_ `
)
££` a
)
££a b
;
££b c
var
•• 
token
•• 
=
•• 
new
•• 
JwtSecurityToken
•• ,
(
••, -
_configuration
¶¶ 
[
¶¶ 
$str
¶¶ +
]
¶¶+ ,
,
¶¶, -
_configuration
ßß 
[
ßß 
$str
ßß -
]
ßß- .
,
ßß. /
claims
®® 
,
®® 
expires
©© 
:
©© 
expires
©©  
,
©©  ! 
signingCredentials
™™ "
:
™™" #
credentials
™™$ /
)
´´ 
;
´´ 
HttpContext
≠≠ 
.
≠≠ 
Session
≠≠ 
.
≠≠  
	SetString
≠≠  )
(
≠≠) *
$str
≠≠* 1
,
≠≠1 2
new
≠≠3 6%
JwtSecurityTokenHandler
≠≠7 N
(
≠≠N O
)
≠≠O P
.
≠≠P Q

WriteToken
≠≠Q [
(
≠≠[ \
token
≠≠\ a
)
≠≠a b
)
≠≠b c
;
≠≠c d
TempData
ÆÆ 
[
ÆÆ 
$str
ÆÆ 
]
ÆÆ 
=
ÆÆ 
new
ÆÆ  #%
JwtSecurityTokenHandler
ÆÆ$ ;
(
ÆÆ; <
)
ÆÆ< =
.
ÆÆ= >

WriteToken
ÆÆ> H
(
ÆÆH I
token
ÆÆI N
)
ÆÆN O
;
ÆÆO P
return
ØØ 
RedirectToAction
ØØ #
(
ØØ# $
$str
ØØ$ 5
)
ØØ5 6
;
ØØ6 7
}
∞∞ 	
public
≤≤ 
IActionResult
≤≤ 
VerificarCodigo
≤≤ ,
(
≤≤, -
)
≤≤- .
{
≥≥ 	
ViewData
¥¥ 
[
¥¥ 
$str
¥¥ 
]
¥¥ 
=
¥¥ 
TempData
¥¥  (
[
¥¥( )
$str
¥¥) 0
]
¥¥0 1
;
¥¥1 2
return
µµ 
View
µµ 
(
µµ 
)
µµ 
;
µµ 
}
∂∂ 	
[
∏∏ 	
HttpPost
∏∏	 
]
∏∏ 
public
ππ 
async
ππ 
Task
ππ 
<
ππ 
IActionResult
ππ '
>
ππ' ("
VerificarCodigoAsync
ππ) =
(
ππ= >
string
ππ> D
codigo
ππE K
)
ππK L
{
∫∫ 	
var
ªª  
codigoVerificacion
ªª "
=
ªª# $
HttpContext
ªª% 0
.
ªª0 1
Session
ªª1 8
.
ªª8 9
	GetString
ªª9 B
(
ªªB C
$str
ªªC W
)
ªªW X
;
ªªX Y
var
ºº 
correo
ºº 
=
ºº 
HttpContext
ºº $
.
ºº$ %
Session
ºº% ,
.
ºº, -
	GetString
ºº- 6
(
ºº6 7
$str
ºº7 K
)
ººK L
;
ººL M
var
ΩΩ 
token
ΩΩ 
=
ΩΩ 
HttpContext
ΩΩ #
.
ΩΩ# $
Session
ΩΩ$ +
.
ΩΩ+ ,
	GetString
ΩΩ, 5
(
ΩΩ5 6
$str
ΩΩ6 =
)
ΩΩ= >
;
ΩΩ> ?
if
øø 
(
øø 
codigo
øø 
==
øø  
codigoVerificacion
øø ,
)
øø, -
{
¿¿ 
var
¡¡ 
usuario
¡¡ 
=
¡¡ 
_usuarioData
¡¡ *
.
¡¡* +
ObtenerPorCorreo
¡¡+ ;
(
¡¡; <
correo
¡¡< B
!
¡¡B C
)
¡¡C D
.
¡¡D E
Result
¡¡E K
;
¡¡K L
var
√√ 
claims
√√ 
=
√√ 
new
√√  
List
√√! %
<
√√% &
Claim
√√& +
>
√√+ ,
{
ƒƒ 
new
≈≈ 
Claim
≈≈ 
(
≈≈ 

ClaimTypes
≈≈ (
.
≈≈( )
Name
≈≈) -
,
≈≈- .
usuario
≈≈/ 6
.
≈≈6 7
NombreCompleto
≈≈7 E
)
≈≈E F
,
≈≈F G
new
∆∆ 
Claim
∆∆ 
(
∆∆ 

ClaimTypes
∆∆ (
.
∆∆( )
Email
∆∆) .
,
∆∆. /
usuario
∆∆0 7
.
∆∆7 8
Correo
∆∆8 >
)
∆∆> ?
,
∆∆? @
new
«« 
Claim
«« 
(
«« 

ClaimTypes
«« (
.
««( )
Role
««) -
,
««- .
usuario
««/ 6
.
««6 7
Rol
««7 :
)
««: ;
}
»» 
;
»» 
var
   
identity
   
=
   
new
   "
ClaimsIdentity
  # 1
(
  1 2
claims
  2 8
,
  8 9*
CookieAuthenticationDefaults
  : V
.
  V W"
AuthenticationScheme
  W k
)
  k l
;
  l m
var
ÀÀ 
	principal
ÀÀ 
=
ÀÀ 
new
ÀÀ  #
ClaimsPrincipal
ÀÀ$ 3
(
ÀÀ3 4
identity
ÀÀ4 <
)
ÀÀ< =
;
ÀÀ= >
await
ŒŒ 
HttpContext
ŒŒ !
.
ŒŒ! "
SignInAsync
ŒŒ" -
(
ŒŒ- .*
CookieAuthenticationDefaults
œœ 0
.
œœ0 1"
AuthenticationScheme
œœ1 E
,
œœE F
	principal
–– 
,
–– 
new
—— &
AuthenticationProperties
—— 0
{
——1 2
IsPersistent
——3 ?
=
——@ A
false
——B G
}
——H I
)
““ 
;
““ 
Response
’’ 
.
’’ 
Cookies
’’  
.
’’  !
Append
’’! '
(
’’' (
$str
’’( 6
,
’’6 7
token
’’8 =
!
’’= >
,
’’> ?
new
’’@ C
CookieOptions
’’D Q
{
÷÷ 
HttpOnly
◊◊ 
=
◊◊ 
true
◊◊ #
,
◊◊# $
Secure
ÿÿ 
=
ÿÿ 
true
ÿÿ !
}
ŸŸ 
)
ŸŸ 
;
ŸŸ 
TempData
⁄⁄ 
[
⁄⁄ 
$str
⁄⁄  
]
⁄⁄  !
=
⁄⁄" #
token
⁄⁄$ )
;
⁄⁄) *
await
€€ 
_auditoriaService
€€ '
.
€€' (
RegistrarLog
€€( 4
(
€€4 5
usuario
€€5 <
.
€€< =
Correo
€€= C
,
€€C D
$str
€€E W
,
€€W X
$str
€€Y s
)
€€s t
;
€€t u
return
‹‹ 
RedirectToAction
‹‹ '
(
‹‹' (
$str
‹‹( /
,
‹‹/ 0
$str
‹‹1 7
)
‹‹7 8
;
‹‹8 9
}
›› 
else
ﬁﬁ 
{
ﬂﬂ 
ViewData
‡‡ 
[
‡‡ 
$str
‡‡ "
]
‡‡" #
=
‡‡$ %
$str
‡‡& I
;
‡‡I J
return
·· 
View
·· 
(
·· 
)
·· 
;
·· 
}
‚‚ 
}
„„ 	
public
ÂÂ 
async
ÂÂ 
Task
ÂÂ 
<
ÂÂ 
IActionResult
ÂÂ '
>
ÂÂ' (
Salir
ÂÂ) .
(
ÂÂ. /
)
ÂÂ/ 0
{
ÊÊ 	
await
ÁÁ 
HttpContext
ÁÁ 
.
ÁÁ 
SignOutAsync
ÁÁ *
(
ÁÁ* +
JwtBearerDefaults
ÁÁ+ <
.
ÁÁ< ="
AuthenticationScheme
ÁÁ= Q
)
ÁÁQ R
;
ÁÁR S
return
ËË 
RedirectToAction
ËË #
(
ËË# $
$str
ËË$ +
,
ËË+ ,
$str
ËË- 4
)
ËË4 5
;
ËË5 6
}
ÈÈ 	
private
ÎÎ 
string
ÎÎ '
GenerarCodigoVerificacion
ÎÎ 0
(
ÎÎ0 1
)
ÎÎ1 2
{
ÏÏ 	
using
ÌÌ 
(
ÌÌ 
var
ÌÌ 
rng
ÌÌ 
=
ÌÌ #
RandomNumberGenerator
ÌÌ 2
.
ÌÌ2 3
Create
ÌÌ3 9
(
ÌÌ9 :
)
ÌÌ: ;
)
ÌÌ; <
{
ÓÓ 
var
ÔÔ 
bytes
ÔÔ 
=
ÔÔ 
new
ÔÔ 
byte
ÔÔ  $
[
ÔÔ$ %
$num
ÔÔ% &
]
ÔÔ& '
;
ÔÔ' (
rng
 
.
 
GetBytes
 
(
 
bytes
 "
)
" #
;
# $
return
ÒÒ 
BitConverter
ÒÒ #
.
ÒÒ# $
ToUInt32
ÒÒ$ ,
(
ÒÒ, -
bytes
ÒÒ- 2
,
ÒÒ2 3
$num
ÒÒ4 5
)
ÒÒ5 6
.
ÒÒ6 7
ToString
ÒÒ7 ?
(
ÒÒ? @
$str
ÒÒ@ D
)
ÒÒD E
;
ÒÒE F
}
ÚÚ 
}
ÛÛ 	
}
ÙÙ 
}ıı ≥U
eC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Controllers\HomeController.cs
	namespace 	
Prestamo
 
. 
Web 
. 
Controllers "
{ 
[ 
	Authorize 
] 
public 

class 
HomeController 
:  !

Controller" ,
{ 
private 
readonly 
ILogger  
<  !
HomeController! /
>/ 0
_logger1 8
;8 9
private 
readonly 
ResumenData $
_resumenData% 1
;1 2
private 
readonly 
ClienteData $
_clienteData% 1
;1 2
private 
readonly 
ResumenClienteData +
_resumenClienteData, ?
;? @
private 
readonly 
PrestamoData %
_prestamoData& 3
;3 4
private 
readonly 
AuditoriaService )
_auditoriaService* ;
;; <
public 
HomeController 
( 
ILogger %
<% &
HomeController& 4
>4 5
logger6 <
,< =
ResumenData= H
resumenDataI T
,T U
ClienteDataV a
clienteDatab m
,m n
ResumenClienteData	o Å 
resumenClienteData
Ç î
,
î ï
PrestamoData
ñ ¢
prestamoData
£ Ø
,
Ø ∞
AuditoriaService
± ¡
auditoriaService
¬ “
)
“ ”
{ 	
_logger 
= 
logger 
; 
_resumenData 
= 
resumenData &
;& '
_clienteData 
= 
clienteData &
;& '
_resumenClienteData 
=  !
resumenClienteData" 4
;4 5
_prestamoData 
= 
prestamoData (
;( )
_auditoriaService   
=   
auditoriaService    0
;  0 1
}!! 	
public"" 
IActionResult"" 
Index"" "
(""" #
)""# $
{## 	
return$$ 
View$$ 
($$ 
)$$ 
;$$ 
}%% 	
public&& 
IActionResult&& 
Privacy&& $
(&&$ %
)&&% &
{'' 	
return(( 
View(( 
((( 
)(( 
;(( 
})) 	
[++ 	
ResponseCache++	 
(++ 
Duration++ 
=++  !
$num++" #
,++# $
Location++% -
=++. /!
ResponseCacheLocation++0 E
.++E F
None++F J
,++J K
NoStore++L S
=++T U
true++V Z
)++Z [
]++[ \
public,, 
IActionResult,, 
Error,, "
(,," #
),,# $
{-- 	
return.. 
View.. 
(.. 
new.. 
ErrorViewModel.. *
{..+ ,
	RequestId..- 6
=..7 8
Activity..9 A
...A B
Current..B I
?..I J
...J K
Id..K M
??..N P
HttpContext..Q \
...\ ]
TraceIdentifier..] l
}..m n
)..n o
;..o p
}// 	
[11 	
	Authorize11	 
(11 !
AuthenticationSchemes11 (
=11) *
JwtBearerDefaults11+ <
.11< = 
AuthenticationScheme11= Q
)11Q R
]11R S
[22 	
HttpGet22	 
]22 
[33 	
	Authorize33	 
(33 
Roles33 
=33 
$str33 *
)33* +
]33+ ,
public44 
async44 
Task44 
<44 
IActionResult44 '
>44' (
ObtenerResumen44) 7
(447 8
)448 9
{55 	
var77 
usuario77 
=77 
User77 
.77 
Identity77 '
!77' (
.77( )
Name77) -
;77- .
await88 
_auditoriaService88 #
.88# $
RegistrarLog88$ 0
(880 1
usuario881 8
!888 9
,889 :
$str88; K
,88K L
$str88M }
)88} ~
;88~ 
Resumen:: 
objeto:: 
=:: 
await:: "
_resumenData::# /
.::/ 0
Obtener::0 7
(::7 8
)::8 9
;::9 :
return;; 

StatusCode;; 
(;; 
StatusCodes;; )
.;;) *
Status200OK;;* 5
,;;5 6
new;;7 :
{;;; <
data;;= A
=;;B C
objeto;;D J
};;K L
);;L M
;;;M N
}<< 	
[>> 	
	Authorize>>	 
(>> !
AuthenticationSchemes>> (
=>>) *
JwtBearerDefaults>>+ <
.>>< = 
AuthenticationScheme>>= Q
)>>Q R
]>>R S
[?? 	
HttpGet??	 
]?? 
public@@ 
IActionResult@@ 
ObtenerRolUsuario@@ .
(@@. /
)@@/ 0
{AA 	
varBB 
rolesBB 
=BB 
UserBB 
.BB 
ClaimsBB #
.BB# $
WhereBB$ )
(BB) *
cBB* +
=>BB, .
cBB/ 0
.BB0 1
TypeBB1 5
==BB6 8

ClaimTypesBB9 C
.BBC D
RoleBBD H
)BBH I
.BBI J
SelectBBJ P
(BBP Q
cBBQ R
=>BBS U
cBBV W
.BBW X
ValueBBX ]
)BB] ^
.BB^ _
ToListBB_ e
(BBe f
)BBf g
;BBg h
returnCC 
OkCC 
(CC 
newCC 
{CC 
rolesCC !
}CC" #
)CC# $
;CC$ %
}DD 	
[FF 	
	AuthorizeFF	 
(FF !
AuthenticationSchemesFF (
=FF) *
JwtBearerDefaultsFF+ <
.FF< = 
AuthenticationSchemeFF= Q
)FFQ R
]FFR S
[GG 	
HttpGetGG	 
]GG 
[HH 	
	AuthorizeHH	 
(HH 
RolesHH 
=HH 
$strHH $
)HH$ %
]HH% &
publicII 
asyncII 
TaskII 
<II 
IActionResultII '
>II' (!
ObtenerResumenClienteII) >
(II> ?
intII? B

idPrestamoIIC M
)IIM N
{JJ 	
ifKK 
(KK 
!KK 

ModelStateKK 
.KK 
IsValidKK #
)KK# $
{LL 
returnMM 

BadRequestMM !
(MM! "

ModelStateMM" ,
)MM, -
;MM- .
}NN 
varOO 
usuarioOO 
=OO 
UserOO 
.OO 
IdentityOO '
!OO' (
.OO( )
NameOO) -
;OO- .
awaitPP 
_auditoriaServicePP #
.PP# $
RegistrarLogPP$ 0
(PP0 1
usuarioPP1 8
!PP8 9
,PP9 :
$strPP; R
,PPR S
$str	PPT Å
)
PPÅ Ç
;
PPÇ É
varRR 
correoRR 
=RR 
UserRR 
.RR 
	FindFirstRR '
(RR' (

ClaimTypesRR( 2
.RR2 3
EmailRR3 8
)RR8 9
?RR9 :
.RR: ;
ValueRR; @
;RR@ A
ConsoleSS 
.SS 
	WriteLineSS 
(SS 
correoSS $
)SS$ %
;SS% &
ifTT 
(TT 
stringTT 
.TT 
IsNullOrEmptyTT $
(TT$ %
correoTT% +
)TT+ ,
)TT, -
{UU 
returnVV 
RedirectToActionVV '
(VV' (
$strVV( /
,VV/ 0
$strVV1 7
)VV7 8
;VV8 9
}WW 
varYY 
clienteYY 
=YY 
awaitYY 
_clienteDataYY  ,
.YY, -
ObtenerPorCorreoYY- =
(YY= >
correoYY> D
)YYD E
;YYE F
varZZ 
prestamoZZ 
=ZZ 
awaitZZ  
_prestamoDataZZ! .
.ZZ. /'
ObtenerIdPrestamoPorClienteZZ/ J
(ZZJ K
clienteZZK R
.ZZR S
	IdClienteZZS \
)ZZ\ ]
;ZZ] ^
Console[[ 
.[[ 
	WriteLine[[ 
([[ 
prestamo[[ &
)[[& '
;[[' (
if\\ 
(\\ 
cliente\\ 
!=\\ 
null\\ 
)\\  
{]] 
var^^ 
resumen^^ 
=^^ 
await^^ #
_resumenClienteData^^$ 7
.^^7 8
ObtenerResumen^^8 F
(^^F G
cliente^^G N
.^^N O
	IdCliente^^O X
,^^X Y
prestamo^^Z b
)^^b c
;^^c d
Console__ 
.__ 
	WriteLine__ !
(__! "
resumen__" )
.__) *"
PagosClientePendientes__* @
)__@ A
;__A B
Console`` 
.`` 
	WriteLine`` !
(``! "
resumen``" )
.``) *
PrestamosCliente``* :
)``: ;
;``; <
returnaa 
Okaa 
(aa 
resumenaa !
)aa! "
;aa" #
}bb 
returncc 
NotFoundcc 
(cc 
)cc 
;cc 
}dd 	
publicff 
asyncff 
Taskff 
<ff 
IActionResultff '
>ff' (
Salirff) .
(ff. /
)ff/ 0
{gg 	
varhh 
usuariohh 
=hh 
Userhh 
.hh 
Identityhh '
!hh' (
.hh( )
Namehh) -
;hh- .
awaitii 
_auditoriaServiceii #
.ii# $
RegistrarLogii$ 0
(ii0 1
usuarioii1 8
!ii8 9
,ii9 :
$strii; B
,iiB C
$striiD ^
)ii^ _
;ii_ `
awaitkk 
HttpContextkk 
.kk 
SignOutAsynckk *
(kk* +(
CookieAuthenticationDefaultskk+ G
.kkG H 
AuthenticationSchemekkH \
)kk\ ]
;kk] ^
Responsenn 
.nn 
Cookiesnn 
.nn 
Deletenn #
(nn# $
$strnn$ 2
)nn2 3
;nn3 4
Responseoo 
.oo 
Cookiesoo 
.oo 
Deleteoo #
(oo# $
$stroo$ 2
)oo2 3
;oo3 4
returnqq 
RedirectToActionqq #
(qq# $
$strqq$ +
,qq+ ,
$strqq- 4
)qq4 5
;qq5 6
}rr 	
}ss 
}tt ›4
gC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Controllers\CuentaController.cs
	namespace

 	
Prestamo


 
.

 
Web

 
.

 
Controllers

 "
{ 
[ 
	Authorize 
] 
public 

class 
CuentaController !
:" #

Controller$ .
{ 
private 
readonly 
ClienteData $
_clienteData% 1
;1 2
private 
readonly 

CuentaData #
_cuentaData$ /
;/ 0
public 
CuentaController 
(  
ClienteData  +
clienteData, 7
,7 8

CuentaData9 C

cuentaDataD N
)N O
{ 	
_clienteData 
= 
clienteData &
;& '
_cuentaData 
= 

cuentaData $
;$ %
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
)/ 0
{ 	
try 
{ 
var 
correo 
= 
User !
.! "
	FindFirst" +
(+ ,

ClaimTypes, 6
.6 7
Email7 <
)< =
?= >
.> ?
Value? D
;D E
Console 
. 
	WriteLine !
(! "
$"" $
$str$ 7
{7 8
correo8 >
}> ?
"? @
)@ A
;A B
if 
( 
string 
. 
IsNullOrEmpty (
(( )
correo) /
)/ 0
)0 1
{   
Console!! 
.!! 
	WriteLine!! %
(!!% &
$str!!& J
)!!J K
;!!K L
return"" 
RedirectToAction"" +
(""+ ,
$str"", 3
,""3 4
$str""5 >
)""> ?
;""? @
}## 
var%% 
cliente%% 
=%% 
await%% #
_clienteData%%$ 0
.%%0 1
ObtenerPorCorreo%%1 A
(%%A B
correo%%B H
)%%H I
;%%I J
if'' 
('' 
cliente'' 
=='' 
null'' #
)''# $
{(( 
Console)) 
.)) 
	WriteLine)) %
())% &
$"))& (
$str))( O
{))O P
correo))P V
}))V W
"))W X
)))X Y
;))Y Z
return** 
RedirectToAction** +
(**+ ,
$str**, 3
,**3 4
$str**5 >
)**> ?
;**? @
}++ 
Console-- 
.-- 
	WriteLine-- !
(--! "
$"--" $
$str--$ ?
{--? @
cliente--@ G
.--G H
	IdCliente--H Q
}--Q R
"--R S
)--S T
;--T U
ViewBag.. 
... 
	IdCliente.. !
=.." #
cliente..$ +
...+ ,
	IdCliente.., 5
;..5 6
return00 
View00 
(00 
)00 
;00 
}11 
catch22 
(22 
	Exception22 
ex22 
)22  
{33 
Console44 
.44 
	WriteLine44 !
(44! "
$"44" $
$str44$ +
{44+ ,
ex44, .
.44. /
Message44/ 6
}446 7
"447 8
)448 9
;449 :
return55 
RedirectToAction55 '
(55' (
$str55( /
,55/ 0
$str551 :
)55: ;
;55; <
}66 
}77 	
[99 	
	Authorize99	 
(99 !
AuthenticationSchemes99 (
=99) *
JwtBearerDefaults99+ <
.99< = 
AuthenticationScheme99= Q
)99Q R
]99R S
[:: 	
HttpGet::	 
]:: 
[;; 	
	Authorize;;	 
(;; 
Roles;; 
=;; 
$str;; $
);;$ %
];;% &
public<< 
async<< 
Task<< 
<<< 
IActionResult<< '
><<' (
ObtenerCuenta<<) 6
(<<6 7
int<<7 :
	idCliente<<; D
)<<D E
{== 	
if>> 
(>> 
!>> 

ModelState>> 
.>> 
IsValid>> #
)>># $
{?? 
return@@ 

BadRequest@@ !
(@@! "

ModelState@@" ,
)@@, -
;@@- .
}AA 
ConsoleBB 
.BB 
	WriteLineBB 
(BB 
$"BB  
$strBB  C
{BBC D
	idClienteBBD M
}BBM N
"BBN O
)BBO P
;BBP Q
tryDD 
{EE 
varFF 
cuentaFF 
=FF 
awaitFF "
_cuentaDataFF# .
.FF. /
ObtenerCuentaFF/ <
(FF< =
	idClienteFF= F
)FFF G
;FFG H
ifGG 
(GG 
cuentaGG 
==GG 
nullGG "
)GG" #
{HH 
returnII 
JsonII 
(II  
newII  #
{II$ %
successII& -
=II. /
falseII0 5
,II5 6
messageII7 >
=II? @
$strIIA [
}II\ ]
)II] ^
;II^ _
}JJ 
ConsoleLL 
.LL 
	WriteLineLL !
(LL! "
$"LL" $
$strLL$ 7
{LL7 8
cuentaLL8 >
?LL> ?
.LL? @
TarjetaLL@ G
??LLH J
$strLLK Q
}LLQ R
"LLR S
)LLS T
;LLT U
returnMM 
JsonMM 
(MM 
newMM 
{MM  !
successMM" )
=MM* +
trueMM, 0
,MM0 1
dataMM2 6
=MM7 8
cuentaMM9 ?
}MM@ A
)MMA B
;MMB C
}NN 
catchOO 
(OO 
	ExceptionOO 
exOO 
)OO  
{PP 
ConsoleQQ 
.QQ 
	WriteLineQQ !
(QQ! "
$"QQ" $
$strQQ$ =
{QQ= >
exQQ> @
.QQ@ A
MessageQQA H
}QQH I
"QQI J
)QQJ K
;QQK L
returnRR 
JsonRR 
(RR 
newRR 
{RR  !
successRR" )
=RR* +
falseRR, 1
,RR1 2
messageRR3 :
=RR; <
$strRR= Y
}RRZ [
)RR[ \
;RR\ ]
}SS 
}TT 	
}VV 
}WW ﬂM
gC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Controllers\CobrarController.cs
	namespace		 	
Prestamo		
 
.		 
Web		 
.		 
Controllers		 "
{

 
[ 
	Authorize 
] 
public 

class 
CobrarController !
:" #

Controller$ .
{ 
private 
readonly 
PrestamoData %
_prestamoData& 3
;3 4
private 
readonly 
AuditoriaService )
_auditoriaService* ;
;; <
private 
readonly 
ClienteData $
_clienteData% 1
;1 2
public 
CobrarController 
(  
PrestamoData  ,
prestamoData- 9
,9 :
AuditoriaService; K
auditoriaServiceL \
,\ ]
ClienteData^ i
clienteDataj u
)u v
{ 	
_prestamoData 
= 
prestamoData (
;( )
_auditoriaService 
= 
auditoriaService  0
;0 1
_clienteData 
= 
clienteData &
;& '
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
)/ 0
{ 	
try 
{ 
var 
correo 
= 
User !
.! "
	FindFirst" +
(+ ,

ClaimTypes, 6
.6 7
Email7 <
)< =
?= >
.> ?
Value? D
;D E
Console 
. 
	WriteLine !
(! "
$"" $
$str$ 7
{7 8
correo8 >
}> ?
"? @
)@ A
;A B
if   
(   
string   
.   
IsNullOrEmpty   (
(  ( )
correo  ) /
)  / 0
)  0 1
{!! 
Console"" 
."" 
	WriteLine"" %
(""% &
$str""& J
)""J K
;""K L
return## 
RedirectToAction## +
(##+ ,
$str##, 3
,##3 4
$str##5 >
)##> ?
;##? @
}$$ 
var&& 
cliente&& 
=&& 
await&& #
_clienteData&&$ 0
.&&0 1
ObtenerPorCorreo&&1 A
(&&A B
correo&&B H
)&&H I
;&&I J
if(( 
((( 
cliente(( 
==(( 
null(( #
)((# $
{)) 
Console** 
.** 
	WriteLine** %
(**% &
$"**& (
$str**( O
{**O P
correo**P V
}**V W
"**W X
)**X Y
;**Y Z
return++ 
RedirectToAction++ +
(+++ ,
$str++, 3
,++3 4
$str++5 >
)++> ?
;++? @
},, 
Console.. 
... 
	WriteLine.. !
(..! "
$".." $
$str..$ ?
{..? @
cliente..@ G
...G H
	IdCliente..H Q
}..Q R
"..R S
)..S T
;..T U
ViewBag// 
.// 
	IdCliente// !
=//" #
cliente//$ +
.//+ ,
	IdCliente//, 5
;//5 6
return11 
View11 
(11 
)11 
;11 
}22 
catch33 
(33 
	Exception33 
ex33 
)33  
{44 
Console55 
.55 
	WriteLine55 !
(55! "
$"55" $
$str55$ +
{55+ ,
ex55, .
.55. /
Message55/ 6
}556 7
"557 8
)558 9
;559 :
return66 
RedirectToAction66 '
(66' (
$str66( /
,66/ 0
$str661 :
)66: ;
;66; <
}77 
}88 	
[:: 	
	Authorize::	 
(:: !
AuthenticationSchemes:: (
=::) *
JwtBearerDefaults::+ <
.::< = 
AuthenticationScheme::= Q
)::Q R
]::R S
[;; 	
HttpPost;;	 
];; 
[<< 	
	Authorize<<	 
(<< 
Roles<< 
=<< 
$str<< $
)<<$ %
]<<% &
public== 
async== 
Task== 
<== 
IActionResult== '
>==' (
PagarCuotas==) 4
(==4 5
[==5 6
FromBody==6 >
]==> ?
PagarCuotasRequest==@ R
request==S Z
)==Z [
{>> 	
if?? 
(?? 
!?? 

ModelState?? 
.?? 
IsValid?? #
)??# $
{@@ 
returnAA 

BadRequestAA !
(AA! "

ModelStateAA" ,
)AA, -
;AA- .
}BB 
ifCC 
(CC 
requestCC 
==CC 
nullCC 
)CC  
{DD 
returnEE 

StatusCodeEE !
(EE! "
StatusCodesEE" -
.EE- .
Status400BadRequestEE. A
,EEA B
newEEC F
{EEG H
dataEEI M
=EEN O
$strEEP s
}EEt u
)EEu v
;EEv w
}FF 
ifHH 
(HH 
stringHH 
.HH 
IsNullOrEmptyHH $
(HH$ %
requestHH% ,
.HH, -
NumeroTarjetaHH- :
)HH: ;
)HH; <
{II 
returnJJ 

StatusCodeJJ !
(JJ! "
StatusCodesJJ" -
.JJ- .
Status400BadRequestJJ. A
,JJA B
newJJC F
{JJG H
dataJJI M
=JJN O
$strJJP s
}JJt u
)JJu v
;JJv w
}KK 
ifMM 
(MM 
requestMM 
.MM 

IdPrestamoMM "
<=MM# %
$numMM& '
)MM' (
{NN 
returnOO 

StatusCodeOO !
(OO! "
StatusCodesOO" -
.OO- .
Status400BadRequestOO. A
,OOA B
newOOC F
{OOG H
dataOOI M
=OON O
$strOOP q
}OOr s
)OOs t
;OOt u
}PP 
ifRR 
(RR 
stringRR 
.RR 
IsNullOrEmptyRR $
(RR$ %
requestRR% ,
.RR, -
NroCuotasPagadasRR- =
)RR= >
)RR> ?
{SS 
returnTT 

StatusCodeTT !
(TT! "
StatusCodesTT" -
.TT- .
Status400BadRequestTT. A
,TTA B
newTTC F
{TTG H
dataTTI M
=TTN O
$strTTP u
}TTv w
)TTw x
;TTx y
}UU 
tryWW 
{XX 
stringYY 
	respuestaYY  
=YY! "
awaitYY# (
_prestamoDataYY) 6
.YY6 7
PagarCuotasYY7 B
(YYB C
requestZZ 
.ZZ 

IdPrestamoZZ &
,ZZ& '
request[[ 
.[[ 
NroCuotasPagadas[[ ,
,[[, -
request\\ 
.\\ 
NumeroTarjeta\\ )
)]] 
;]] 
if__ 
(__ 
	respuesta__ 
.__ 

StartsWith__ (
(__( )
$str__) 0
)__0 1
||__2 4
	respuesta__5 >
.__> ?
Contains__? G
(__G H
$str__H T
)__T U
||__V X
	respuesta__Y b
.__b c
Contains__c k
(__k l
$str__l {
)__{ |
)__| }
{`` 
returnaa 

StatusCodeaa %
(aa% &
StatusCodesaa& 1
.aa1 2
Status400BadRequestaa2 E
,aaE F
newaaG J
{aaK L
dataaaM Q
=aaR S
	respuestaaaT ]
}aa^ _
)aa_ `
;aa` a
}bb 
awaitdd 
_auditoriaServicedd '
.dd' (
RegistrarLogdd( 4
(dd4 5
Userdd5 9
!dd9 :
.dd: ;
Identitydd; C
!ddC D
.ddD E
NameddE I
!ddI J
,ddJ K
$strddL S
,ddS T
$"ddU W
$strddW e
{dde f
requestddf m
.ddm n
NroCuotasPagadasddn ~
}dd~ 
"	dd Ä
)
ddÄ Å
;
ddÅ Ç
returnee 

StatusCodeee !
(ee! "
StatusCodesee" -
.ee- .
Status200OKee. 9
,ee9 :
newee; >
{ee? @
dataeeA E
=eeF G
	respuestaeeH Q
}eeR S
)eeS T
;eeT U
}ff 
catchgg 
(gg 
	Exceptiongg 
exgg 
)gg  
{hh 
returnii 

StatusCodeii !
(ii! "
StatusCodesii" -
.ii- .(
Status500InternalServerErrorii. J
,iiJ K
newiiL O
{iiP Q
dataiiR V
=iiW X
$striiY v
+iiw x
exiiy {
.ii{ |
Message	ii| É
}
iiÑ Ö
)
iiÖ Ü
;
iiÜ á
}jj 
}kk 	
publicmm 
classmm 
PagarCuotasRequestmm '
{nn 	
publicoo 
intoo 

IdPrestamooo !
{oo" #
getoo$ '
;oo' (
setoo) ,
;oo, -
}oo. /
publicpp 
stringpp 
NroCuotasPagadaspp *
{pp+ ,
getpp- 0
;pp0 1
setpp2 5
;pp5 6
}pp7 8
publicqq 
stringqq 
NumeroTarjetaqq '
{qq( )
getqq* -
;qq- .
setqq/ 2
;qq2 3
}qq4 5
}rr 	
}ss 
}tt Èk
hC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Controllers\ClienteController.cs
	namespace		 	
Prestamo		
 
.		 
Web		 
.		 
Controllers		 "
{

 
[ 
	Authorize 
] 
public 

class 
ClienteController "
:# $

Controller% /
{ 
private 
readonly 
ClienteData $
_clienteData% 1
;1 2
private 
readonly 

CuentaData #
_cuentaData$ /
;/ 0
private 
readonly 
AuditoriaService )
_auditoriaService* ;
;; <
public 
ClienteController  
(  !
ClienteData! ,
clienteData- 8
,8 9

CuentaData: D

cuentaDataE O
,O P
AuditoriaServiceQ a
auditoriaServiceb r
)r s
{ 	
_clienteData 
= 
clienteData &
;& '
_cuentaData 
= 

cuentaData $
;$ %
_auditoriaService 
= 
auditoriaService  0
;0 1
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
	Authorize	 
( !
AuthenticationSchemes (
=) *
JwtBearerDefaults+ <
.< = 
AuthenticationScheme= Q
)Q R
]R S
[ 	
HttpGet	 
] 
[   	
	Authorize  	 
(   
Roles   
=   
$str   *
)  * +
]  + ,
public!! 
async!! 
Task!! 
<!! 
IActionResult!! '
>!!' (
Lista!!) .
(!!. /
)!!/ 0
{"" 	
List## 
<## 
Cliente## 
>## 
lista## 
=##  !
await##" '
_clienteData##( 4
.##4 5
Lista##5 :
(##: ;
)##; <
;##< =
await$$ 
_auditoriaService$$ #
.$$# $
RegistrarLog$$$ 0
($$0 1
User$$1 5
.$$5 6
Identity$$6 >
.$$> ?
Name$$? C
,$$C D
$str$$E L
,$$L M
$str$$N y
)$$y z
;$$z {
return%% 

StatusCode%% 
(%% 
StatusCodes%% )
.%%) *
Status200OK%%* 5
,%%5 6
new%%7 :
{%%; <
data%%= A
=%%B C
lista%%D I
}%%J K
)%%K L
;%%L M
}&& 	
[(( 	
	Authorize((	 
((( !
AuthenticationSchemes(( (
=(() *
JwtBearerDefaults((+ <
.((< = 
AuthenticationScheme((= Q
)((Q R
]((R S
[)) 	
HttpPost))	 
])) 
[** 	
	Authorize**	 
(** 
Roles** 
=** 
$str** *
)*** +
]**+ ,
public++ 
async++ 
Task++ 
<++ 
IActionResult++ '
>++' (
Crear++) .
(++. /
[++/ 0
FromBody++0 8
]++8 9
Cliente++: A
objeto++B H
)++H I
{,, 	
if-- 
(-- 
!-- 

ModelState-- 
.-- 
IsValid-- #
)--# $
{.. 
return// 

BadRequest// !
(//! "

ModelState//" ,
)//, -
;//- .
}00 
string11 
	respuesta11 
=11 
await11 $
_clienteData11% 1
.111 2
Crear112 7
(117 8
objeto118 >
)11> ?
;11? @
await22 
_auditoriaService22 #
.22# $
RegistrarLog22$ 0
(220 1
User221 5
.225 6
Identity226 >
.22> ?
Name22? C
,22C D
$str22E L
,22L M
$"22N P
$str22P `
{22` a
objeto22a g
.22g h
Nombre22h n
}22n o
$str22o p
{22p q
objeto22q w
.22w x
Apellido	22x Ä
}
22Ä Å
"
22Å Ç
)
22Ç É
;
22É Ñ
return33 

StatusCode33 
(33 
StatusCodes33 )
.33) *
Status200OK33* 5
,335 6
new337 :
{33; <
data33= A
=33B C
	respuesta33D M
}33N O
)33O P
;33P Q
}44 	
[66 	
	Authorize66	 
(66 !
AuthenticationSchemes66 (
=66) *
JwtBearerDefaults66+ <
.66< = 
AuthenticationScheme66= Q
)66Q R
]66R S
[77 	
HttpPut77	 
]77 
[88 	
	Authorize88	 
(88 
Roles88 
=88 
$str88 *
)88* +
]88+ ,
public99 
async99 
Task99 
<99 
IActionResult99 '
>99' (
Editar99) /
(99/ 0
[990 1
FromBody991 9
]999 :
Cliente99; B
objeto99C I
)99I J
{:: 	
if;; 
(;; 
!;; 

ModelState;; 
.;; 
IsValid;; #
);;# $
{<< 
return== 

BadRequest== !
(==! "

ModelState==" ,
)==, -
;==- .
}>> 
string?? 
	respuesta?? 
=?? 
await?? $
_clienteData??% 1
.??1 2
Editar??2 8
(??8 9
objeto??9 ?
)??? @
;??@ A
await@@ 
_auditoriaService@@ #
.@@# $
RegistrarLog@@$ 0
(@@0 1
User@@1 5
.@@5 6
Identity@@6 >
.@@> ?
Name@@? C
,@@C D
$str@@E M
,@@M N
$"@@O Q
$str@@Q b
{@@b c
objeto@@c i
.@@i j
Nombre@@j p
}@@p q
$str@@q r
{@@r s
objeto@@s y
.@@y z
Apellido	@@z Ç
}
@@Ç É
"
@@É Ñ
)
@@Ñ Ö
;
@@Ö Ü
returnAA 

StatusCodeAA 
(AA 
StatusCodesAA )
.AA) *
Status200OKAA* 5
,AA5 6
newAA7 :
{AA; <
dataAA= A
=AAB C
	respuestaAAD M
}AAN O
)AAO P
;AAP Q
}BB 	
[DD 	
	AuthorizeDD	 
(DD !
AuthenticationSchemesDD (
=DD) *
JwtBearerDefaultsDD+ <
.DD< = 
AuthenticationSchemeDD= Q
)DDQ R
]DDR S
[EE 	

HttpDeleteEE	 
]EE 
[FF 	
	AuthorizeFF	 
(FF 
RolesFF 
=FF 
$strFF *
)FF* +
]FF+ ,
publicGG 
asyncGG 
TaskGG 
<GG 
IActionResultGG '
>GG' (
EliminarGG) 1
(GG1 2
intGG2 5
IdGG6 8
)GG8 9
{HH 	
ifII 
(II 
!II 

ModelStateII 
.II 
IsValidII #
)II# $
{JJ 
returnKK 

BadRequestKK !
(KK! "

ModelStateKK" ,
)KK, -
;KK- .
}LL 
stringMM 
	respuestaMM 
=MM 
awaitMM $
_clienteDataMM% 1
.MM1 2
EliminarMM2 :
(MM: ;
IdMM; =
)MM= >
;MM> ?
awaitNN 
_auditoriaServiceNN #
.NN# $
RegistrarLogNN$ 0
(NN0 1
UserNN1 5
.NN5 6
IdentityNN6 >
.NN> ?
NameNN? C
,NNC D
$strNNE O
,NNO P
$"NNQ S
$strNNS m
{NNm n
IdNNn p
}NNp q
"NNq r
)NNr s
;NNs t
returnOO 

StatusCodeOO 
(OO 
StatusCodesOO )
.OO) *
Status200OKOO* 5
,OO5 6
newOO7 :
{OO; <
dataOO= A
=OOB C
	respuestaOOD M
}OON O
)OOO P
;OOP Q
}PP 	
[RR 	
	AuthorizeRR	 
(RR 
RolesRR 
=RR 
$strRR $
)RR$ %
]RR% &
publicSS 
asyncSS 
TaskSS 
<SS 
IActionResultSS '
>SS' (
CuentaSS) /
(SS/ 0
)SS0 1
{TT 	
varUU 
correoUU 
=UU 
UserUU 
.UU 
	FindFirstUU '
(UU' (

ClaimTypesUU( 2
.UU2 3
EmailUU3 8
)UU8 9
?UU9 :
.UU: ;
ValueUU; @
;UU@ A
ConsoleVV 
.VV 
	WriteLineVV 
(VV 
correoVV $
)VV$ %
;VV% &
ifWW 
(WW 
stringWW 
.WW 
IsNullOrEmptyWW $
(WW$ %
correoWW% +
)WW+ ,
)WW, -
{XX 
returnYY 
RedirectToActionYY '
(YY' (
$strYY( /
,YY/ 0
$strYY1 7
)YY7 8
;YY8 9
}ZZ 
var\\ 
cliente\\ 
=\\ 
await\\ 
_clienteData\\  ,
.\\, -
ObtenerPorCorreo\\- =
(\\= >
correo\\> D
)\\D E
;\\E F
if]] 
(]] 
cliente]] 
==]] 
null]] 
)]]  
{^^ 
return__ 
RedirectToAction__ '
(__' (
$str__( /
,__/ 0
$str__1 7
)__7 8
;__8 9
}`` 
returnbb 
RedirectToActionbb #
(bb# $
$strbb$ +
,bb+ ,
$strbb- 5
,bb5 6
newbb7 :
{bb; <
	idClientebb= F
=bbG H
clientebbI P
.bbP Q
	IdClientebbQ Z
}bb[ \
)bb\ ]
;bb] ^
}cc 	
[ee 	
	Authorizeee	 
(ee !
AuthenticationSchemesee (
=ee) *
JwtBearerDefaultsee+ <
.ee< = 
AuthenticationSchemeee= Q
)eeQ R
]eeR S
[ff 	
HttpPostff	 
]ff 
[gg 	
	Authorizegg	 
(gg 
Rolesgg 
=gg 
$strgg $
)gg$ %
]gg% &
publichh 
asynchh 
Taskhh 
<hh 
IActionResulthh '
>hh' (
	Depositarhh) 2
(hh2 3
[hh3 4
FromBodyhh4 <
]hh< =
DepositoRequesthh> M
requesthhN U
)hhU V
{ii 	
ifjj 
(jj 
!jj 

ModelStatejj 
.jj 
IsValidjj #
)jj# $
{kk 
returnll 

BadRequestll !
(ll! "

ModelStatell" ,
)ll, -
;ll- .
}mm 
trynn 
{oo 
varpp 
	resultadopp 
=pp 
awaitpp  %
_cuentaDatapp& 1
.pp1 2
	Depositarpp2 ;
(pp; <
requestpp< C
.ppC D
	IdClienteppD M
,ppM N
requestppO V
.ppV W
MontoppW \
)pp\ ]
;pp] ^
ifqq 
(qq 
stringqq 
.qq 
IsNullOrEmptyqq (
(qq( )
	resultadoqq) 2
)qq2 3
)qq3 4
{rr 
awaitss 
_auditoriaServicess +
.ss+ ,
RegistrarLogss, 8
(ss8 9
Userss9 =
.ss= >
Identityss> F
.ssF G
NamessG K
,ssK L
$strssM X
,ssX Y
$"ssZ \
$strss\ h
{ssh i
requestssi p
.ssp q
Montossq v
}ssv w
$str	ssw ü
{
ssü †
request
ss† ß
.
ssß ®
	IdCliente
ss® ±
}
ss± ≤
"
ss≤ ≥
)
ss≥ ¥
;
ss¥ µ
returntt 
Jsontt 
(tt  
newtt  #
{tt$ %
successtt& -
=tt. /
truett0 4
}tt5 6
)tt6 7
;tt7 8
}uu 
elsevv 
{ww 
returnxx 
Jsonxx 
(xx  
newxx  #
{xx$ %
successxx& -
=xx. /
falsexx0 5
,xx5 6
errorxx7 <
=xx= >
	resultadoxx? H
}xxI J
)xxJ K
;xxK L
}yy 
}zz 
catch{{ 
({{ 
	Exception{{ 
ex{{ 
){{  
{|| 
return}} 

StatusCode}} !
(}}! "
$num}}" %
,}}% &
new}}' *
{}}+ ,
success}}- 4
=}}5 6
false}}7 <
,}}< =
error}}> C
=}}D E
ex}}F H
.}}H I
Message}}I P
}}}Q R
)}}R S
;}}S T
}~~ 
} 	
}
ÄÄ 
public
ÇÇ 

class
ÇÇ 
DepositoRequest
ÇÇ  
{
ÉÉ 
public
ÑÑ 
int
ÑÑ 
	IdCliente
ÑÑ 
{
ÑÑ 
get
ÑÑ "
;
ÑÑ" #
set
ÑÑ$ '
;
ÑÑ' (
}
ÑÑ) *
public
ÖÖ 
decimal
ÖÖ 
Monto
ÖÖ 
{
ÖÖ 
get
ÖÖ "
;
ÖÖ" #
set
ÖÖ$ '
;
ÖÖ' (
}
ÖÖ) *
}
ÜÜ 
}áá ÓW
hC:\Users\USUARIO\Desktop\DesarrolloSeguro2\SistemaPrestamo\Prestamo.Web\Controllers\AccountController.cs
	namespace

 	
Prestamo


 
.

 
Web

 
.

 
Controllers

 "
{ 
[ 
	Authorize 
( !
AuthenticationSchemes $
=% &
JwtBearerDefaults' 8
.8 9 
AuthenticationScheme9 M
)M N
]N O
public 

class 
AccountController "
:# $

Controller% /
{ 
private 
readonly 
UsuarioData $
_usuarioData% 1
;1 2
private 
readonly 
EmailService %
_emailService& 3
;3 4
private 
readonly 
AuditoriaService )
_auditoriaService* ;
;; <
public 
AccountController  
(  !
UsuarioData! ,
usuarioData- 8
,8 9
EmailService: F
emailServiceG S
,S T
AuditoriaServiceU e
auditoriaServicef v
)v w
{ 	
_usuarioData 
= 
usuarioData &
;& '
_emailService 
= 
emailService (
;( )
_auditoriaService 
= 
auditoriaService  0
;0 1
} 	
[ 	
HttpGet	 
] 
public 
IActionResult 
ChangePassword +
(+ ,
), -
{ 	
return 
View 
( 
) 
; 
} 	
[   	
	Authorize  	 
(   !
AuthenticationSchemes   (
=  ) *
JwtBearerDefaults  + <
.  < = 
AuthenticationScheme  = Q
)  Q R
]  R S
[!! 	
HttpPost!!	 
]!! 
["" 	
	Authorize""	 
("" 
Roles"" 
="" 
$str"" $
)""$ %
]""% &
public## 
async## 
Task## 
<## 
IActionResult## '
>##' ('
SolicitarCodigoVerificacion##) D
(##D E
[##E F
FromBody##F N
]##N O#
ChangePasswordViewModel##P g
model##h m
)##m n
{$$ 	
if%% 
(%% 
!%% 

ModelState%% 
.%% 
IsValid%% #
)%%# $
{&& 
return'' 

BadRequest'' !
(''! "

ModelState''" ,
)'', -
;''- .
}(( 
var** 
userId** 
=** 
User** 
.** 
	FindFirst** '
(**' (

ClaimTypes**( 2
.**2 3
NameIdentifier**3 A
)**A B
?**B C
.**C D
Value**D I
;**I J
if++ 
(++ 
userId++ 
==++ 
null++ 
)++ 
{,, 
return-- 
Json-- 
(-- 
new-- 
{--  !
success--" )
=--* +
false--, 1
,--1 2
message--3 :
=--; <
$str--= U
}--V W
)--W X
;--X Y
}.. 
var00 
usuario00 
=00 
await00 
_usuarioData00  ,
.00, -
ObtenerPorId00- 9
(009 :
int00: =
.00= >
Parse00> C
(00C D
userId00D J
)00J K
)00K L
;00L M
if11 
(11 
usuario11 
==11 
null11 
)11  
{22 
return33 
Json33 
(33 
new33 
{33  !
success33" )
=33* +
false33, 1
,331 2
message333 :
=33; <
$str33= T
}33U V
)33V W
;33W X
}44 
bool66 
isPasswordValid66  
=66! "
BCrypt66# )
.66) *
Net66* -
.66- .
BCrypt66. 4
.664 5
Verify665 ;
(66; <
model66< A
.66A B
CurrentPassword66B Q
,66Q R
usuario66S Z
.66Z [
Clave66[ `
)66` a
;66a b
if77 
(77 
!77 
isPasswordValid77  
)77  !
{88 
return99 
Json99 
(99 
new99 
{99  !
success99" )
=99* +
false99, 1
,991 2
message993 :
=99; <
$str99= a
}99b c
)99c d
;99d e
}:: 
var== 
codigoVerificacion== "
===# $%
GenerarCodigoVerificacion==% >
(==> ?
)==? @
;==@ A
HttpContext>> 
.>> 
Session>> 
.>>  
	SetString>>  )
(>>) *
$str>>* >
,>>> ?
codigoVerificacion>>@ R
)>>R S
;>>S T
stringAA 
asuntoAA 
=AA 
$strAA N
;AAN O
stringBB 
mensajeBB 
=BB 
$"BB 
$strBB =
{BB= >
codigoVerificacionBB> P
}BBP Q
"BBQ R
;BBR S
awaitCC 
_emailServiceCC 
.CC  
EnviarCorreoAsyncCC  1
(CC1 2
usuarioCC2 9
.CC9 :
CorreoCC: @
,CC@ A
asuntoCCB H
,CCH I
mensajeCCJ Q
)CCQ R
;CCR S
returnDD 
JsonDD 
(DD 
newDD 
{DD 
successDD %
=DD& '
trueDD( ,
}DD- .
)DD. /
;DD/ 0
}EE 	
[GG 	
	AuthorizeGG	 
(GG !
AuthenticationSchemesGG (
=GG) *
JwtBearerDefaultsGG+ <
.GG< = 
AuthenticationSchemeGG= Q
)GGQ R
]GGR S
[HH 	
HttpPostHH	 
]HH 
[II 	
	AuthorizeII	 
(II 
RolesII 
=II 
$strII $
)II$ %
]II% &
publicJJ 
asyncJJ 
TaskJJ 
<JJ 
IActionResultJJ '
>JJ' (
ChangePasswordJJ) 7
(JJ7 8
[JJ8 9
FromBodyJJ9 A
]JJA B#
ChangePasswordViewModelJJC Z
modelJJ[ `
)JJ` a
{KK 	
ifLL 
(LL 
!LL 

ModelStateLL 
.LL 
IsValidLL #
)LL# $
{MM 
returnNN 

BadRequestNN !
(NN! "

ModelStateNN" ,
)NN, -
;NN- .
}OO 
varQQ 
userIdQQ 
=QQ 
UserQQ 
.QQ 
	FindFirstQQ '
(QQ' (

ClaimTypesQQ( 2
.QQ2 3
NameIdentifierQQ3 A
)QQA B
?QQB C
.QQC D
ValueQQD I
;QQI J
ifRR 
(RR 
userIdRR 
==RR 
nullRR 
)RR 
{SS 
returnTT 
JsonTT 
(TT 
newTT 
{TT  !
successTT" )
=TT* +
falseTT, 1
,TT1 2
messageTT3 :
=TT; <
$strTT= U
}TTV W
)TTW X
;TTX Y
}UU 
varWW 
usuarioWW 
=WW 
awaitWW 
_usuarioDataWW  ,
.WW, -
ObtenerPorIdWW- 9
(WW9 :
intWW: =
.WW= >
ParseWW> C
(WWC D
userIdWWD J
)WWJ K
)WWK L
;WWL M
ifXX 
(XX 
usuarioXX 
==XX 
nullXX 
)XX  
{YY 
returnZZ 
JsonZZ 
(ZZ 
newZZ 
{ZZ  !
successZZ" )
=ZZ* +
falseZZ, 1
,ZZ1 2
messageZZ3 :
=ZZ; <
$strZZ= T
}ZZU V
)ZZV W
;ZZW X
}[[ 
var]] 
codigoVerificacion]] "
=]]# $
HttpContext]]% 0
.]]0 1
Session]]1 8
.]]8 9
	GetString]]9 B
(]]B C
$str]]C W
)]]W X
;]]X Y
if^^ 
(^^ 
model^^ 
.^^ 
VerificationCode^^ &
!=^^' )
codigoVerificacion^^* <
)^^< =
{__ 
return`` 
Json`` 
(`` 
new`` 
{``  !
success``" )
=``* +
false``, 1
,``1 2
message``3 :
=``; <
$str``= f
}``g h
)``h i
;``i j
}aa 
trycc 
{dd 
usuarioee 
.ee 
Claveee 
=ee 
BCryptee  &
.ee& '
Netee' *
.ee* +
BCryptee+ 1
.ee1 2
HashPasswordee2 >
(ee> ?
modelee? D
.eeD E
NewPasswordeeE P
)eeP Q
;eeQ R
awaitff 
_usuarioDataff "
.ff" #

Actualizarff# -
(ff- .
usuarioff. 5
)ff5 6
;ff6 7
awaitgg 
_auditoriaServicegg '
.gg' (
RegistrarLoggg( 4
(gg4 5
Usergg5 9
.gg9 :
Identitygg: B
.ggB C
NameggC G
,ggG H
$strggI Q
,ggQ R
$"ggS U
$strggU i
{ggi j
usuarioggj q
.ggq r
Claveggr w
}ggw x
"ggx y
)ggy z
;ggz {
returnii 
Jsonii 
(ii 
newii 
{ii  !
successii" )
=ii* +
trueii, 0
}ii1 2
)ii2 3
;ii3 4
}jj 
catchkk 
(kk 
	Exceptionkk 
exkk 
)kk  
{ll 
returnmm 
Jsonmm 
(mm 
newmm 
{mm  !
successmm" )
=mm* +
falsemm, 1
,mm1 2
messagemm3 :
=mm; <
exmm= ?
.mm? @
Messagemm@ G
}mmH I
)mmI J
;mmJ K
}nn 
}oo 	
privateqq 
stringqq %
GenerarCodigoVerificacionqq 0
(qq0 1
)qq1 2
{rr 	
usingss 
(ss 
varss 
rngss 
=ss !
RandomNumberGeneratorss 2
.ss2 3
Createss3 9
(ss9 :
)ss: ;
)ss; <
{tt 
varuu 
bytesuu 
=uu 
newuu 
byteuu  $
[uu$ %
$numuu% &
]uu& '
;uu' (
rngvv 
.vv 
GetBytesvv 
(vv 
bytesvv "
)vv" #
;vv# $
returnww 
BitConverterww #
.ww# $
ToUInt32ww$ ,
(ww, -
bytesww- 2
,ww2 3
$numww4 5
)ww5 6
.ww6 7
ToStringww7 ?
(ww? @
$strww@ D
)wwD E
;wwE F
}xx 
}yy 	
}zz 
}{{ 